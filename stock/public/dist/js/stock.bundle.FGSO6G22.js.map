{
  "version": 3,
  "sources": ["../../../../../apps/stock/stock/public/js/conf.js", "../../../../../apps/stock/stock/public/js/utils.js", "../../../../../apps/stock/stock/public/js/queries.js", "../../../../../apps/stock/stock/public/js/sms_manager.js", "../../../../../apps/stock/stock/public/js/utils/party.js", "../../../../../apps/stock/stock/public/js/controllers/stock_controller.js", "../../../../../apps/stock/stock/public/js/payment/payments.js", "../../../../../apps/stock/stock/public/js/controllers/taxes_and_totals.js", "../../../../../apps/stock/stock/public/js/controllers/transaction.js", "frappe-html:/Users/abizeyimanavictor/frappe-msacco/apps/stock/stock/public/js/templates/item_selector.html", "../../../../../apps/stock/stock/public/js/utils/item_selector.js", "../../../../../apps/stock/stock/public/js/help_links.js", "frappe-html:/Users/abizeyimanavictor/frappe-msacco/apps/stock/stock/public/js/templates/item_quick_entry.html", "../../../../../apps/stock/stock/public/js/utils/contact_address_quick_entry.js", "../../../../../apps/stock/stock/public/js/utils/customer_quick_entry.js", "../../../../../apps/stock/stock/public/js/utils/supplier_quick_entry.js", "../../../../../apps/stock/stock/public/js/call_popup/call_popup.js", "../../../../../apps/stock/stock/public/js/utils/barcode_scanner.js", "../../../../../apps/stock/stock/public/js/telephony.js", "frappe-html:/Users/abizeyimanavictor/frappe-msacco/apps/stock/stock/public/js/templates/call_link.html", "../../../../../apps/stock/stock/public/js/bulk_transaction_processing.js", "../../../../../apps/stock/stock/public/js/utils/crm_activities.js", "frappe-html:/Users/abizeyimanavictor/frappe-msacco/apps/stock/stock/public/js/templates/crm_activities.html", "frappe-html:/Users/abizeyimanavictor/frappe-msacco/apps/stock/stock/public/js/templates/crm_notes.html", "../../../../../apps/stock/stock/public/js/utils/landed_taxes_and_charges_common.js", "../../../../../apps/stock/stock/public/js/utils/sales_common.js", "../../../../../apps/stock/stock/public/js/controllers/buying.js", "../../../../../apps/stock/stock/public/js/utils/demo.js", "../../../../../apps/stock/stock/public/js/financial_statements.js"],
  "sourcesContent": ["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide('stock');\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\t\"Territory\": \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\t\"Brand\": \"Stock\",\n\t\"Maintenance Schedule\": \"Support\",\n\t\"Maintenance Visit\": \"Support\"\n});\n\n$.extend(frappe.breadcrumbs.module_map, {\n\t'stock Integrations': 'Integrations',\n\t'Geo': 'Settings',\n\t'Portal': 'Website',\n\t'Utilities': 'Settings',\n\t'E-commerce': 'Website',\n\t'Contacts': 'CRM'\n});\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide('stock');\nfrappe.provide('stock.utils');\n\n$.extend(stock, {\n  get_currency: function (company) {\n    if (!company && cur_frm) company = cur_frm.doc.company;\n    if (company)\n      return (\n        frappe.get_doc(':Company', company)?.default_currency ||\n        frappe.boot.sysdefaults.currency\n      );\n    else return frappe.boot.sysdefaults.currency;\n  },\n\n  get_presentation_currency_list: () => {\n    const docs = frappe.boot.docs;\n    let currency_list = docs\n      .filter((d) => d.doctype === ':Currency')\n      .map((d) => d.name);\n    currency_list.unshift('');\n    return currency_list;\n  },\n\n  toggle_naming_series: function () {\n    if (cur_frm && cur_frm.fields_dict.naming_series) {\n      cur_frm.toggle_display(\n        'naming_series',\n        cur_frm.doc.__islocal ? true : false\n      );\n    }\n  },\n\n  hide_company: function () {\n    if (cur_frm.fields_dict.company) {\n      var companies = Object.keys(locals[':Company'] || {});\n      if (companies.length === 1) {\n        if (!cur_frm.doc.company) cur_frm.set_value('company', companies[0]);\n        cur_frm.toggle_display('company', false);\n      } else if (stock.last_selected_company) {\n        if (!cur_frm.doc.company)\n          cur_frm.set_value('company', stock.last_selected_company);\n      }\n    }\n  },\n\n  // is_perpetual_inventory_enabled: function(company) {\n  // \tif(company) {\n  // \t\treturn frappe.get_doc(\":Company\", company).enable_perpetual_inventory\n  // \t}\n  // },\n\n  stale_rate_allowed: () => {\n    return cint(frappe.boot.sysdefaults.allow_stale);\n  },\n\n  setup_serial_or_batch_no: function () {\n    let grid_row = cur_frm.open_grid_row();\n    if (\n      !grid_row ||\n      !grid_row.grid_form.fields_dict.serial_no ||\n      grid_row.grid_form.fields_dict.serial_no.get_status() !== 'Write'\n    )\n      return;\n\n    frappe.model.get_value(\n      'Item',\n      { name: grid_row.doc.item_code },\n      ['has_serial_no', 'has_batch_no'],\n      ({ has_serial_no, has_batch_no }) => {\n        Object.assign(grid_row.doc, { has_serial_no, has_batch_no });\n\n        if (has_serial_no) {\n          attach_selector_button(\n            __('Add Serial No'),\n            grid_row.grid_form.fields_dict.serial_no.$wrapper,\n            this,\n            grid_row\n          );\n        } else if (has_batch_no) {\n          attach_selector_button(\n            __('Pick Batch No'),\n            grid_row.grid_form.fields_dict.batch_no.$wrapper,\n            this,\n            grid_row\n          );\n        }\n      }\n    );\n  },\n\n  route_to_adjustment_jv: (args) => {\n    frappe.model.with_doctype('Journal Entry', () => {\n      // route to adjustment Journal Entry to handle Account Balance and Stock Value mismatch\n      let journal_entry = frappe.model.get_new_doc('Journal Entry');\n\n      args.accounts.forEach((je_account) => {\n        let child_row = frappe.model.add_child(journal_entry, 'accounts');\n        child_row.account = je_account.account;\n        child_row.debit_in_account_currency =\n          je_account.debit_in_account_currency;\n        child_row.credit_in_account_currency =\n          je_account.credit_in_account_currency;\n        child_row.party_type = '';\n      });\n      frappe.set_route('Form', 'Journal Entry', journal_entry.name);\n    });\n  },\n\n  // route_to_pending_reposts: (args) => {\n  // \tfrappe.set_route('List', 'Repost Item Valuation', args);\n  // },\n});\n\n$.extend(stock.utils, {\n  set_party_dashboard_indicators: function (frm) {\n    if (frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n      var company_wise_info = frm.doc.__onload.dashboard_info;\n      if (company_wise_info.length > 1) {\n        company_wise_info.forEach(function (info) {\n          stock.utils.add_indicator_for_multicompany(frm, info);\n        });\n      } else if (company_wise_info.length === 1) {\n        frm.dashboard.add_indicator(\n          __('Annual Billing: {0}', [\n            format_currency(\n              company_wise_info[0].billing_this_year,\n              company_wise_info[0].currency\n            ),\n          ]),\n          'blue'\n        );\n        frm.dashboard.add_indicator(\n          __('Total Unpaid: {0}', [\n            format_currency(\n              company_wise_info[0].total_unpaid,\n              company_wise_info[0].currency\n            ),\n          ]),\n          company_wise_info[0].total_unpaid ? 'orange' : 'green'\n        );\n\n        if (company_wise_info[0].loyalty_points) {\n          frm.dashboard.add_indicator(\n            __('Loyalty Points: {0}', [company_wise_info[0].loyalty_points]),\n            'blue'\n          );\n        }\n      }\n    }\n  },\n\n  view_serial_batch_nos: function (frm) {\n    if (!frm.doc?.items) {\n      return;\n    }\n\n    let bundle_ids = frm.doc.items.filter((d) => d.serial_and_batch_bundle);\n\n    if (bundle_ids?.length) {\n      frm.add_custom_button(\n        __('Serial / Batch Nos'),\n        () => {\n          frappe.route_options = {\n            voucher_no: frm.doc.name,\n            voucher_type: frm.doc.doctype,\n            from_date: frm.doc.posting_date || frm.doc.transaction_date,\n            to_date: frm.doc.posting_date || frm.doc.transaction_date,\n            company: frm.doc.company,\n          };\n          frappe.set_route('query-report', 'Serial and Batch Summary');\n        },\n        __('View')\n      );\n    }\n  },\n\n  add_indicator_for_multicompany: function (frm, info) {\n    frm.dashboard.stats_area.show();\n    frm.dashboard.stats_area_row.addClass('flex');\n    frm.dashboard.stats_area_row.css('flex-wrap', 'wrap');\n\n    var color = info.total_unpaid ? 'orange' : 'green';\n\n    var indicator = $(\n      '<div class=\"flex-column col-xs-6\">' +\n        '<div style=\"margin-top:10px\"><h6>' +\n        info.company +\n        '</h6></div>' +\n        '<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">' +\n        'Annual Billing: ' +\n        format_currency(info.billing_this_year, info.currency) +\n        '</span></div>' +\n        '<div class=\"badge-link small\" style=\"margin-bottom:10px\">' +\n        '<span class=\"indicator ' +\n        color +\n        '\">Total Unpaid: ' +\n        format_currency(info.total_unpaid, info.currency) +\n        '</span></div>' +\n        '</div>'\n    ).appendTo(frm.dashboard.stats_area_row);\n\n    if (info.loyalty_points) {\n      $(\n        '<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">' +\n          'Loyalty Points: ' +\n          info.loyalty_points +\n          '</span></div>'\n      ).appendTo(indicator);\n    }\n\n    return indicator;\n  },\n\n  get_party_name: function (party_type) {\n    var dict = {\n      Customer: 'customer_name',\n      Supplier: 'supplier_name',\n      Employee: 'employee_name',\n      Member: 'member_name',\n    };\n    return dict[party_type];\n  },\n\n  copy_value_in_all_rows: function (doc, dt, dn, table_fieldname, fieldname) {\n    var d = locals[dt][dn];\n    if (d[fieldname]) {\n      var cl = doc[table_fieldname] || [];\n      for (var i = 0; i < cl.length; i++) {\n        if (!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n      }\n    }\n    refresh_field(table_fieldname);\n  },\n\n  get_terms: function (tc_name, doc, callback) {\n    if (tc_name) {\n      return frappe.call({\n        method:\n          'basic.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions',\n        args: {\n          template_name: tc_name,\n          doc: doc,\n        },\n        callback: function (r) {\n          callback(r);\n        },\n      });\n    }\n  },\n\n  add_inventory_dimensions: function (report_name, index) {\n    let filters = frappe.query_reports[report_name].filters;\n\n    frappe.call({\n      method:\n        'stock.stock.doctype.inventory_dimension.inventory_dimension.get_inventory_dimensions',\n      callback: function (r) {\n        if (r.message && r.message.length) {\n          r.message.forEach((dimension) => {\n            let existing_filter = filters.filter(\n              (el) => el.fieldname === dimension['fieldname']\n            );\n\n            if (!existing_filter.length) {\n              filters.splice(index, 0, {\n                fieldname: dimension['fieldname'],\n                label: __(dimension['doctype']),\n                fieldtype: 'MultiSelectList',\n                get_data: function (txt) {\n                  return frappe.db.get_link_options(dimension['doctype'], txt);\n                },\n              });\n            } else {\n              existing_filter[0]['fieldtype'] = 'MultiSelectList';\n              existing_filter[0]['get_data'] = function (txt) {\n                return frappe.db.get_link_options(dimension['doctype'], txt);\n              };\n            }\n          });\n        }\n      },\n    });\n  },\n\n  make_subscription: function (doctype, docname) {\n    frappe.call({\n      method:\n        'frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat',\n      args: {\n        doctype: doctype,\n        docname: docname,\n      },\n      callback: function (r) {\n        var doclist = frappe.model.sync(r.message);\n        frappe.set_route('Form', doclist[0].doctype, doclist[0].name);\n      },\n    });\n  },\n\n  /**\n   * Checks if the first row of a given child table is empty\n   * @param child_table - Child table Doctype\n   * @return {Boolean}\n   **/\n  first_row_is_empty: function (child_table) {\n    if ($.isArray(child_table) && child_table.length > 0) {\n      return !child_table[0].item_code;\n    }\n    return false;\n  },\n\n  /**\n   * Removes the first row of a child table if it is empty\n   * @param {_Frm} frm - The current form\n   * @param {String} child_table_name - The child table field name\n   * @return {Boolean}\n   **/\n  remove_empty_first_row: function (frm, child_table_name) {\n    const rows = frm['doc'][child_table_name];\n    if (this.first_row_is_empty(rows)) {\n      frm['doc'][child_table_name] = rows.splice(1);\n    }\n    return rows;\n  },\n  get_tree_options: function (option) {\n    // get valid options for tree based on user permission & locals dict\n    let unscrub_option = frappe.model.unscrub(option);\n    let user_permission = frappe.defaults.get_user_permissions();\n    let options;\n\n    if (user_permission && user_permission[unscrub_option]) {\n      options = user_permission[unscrub_option].map((perm) => perm.doc);\n    } else {\n      options = $.map(locals[`:${unscrub_option}`], function (c) {\n        return c.name;\n      }).sort();\n    }\n\n    // filter unique values, as there may be multiple user permissions for any value\n    return options.filter(\n      (value, index, self) => self.indexOf(value) === index\n    );\n  },\n  get_tree_default: function (option) {\n    // set default for a field based on user permission\n    let options = this.get_tree_options(option);\n    if (options.includes(frappe.defaults.get_default(option))) {\n      return frappe.defaults.get_default(option);\n    } else {\n      return options[0];\n    }\n  },\n  overrides_parent_value_in_all_rows: function (\n    doc,\n    dt,\n    dn,\n    table_fieldname,\n    fieldname,\n    parent_fieldname\n  ) {\n    if (doc[parent_fieldname]) {\n      let cl = doc[table_fieldname] || [];\n      for (let i = 0; i < cl.length; i++) {\n        cl[i][fieldname] = doc[parent_fieldname];\n      }\n      frappe.refresh_field(table_fieldname);\n    }\n  },\n  create_new_doc: function (doctype, update_fields) {\n    frappe.model.with_doctype(doctype, function () {\n      var new_doc = frappe.model.get_new_doc(doctype);\n      for (let [key, value] of Object.entries(update_fields)) {\n        new_doc[key] = value;\n      }\n      frappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n    });\n  },\n\n  // check if payments app is installed on site, if not warn user.\n  check_payments_app: () => {\n    if (frappe.boot.versions && !frappe.boot.versions.payments) {\n      const marketplace_link =\n        '<a href=\"https://frappecloud.com/marketplace/apps/payments\">Marketplace</a>';\n      const github_link =\n        '<a href=\"https://github.com/frappe/payments/\">GitHub</a>';\n      const msg = __(\n        'payments app is not installed. Please install it from {0} or {1}',\n        [marketplace_link, github_link]\n      );\n      frappe.msgprint(msg);\n    }\n  },\n\n  pick_serial_and_batch_bundle(\n    frm,\n    cdt,\n    cdn,\n    type_of_transaction,\n    warehouse_field\n  ) {\n    let item_row = frappe.get_doc(cdt, cdn);\n    item_row.type_of_transaction = type_of_transaction;\n\n    frappe.db\n      .get_value('Item', item_row.item_code, ['has_batch_no', 'has_serial_no'])\n      .then((r) => {\n        item_row.has_batch_no = r.message.has_batch_no;\n        item_row.has_serial_no = r.message.has_serial_no;\n\n        frappe.require(\n          'assets/stock/js/utils/serial_no_batch_selector.js',\n          function () {\n            new stock.SerialBatchPackageSelector(frm, item_row, (r) => {\n              if (r) {\n                let update_values = {\n                  serial_and_batch_bundle: r.name,\n                  qty: Math.abs(r.total_qty),\n                };\n\n                if (!warehouse_field) {\n                  warehouse_field = 'warehouse';\n                }\n\n                if (r.warehouse) {\n                  update_values[warehouse_field] = r.warehouse;\n                }\n\n                frappe.model.set_value(\n                  item_row.doctype,\n                  item_row.name,\n                  update_values\n                );\n              }\n            });\n          }\n        );\n      });\n  },\n});\n\nstock.utils.select_alternate_items = function (opts) {\n  const frm = opts.frm;\n  const warehouse_field = opts.warehouse_field || 'warehouse';\n  const item_field = opts.item_field || 'item_code';\n\n  this.data = [];\n  const dialog = new frappe.ui.Dialog({\n    title: __('Select Alternate Item'),\n    fields: [\n      { fieldtype: 'Section Break', label: __('Items') },\n      {\n        fieldname: 'alternative_items',\n        fieldtype: 'Table',\n        cannot_add_rows: true,\n        in_place_edit: true,\n        data: this.data,\n        get_data: () => {\n          return this.data;\n        },\n        fields: [\n          {\n            fieldtype: 'Data',\n            fieldname: 'docname',\n            hidden: 1,\n          },\n          {\n            fieldtype: 'Link',\n            fieldname: 'item_code',\n            options: 'Item',\n            in_list_view: 1,\n            read_only: 1,\n            label: __('Item Code'),\n          },\n          {\n            fieldtype: 'Link',\n            fieldname: 'alternate_item',\n            options: 'Item',\n            default: '',\n            in_list_view: 1,\n            label: __('Alternate Item'),\n            onchange: function () {\n              const item_code = this.get_value();\n              const warehouse =\n                this.grid_row.on_grid_fields_dict.warehouse.get_value();\n              if (item_code && warehouse) {\n                frappe.call({\n                  method: 'stock.stock.utils.get_latest_stock_qty',\n                  args: {\n                    item_code: item_code,\n                    warehouse: warehouse,\n                  },\n                  callback: (r) => {\n                    this.grid_row.on_grid_fields_dict.actual_qty.set_value(\n                      r.message || 0\n                    );\n                  },\n                });\n              }\n            },\n            get_query: (e) => {\n              return {\n                query:\n                  'stock.stock.doctype.item_alternative.item_alternative.get_alternative_items',\n                filters: {\n                  item_code: e.item_code,\n                },\n              };\n            },\n          },\n          {\n            fieldtype: 'Link',\n            fieldname: 'warehouse',\n            options: 'Warehouse',\n            default: '',\n            in_list_view: 1,\n            label: __('Warehouse'),\n            onchange: function () {\n              const warehouse = this.get_value();\n              const item_code =\n                this.grid_row.on_grid_fields_dict.item_code.get_value();\n              if (item_code && warehouse) {\n                frappe.call({\n                  method: 'stock.stock.utils.get_latest_stock_qty',\n                  args: {\n                    item_code: item_code,\n                    warehouse: warehouse,\n                  },\n                  callback: (r) => {\n                    this.grid_row.on_grid_fields_dict.actual_qty.set_value(\n                      r.message || 0\n                    );\n                  },\n                });\n              }\n            },\n          },\n          {\n            fieldtype: 'Float',\n            fieldname: 'actual_qty',\n            default: 0,\n            read_only: 1,\n            in_list_view: 1,\n            label: __('Available Qty'),\n          },\n        ],\n      },\n    ],\n    primary_action: function () {\n      const args = this.get_values()['alternative_items'];\n      const alternative_items = args.filter((d) => {\n        if (d.alternate_item && d.item_code != d.alternate_item) {\n          return true;\n        }\n      });\n\n      alternative_items.forEach((d) => {\n        let row = frappe.get_doc(opts.child_doctype, d.docname);\n        let qty = null;\n        if (row.doctype === 'Work Order Item') {\n          qty = row.required_qty;\n        } else {\n          qty = row.qty;\n        }\n        row[item_field] = d.alternate_item;\n        frappe.model.set_value(row.doctype, row.name, 'qty', qty);\n        frappe.model.set_value(\n          row.doctype,\n          row.name,\n          opts.original_item_field,\n          d.item_code\n        );\n        frm.trigger(item_field, row.doctype, row.name);\n      });\n\n      refresh_field(opts.child_docname);\n      this.hide();\n    },\n    primary_action_label: __('Update'),\n  });\n\n  frm.doc[opts.child_docname].forEach((d) => {\n    if (!opts.condition || opts.condition(d)) {\n      dialog.fields_dict.alternative_items.df.data.push({\n        docname: d.name,\n        item_code: d[item_field],\n        warehouse: d[warehouse_field],\n        actual_qty: d.actual_qty,\n      });\n    }\n  });\n\n  this.data = dialog.fields_dict.alternative_items.df.data;\n  dialog.fields_dict.alternative_items.grid.refresh();\n  dialog.show();\n};\n\nstock.utils.update_child_items = function (opts) {\n  const frm = opts.frm;\n  const cannot_add_row =\n    typeof opts.cannot_add_row === 'undefined' ? true : opts.cannot_add_row;\n  const child_docname =\n    typeof opts.cannot_add_row === 'undefined' ? 'items' : opts.child_docname;\n  const child_meta = frappe.get_meta(`${frm.doc.doctype} Item`);\n  const has_reserved_stock = opts.has_reserved_stock ? true : false;\n  const get_precision = (fieldname) =>\n    child_meta.fields.find((f) => f.fieldname == fieldname).precision;\n\n  this.data = frm.doc[opts.child_docname].map((d) => {\n    return {\n      docname: d.name,\n      name: d.name,\n      item_code: d.item_code,\n      delivery_date: d.delivery_date,\n      schedule_date: d.schedule_date,\n      conversion_factor: d.conversion_factor,\n      qty: d.qty,\n      rate: d.rate,\n      uom: d.uom,\n      fg_item: d.fg_item,\n      fg_item_qty: d.fg_item_qty,\n    };\n  });\n\n  const fields = [\n    {\n      fieldtype: 'Data',\n      fieldname: 'docname',\n      read_only: 1,\n      hidden: 1,\n    },\n    {\n      fieldtype: 'Link',\n      fieldname: 'item_code',\n      options: 'Item',\n      in_list_view: 1,\n      read_only: 0,\n      disabled: 0,\n      label: __('Item Code'),\n      get_query: function () {\n        let filters;\n        if (frm.doc.doctype == 'Sales Order') {\n          filters = { is_sales_item: 1 };\n        } else if (frm.doc.doctype == 'Purchase Order') {\n          if (frm.doc.is_subcontracted) {\n            if (frm.doc.is_old_subcontracting_flow) {\n              filters = { is_sub_contracted_item: 1 };\n            } else {\n              filters = { is_stock_item: 0 };\n            }\n          } else {\n            filters = { is_purchase_item: 1 };\n          }\n        }\n        return {\n          query: 'stock.controllers.queries.item_query',\n          filters: filters,\n        };\n      },\n    },\n    {\n      fieldtype: 'Link',\n      fieldname: 'uom',\n      options: 'UOM',\n      read_only: 0,\n      label: __('UOM'),\n      reqd: 1,\n      onchange: function () {\n        frappe.call({\n          method: 'stock.stock.get_item_details.get_conversion_factor',\n          args: { item_code: this.doc.item_code, uom: this.value },\n          callback: (r) => {\n            if (!r.exc) {\n              if (this.doc.conversion_factor == r.message.conversion_factor)\n                return;\n\n              const docname = this.doc.docname;\n              dialog.fields_dict.trans_items.df.data.some((doc) => {\n                if (doc.docname == docname) {\n                  doc.conversion_factor = r.message.conversion_factor;\n                  dialog.fields_dict.trans_items.grid.refresh();\n                  return true;\n                }\n              });\n            }\n          },\n        });\n      },\n    },\n    {\n      fieldtype: 'Float',\n      fieldname: 'qty',\n      default: 0,\n      read_only: 0,\n      in_list_view: 1,\n      label: __('Qty'),\n      precision: get_precision('qty'),\n    },\n    {\n      fieldtype: 'Currency',\n      fieldname: 'rate',\n      options: 'currency',\n      default: 0,\n      read_only: 0,\n      in_list_view: 1,\n      label: __('Rate'),\n      precision: get_precision('rate'),\n    },\n  ];\n\n  if (frm.doc.doctype == 'Sales Order' || frm.doc.doctype == 'Purchase Order') {\n    fields.splice(2, 0, {\n      fieldtype: 'Date',\n      fieldname:\n        frm.doc.doctype == 'Sales Order' ? 'delivery_date' : 'schedule_date',\n      in_list_view: 1,\n      label:\n        frm.doc.doctype == 'Sales Order'\n          ? __('Delivery Date')\n          : __('Reqd by date'),\n      reqd: 1,\n    });\n    fields.splice(3, 0, {\n      fieldtype: 'Float',\n      fieldname: 'conversion_factor',\n      label: __('Conversion Factor'),\n      precision: get_precision('conversion_factor'),\n    });\n  }\n\n  if (\n    frm.doc.doctype == 'Purchase Order' &&\n    frm.doc.is_subcontracted &&\n    !frm.doc.is_old_subcontracting_flow\n  ) {\n    fields.push(\n      {\n        fieldtype: 'Link',\n        fieldname: 'fg_item',\n        options: 'Item',\n        reqd: 1,\n        in_list_view: 0,\n        read_only: 0,\n        disabled: 0,\n        label: __('Finished Good Item'),\n        get_query: () => {\n          return {\n            filters: {\n              is_stock_item: 1,\n              is_sub_contracted_item: 1,\n              default_bom: ['!=', ''],\n            },\n          };\n        },\n      },\n      {\n        fieldtype: 'Float',\n        fieldname: 'fg_item_qty',\n        reqd: 1,\n        default: 0,\n        read_only: 0,\n        in_list_view: 0,\n        label: __('Finished Good Item Qty'),\n        precision: get_precision('fg_item_qty'),\n      }\n    );\n  }\n\n  let dialog = new frappe.ui.Dialog({\n    title: __('Update Items'),\n    size: 'extra-large',\n    fields: [\n      {\n        fieldname: 'trans_items',\n        fieldtype: 'Table',\n        label: 'Items',\n        cannot_add_rows: cannot_add_row,\n        in_place_edit: false,\n        reqd: 1,\n        data: this.data,\n        get_data: () => {\n          return this.data;\n        },\n        fields: fields,\n      },\n    ],\n    primary_action: function () {\n      if (frm.doctype == 'Sales Order' && has_reserved_stock) {\n        this.hide();\n        frappe.confirm(\n          __(\n            'The reserved stock will be released when you update items. Are you certain you wish to proceed?'\n          ),\n          () => this.update_items()\n        );\n      } else {\n        this.update_items();\n      }\n    },\n    update_items: function () {\n      const trans_items = this.get_values()['trans_items'].filter(\n        (item) => !!item.item_code\n      );\n      frappe.call({\n        method: 'stock.controllers.accounts_controller.update_child_qty_rate',\n        freeze: true,\n        args: {\n          parent_doctype: frm.doc.doctype,\n          trans_items: trans_items,\n          parent_doctype_name: frm.doc.name,\n          child_docname: child_docname,\n        },\n        callback: function () {\n          frm.reload_doc();\n        },\n      });\n      this.hide();\n      refresh_field('items');\n    },\n    primary_action_label: __('Update'),\n  });\n\n  dialog.show();\n};\n\nstock.utils.map_current_doc = function (opts) {\n  function _map() {\n    if ($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n      // remove first item row if empty\n      if (!cur_frm.doc.items[0].item_code) {\n        cur_frm.doc.items = cur_frm.doc.items.splice(1);\n      }\n\n      // find the doctype of the items table\n      var items_doctype = frappe.meta.get_docfield(\n        cur_frm.doctype,\n        'items'\n      ).options;\n\n      // find the link fieldname from items table for the given\n      // source_doctype\n      var link_fieldname = null;\n      frappe.get_meta(items_doctype).fields.forEach(function (d) {\n        if (d.options === opts.source_doctype) link_fieldname = d.fieldname;\n      });\n\n      // search in existing items if the source_name is already set and full qty fetched\n      var already_set = false;\n      var item_qty_map = {};\n\n      $.each(cur_frm.doc.items, function (i, d) {\n        opts.source_name.forEach(function (src) {\n          if (d[link_fieldname] == src) {\n            already_set = true;\n            if (item_qty_map[d.item_code])\n              item_qty_map[d.item_code] += flt(d.qty);\n            else item_qty_map[d.item_code] = flt(d.qty);\n          }\n        });\n      });\n\n      if (already_set) {\n        opts.source_name.forEach(function (src) {\n          frappe.model.with_doc(opts.source_doctype, src, function (r) {\n            var source_doc = frappe.model.get_doc(opts.source_doctype, src);\n            $.each(source_doc.items || [], function (i, row) {\n              if (row.qty > flt(item_qty_map[row.item_code])) {\n                already_set = false;\n                return false;\n              }\n            });\n          });\n\n          if (already_set) {\n            frappe.msgprint(\n              __('You have already selected items from {0} {1}', [\n                opts.source_doctype,\n                src,\n              ])\n            );\n            return;\n          }\n        });\n      }\n    }\n\n    return frappe.call({\n      // Sometimes we hit the limit for URL length of a GET request\n      // as we send the full target_doc. Hence this is a POST request.\n      type: 'POST',\n      method: 'frappe.model.mapper.map_docs',\n      args: {\n        method: opts.method,\n        source_names: opts.source_name,\n        target_doc: cur_frm.doc,\n        args: opts.args,\n      },\n      freeze: true,\n      freeze_message: __('Mapping {0} ...', [opts.source_doctype]),\n      callback: function (r) {\n        if (!r.exc) {\n          frappe.model.sync(r.message);\n          cur_frm.dirty();\n          cur_frm.refresh();\n        }\n      },\n    });\n  }\n\n  let query_args = {};\n  if (opts.get_query_filters) {\n    query_args.filters = opts.get_query_filters;\n  }\n\n  if (opts.get_query_method) {\n    query_args.query = opts.get_query_method;\n  }\n\n  if (query_args.filters || query_args.query) {\n    opts.get_query = () => query_args;\n  }\n\n  if (opts.source_doctype) {\n    let data_fields = [];\n    if (opts.source_doctype == 'Purchase Receipt') {\n      data_fields.push({\n        fieldname: 'merge_taxes',\n        fieldtype: 'Check',\n        label: __('Merge taxes from multiple documents'),\n      });\n    }\n    const d = new frappe.ui.form.MultiSelectDialog({\n      doctype: opts.source_doctype,\n      target: opts.target,\n      date_field: opts.date_field || undefined,\n      setters: opts.setters,\n      data_fields: data_fields,\n      get_query: opts.get_query,\n      add_filters_group: 1,\n      allow_child_item_selection: opts.allow_child_item_selection,\n      child_fieldname: opts.child_fieldname,\n      child_columns: opts.child_columns,\n      size: opts.size,\n      action: function (selections, args) {\n        let values = selections;\n        if (values.length === 0) {\n          frappe.msgprint(__('Please select {0}', [opts.source_doctype]));\n          return;\n        }\n        opts.source_name = values;\n        if (\n          opts.allow_child_item_selection ||\n          opts.source_doctype == 'Purchase Receipt'\n        ) {\n          // args contains filtered child docnames\n          opts.args = args;\n        }\n        d.dialog.hide();\n        _map();\n      },\n    });\n\n    return d;\n  }\n\n  if (opts.source_name) {\n    opts.source_name = [opts.source_name];\n    _map();\n  }\n};\n\nfrappe.form.link_formatters['Item'] = function (value, doc) {\n  if (\n    doc &&\n    value &&\n    doc.item_name &&\n    doc.item_name !== value &&\n    doc.item_code === value\n  ) {\n    return value + ': ' + doc.item_name;\n  } else if (!value && doc.doctype && doc.item_name) {\n    // format blank value in child table\n    return doc.item_name;\n  } else {\n    // if value is blank in report view or item code and name are the same, return as is\n    return value;\n  }\n};\n\nfrappe.form.link_formatters['Employee'] = function (value, doc) {\n  if (\n    doc &&\n    value &&\n    doc.employee_name &&\n    doc.employee_name !== value &&\n    doc.employee === value\n  ) {\n    return value + ': ' + doc.employee_name;\n  } else if (!value && doc.doctype && doc.employee_name) {\n    // format blank value in child table\n    return doc.employee;\n  } else {\n    // if value is blank in report view or project name and name are the same, return as is\n    return value;\n  }\n};\n\nfrappe.form.link_formatters['Project'] = function (value, doc) {\n  if (\n    doc &&\n    value &&\n    doc.project_name &&\n    doc.project_name !== value &&\n    doc.project === value\n  ) {\n    return value + ': ' + doc.project_name;\n  } else if (!value && doc.doctype && doc.project_name) {\n    // format blank value in child table\n    return doc.project;\n  } else {\n    // if value is blank in report view or project name and name are the same, return as is\n    return value;\n  }\n};\n\n// add description on posting time\n$(document).on('app_ready', function () {\n  if (!frappe.datetime.is_timezone_same()) {\n    $.each(\n      [\n        'Stock Reconciliation',\n        'Stock Entry',\n        'Stock Ledger Entry',\n        'Delivery Note',\n        'Purchase Receipt',\n        'Sales Invoice',\n      ],\n      function (i, d) {\n        frappe.ui.form.on(d, 'onload', function (frm) {\n          cur_frm.set_df_property(\n            'posting_time',\n            'description',\n            frappe.sys_defaults.time_zone\n          );\n        });\n      }\n    );\n  }\n});\n\n// Show SLA dashboard\n$(document).on('app_ready', function () {\n  $.each(frappe.boot.service_level_agreement_doctypes, function (_i, d) {\n    frappe.ui.form.on(d, {\n      onload: function (frm) {\n        if (!frm.doc.service_level_agreement) return;\n\n        frappe.call({\n          method:\n            'stock.support.doctype.service_level_agreement.service_level_agreement.get_service_level_agreement_filters',\n          args: {\n            doctype: frm.doc.doctype,\n            name: frm.doc.service_level_agreement,\n            customer: frm.doc.customer,\n          },\n          callback: function (r) {\n            if (r && r.message) {\n              frm.set_query('priority', function () {\n                return {\n                  filters: {\n                    name: ['in', r.message.priority],\n                  },\n                };\n              });\n              frm.set_query('service_level_agreement', function () {\n                return {\n                  filters: {\n                    name: ['in', r.message.service_level_agreements],\n                  },\n                };\n              });\n            }\n          },\n        });\n      },\n\n      refresh: function (frm) {\n        if (\n          frm.doc.status !== 'Closed' &&\n          frm.doc.service_level_agreement &&\n          ['First Response Due', 'Resolution Due'].includes(\n            frm.doc.agreement_status\n          )\n        ) {\n          frappe.call({\n            method: 'frappe.client.get',\n            args: {\n              doctype: 'Service Level Agreement',\n              name: frm.doc.service_level_agreement,\n            },\n            callback: function (data) {\n              let statuses = data.message.pause_sla_on;\n              const hold_statuses = [];\n              $.each(statuses, (_i, entry) => {\n                hold_statuses.push(entry.status);\n              });\n              if (hold_statuses.includes(frm.doc.status)) {\n                frm.dashboard.clear_headline();\n                let message = {\n                  indicator: 'orange',\n                  msg: __('SLA is on hold since {0}', [\n                    moment(frm.doc.on_hold_since).fromNow(true),\n                  ]),\n                };\n                frm.dashboard.set_headline_alert(\n                  '<div class=\"row\">' +\n                    '<div class=\"col-xs-12\">' +\n                    '<span class=\"indicator whitespace-nowrap ' +\n                    message.indicator +\n                    '\"><span>' +\n                    message.msg +\n                    '</span></span> ' +\n                    '</div>' +\n                    '</div>'\n                );\n              } else {\n                set_time_to_resolve_and_response(\n                  frm,\n                  data.message.apply_sla_for_resolution\n                );\n              }\n            },\n          });\n        } else if (frm.doc.service_level_agreement) {\n          frm.dashboard.clear_headline();\n\n          let agreement_status =\n            frm.doc.agreement_status == 'Fulfilled'\n              ? {\n                  indicator: 'green',\n                  msg: 'Service Level Agreement has been fulfilled',\n                }\n              : { indicator: 'red', msg: 'Service Level Agreement Failed' };\n\n          frm.dashboard.set_headline_alert(\n            '<div class=\"row\">' +\n              '<div class=\"col-xs-12\">' +\n              '<span class=\"indicator whitespace-nowrap ' +\n              agreement_status.indicator +\n              '\"><span class=\"hidden-xs\">' +\n              agreement_status.msg +\n              '</span></span> ' +\n              '</div>' +\n              '</div>'\n          );\n        }\n      },\n    });\n  });\n});\n\nfunction set_time_to_resolve_and_response(frm, apply_sla_for_resolution) {\n  frm.dashboard.clear_headline();\n\n  let time_to_respond;\n  if (!frm.doc.first_responded_on) {\n    time_to_respond = get_time_left(\n      frm.doc.response_by,\n      frm.doc.agreement_status\n    );\n  } else {\n    time_to_respond = get_status(\n      frm.doc.response_by,\n      frm.doc.first_responded_on\n    );\n  }\n\n  let alert = `\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-xs-12 col-sm-6\">\n\t\t\t\t<span class=\"indicator whitespace-nowrap ${time_to_respond.indicator}\">\n\t\t\t\t\t<span>Time to Respond: ${time_to_respond.diff_display}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\n  if (apply_sla_for_resolution) {\n    let time_to_resolve;\n    if (!frm.doc.resolution_date) {\n      time_to_resolve = get_time_left(\n        frm.doc.resolution_by,\n        frm.doc.agreement_status\n      );\n    } else {\n      time_to_resolve = get_status(\n        frm.doc.resolution_by,\n        frm.doc.resolution_date\n      );\n    }\n\n    alert += `\n\t\t\t<div class=\"col-xs-12 col-sm-6\">\n\t\t\t\t<span class=\"indicator whitespace-nowrap ${time_to_resolve.indicator}\">\n\t\t\t\t\t<span>Time to Resolve: ${time_to_resolve.diff_display}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n  }\n\n  alert += '</div>';\n\n  frm.dashboard.set_headline_alert(alert);\n}\n\nfunction get_time_left(timestamp, agreement_status) {\n  const diff = moment(timestamp).diff(frappe.datetime.system_datetime(true));\n  const diff_display =\n    diff >= 44500 ? moment.duration(diff).humanize() : 'Failed';\n  let indicator =\n    diff_display == 'Failed' && agreement_status != 'Fulfilled'\n      ? 'red'\n      : 'green';\n  return { diff_display: diff_display, indicator: indicator };\n}\n\nfunction get_status(expected, actual) {\n  const time_left = moment(expected).diff(moment(actual));\n  if (time_left >= 0) {\n    return { diff_display: 'Fulfilled', indicator: 'green' };\n  } else {\n    return { diff_display: 'Failed', indicator: 'red' };\n  }\n}\n\nfunction attach_selector_button(inner_text, append_loction, context, grid_row) {\n  let $btn_div = $('<div>')\n    .css({ 'margin-bottom': '10px', 'margin-top': '10px' })\n    .appendTo(append_loction);\n  let $btn = $(\n    `<button class=\"btn btn-sm btn-default\">${inner_text}</button>`\n  ).appendTo($btn_div);\n\n  $btn.on('click', function () {\n    context.show_serial_batch_selector(\n      grid_row.frm,\n      grid_row.doc,\n      '',\n      '',\n      true\n    );\n  });\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"stock.queries\");\n$.extend(stock.queries, {\n\tuser: function() {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function() {\n\t\treturn { query: \"stock.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function() {\n\t\treturn { query: \"stock.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function() {\n\t\treturn { query: \"stock.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function(filters) {\n\t\tvar args = { query: \"stock.controllers.queries.item_query\" };\n\t\tif(filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function() {\n\t\treturn { query: \"stock.controllers.queries.bom\" };\n\t},\n\n\ttask: function() {\n\t\treturn { query: \"stock.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function(doc) {\n\t\tif(!doc.customer) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tdispatch_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tsupplier_filter: function(doc) {\n\t\tif(!doc.supplier) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function(doc) {\n\t\tif(!doc.lead) {\n\t\t\tfrappe.throw(__(\"Please specify a {0}\",\n\t\t\t\t[__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function() {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function() {\n\t\treturn { query: \"stock.controllers.queries.employee_query\" }\n\t},\n\n\twarehouse: function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\",0]\n\n\t\t\t]\n\t\t};\n\t},\n\n\tget_filtered_dimensions: function(doc, child_fields, dimension, company) {\n\t\tlet account = '';\n\n\t\tchild_fields.forEach((field) => {\n\t\t\tif (!account) {\n\t\t\t\taccount = doc[field];\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tquery: \"stock.controllers.queries.get_filtered_dimensions\",\n\t\t\tfilters: {\n\t\t\t\t'dimension': dimension,\n\t\t\t\t'account': account,\n\t\t\t\t'company': company\n\t\t\t}\n\t\t};\n\t}\n});\n\nstock.queries.setup_queries = function(frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function(doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name,\n\t\t\t{\"fieldtype\": \"Link\", \"options\": options});\n\t\t$.each(link_fields, function(i, df) {\n\t\t\tif(parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(frappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, {\"fieldtype\": \"Table\"}),\n\t\tfunction(i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t});\n}\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nstock.queries.setup_warehouse_query = function(frm){\n\tfrm.set_query('warehouse', 'items', function(doc, cdt, cdn) {\n\t\tvar row  = locals[cdt][cdn];\n\t\tvar filters = stock.queries.warehouse(frm.doc);\n\t\tif(row.item_code){\n\t\t\t$.extend(filters, {\"query\":\"stock.controllers.queries.warehouse_query\"});\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters\n\t});\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nstock.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function() {\n\t\tvar default_msg = {\n\t\t\t'Lead'\t\t\t\t: '',\n\t\t\t'Opportunity'\t\t\t: 'Your enquiry has been logged into the system. Ref No: ' + doc.name,\n\t\t\t'Quotation'\t\t\t: 'Quotation ' + doc.name + ' has been sent via email. Thanks!',\n\t\t\t'Sales Order'\t\t: 'Sales Order ' + doc.name + ' has been created against '\n\t\t\t\t\t\t+ (doc.quotation_no ? ('Quote No:' + doc.quotation_no) : '')\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Delivery Note'\t\t: 'Items has been delivered against delivery note: ' + doc.name\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Sales Invoice': 'Invoice ' + doc.name + ' has been sent via email '\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Material Request'\t\t\t: 'Material Request ' + doc.name + ' has been raised in the system',\n\t\t\t'Purchase Order'\t: 'Purchase Order ' + doc.name + ' has been sent via email',\n\t\t\t'Purchase Receipt'\t: 'Items has been received against purchase receipt: ' + doc.name\n\t\t}\n\n\t\tif (in_list(['Sales Order', 'Delivery Note', 'Sales Invoice'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.customer, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype === 'Quotation')\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.party_name, '', default_msg[doc.doctype]);\n\t\telse if (in_list(['Purchase Order', 'Purchase Receipt'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Supplier', doc.supplier, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Lead')\n\t\t\tthis.show('', '', '', doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Opportunity')\n\t\t\tthis.show('', '', '', doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Material Request')\n\t\t\tthis.show('', '', '', '', default_msg[doc.doctype]);\n\n\t};\n\n\tthis.get_contact_number = function(contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) { frappe.msgprint(r.exc); return; }\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.show = function(contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact){\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name)\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t}\n\tthis.show_dialog = function() {\n\t\tif(!me.dialog)\n\t\t\tme.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\t'message': me.message,\n\t\t\t'number': me.number\n\t\t})\n\t\tme.dialog.show();\n\t}\n\tthis.make_dialog = function() {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Send SMS',\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'number', fieldtype:'Data', label:'Mobile Number', reqd:1},\n\t\t\t\t{fieldname:'message', fieldtype:'Text', label:'Message', reqd:1},\n\t\t\t\t{fieldname:'send', fieldtype:'Button', label:'Send'}\n\t\t\t]\n\t\t})\n\t\td.fields_dict.send.input.onclick = function() {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif(v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif(r.exc) {frappe.msgprint(r.exc); return; }\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.dialog = d;\n\t}\n\tthis.setup();\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"stock.utils\");\n\nconst SALES_DOCTYPES = ['Quotation', 'Sales Order', 'Delivery Note', 'Sales Invoice'];\nconst PURCHASE_DOCTYPES = ['Supplier Quotation','Purchase Order', 'Purchase Receipt', 'Purchase Invoice'];\n\nstock.utils.get_party_details = function(frm, method, args, callback) {\n\t// if (!method) {\n\t// \tmethod = \"stock.accounts.party.get_party_details\";\n\t// }\n\n\tif (!args) {\n\t\tif ((frm.doctype != \"Purchase Order\" && frm.doc.customer)\n\t\t\t|| (frm.doc.party_name && in_list(['Quotation', 'Opportunity'], frm.doc.doctype))) {\n\n\t\t\tlet party_type = \"Customer\";\n\t\t\tif (frm.doc.quotation_to && in_list([\"Lead\", \"Prospect\"], frm.doc.quotation_to)) {\n\t\t\t\tparty_type = frm.doc.quotation_to;\n\t\t\t}\n\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\tparty_type: party_type,\n\t\t\t\tprice_list: frm.doc.selling_price_list\n\t\t\t};\n\t\t} else if (frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list\n\t\t\t};\n\t\t}\n\n\t\tif (!args) {\n\t\t\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\t\tparty_type: 'Customer'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\t\tparty_type: 'Supplier'\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!args || !args.party) return;\n\n\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\targs.fetch_payment_terms_template = cint(!frm.doc.ignore_default_payment_terms_template);\n\t}\n\n\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.company_address) {\n\t\t\targs.company_address = frm.doc.company_address;\n\t\t}\n\t}\n\n\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.billing_address) {\n\t\t\targs.company_address = frm.doc.billing_address;\n\t\t}\n\n\t\tif (!args.shipping_address && frm.doc.shipping_address) {\n\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t}\n\t}\n\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!stock.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\targs.posting_date, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) return;\n\t}\n\n\tif (!stock.utils.validate_mandatory(frm, \"Company\", frm.doc.company, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) {\n\t\treturn;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif (callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\tstock.utils.add_item(frm);\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n}\n\nstock.utils.add_item = function(frm) {\n\tif (frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif (prev_route[1]==='Item' && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child('items');\n\t\t\tfrm.refresh_field('items');\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, 'item_code', prev_route[2]);\n\t\t}\n\t}\n}\n\nstock.utils.get_address_display = function(frm, address_field, display_field, is_your_company_address) {\n\tif (frm.updating_party_details) return;\n\n\tif (!address_field) {\n\t\tif (frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if (frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif (!display_field) display_field = \"address_display\";\n\tif (frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\"address_dict\": frm.doc[address_field] },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} else {\n\t\tfrm.set_value(display_field, '');\n\t}\n};\n\nstock.utils.set_taxes_from_address = function(frm, triggered_from_field, billing_address_field, shipping_address_field) {\n\tif (frm.updating_party_details) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!stock.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!stock.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"stock.accounts.party.get_address_tax_category\",\n\t\targs: {\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": frm.doc[billing_address_field],\n\t\t\t\"shipping_address\": frm.doc[shipping_address_field]\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (!r.exc){\n\t\t\t\tif (frm.doc.tax_category != r.message) {\n\t\t\t\t\tfrm.set_value(\"tax_category\", r.message);\n\t\t\t\t} else {\n\t\t\t\t\tstock.utils.set_taxes(frm, triggered_from_field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nstock.utils.set_taxes = function(frm, triggered_from_field) {\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!stock.utils.validate_mandatory(frm, \"Company\", frm.doc.company, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!stock.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!stock.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = 'Lead';\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = 'Customer';\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = 'Supplier';\n\t\tparty = frm.doc.supplier;\n\t} else if (frm.doc.quotation_to){\n\t\tparty_type = frm.doc.quotation_to;\n\t\tparty = frm.doc.party_name;\n\t}\n\n\tif (!frm.doc.company) {\n\t\tfrappe.throw(__(\"Kindly select the company first\"));\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"stock.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\t\"party\": party,\n\t\t\t\"party_type\": party_type,\n\t\t\t\"posting_date\": frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\"company\": frm.doc.company,\n\t\t\t\"customer_group\": frm.doc.customer_group,\n\t\t\t\"supplier_group\": frm.doc.supplier_group,\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": ((frm.doc.customer || frm.doc.lead) ? (frm.doc.customer_address) : (frm.doc.supplier_address)),\n\t\t\t\"shipping_address\": frm.doc.shipping_address_name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (r.message){\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message)\n\t\t\t}\n\t\t}\n\t});\n};\n\nstock.utils.get_contact_details = function (frm) {\n\tif (frm.updating_party_details) return;\n\n\tif (frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: { contact: frm.doc.contact_person },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) frm.set_value(r.message);\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrm.set_value({\n\t\t\tcontact_person: \"\",\n\t\t\tcontact_display: \"\",\n\t\t\tcontact_email: \"\",\n\t\t\tcontact_mobile: \"\",\n\t\t\tcontact_phone: \"\",\n\t\t\tcontact_designation: \"\",\n\t\t\tcontact_department: \"\",\n\t\t});\n\t}\n};\n\nstock.utils.validate_mandatory = function(frm, label, value, trigger_on) {\n\tif (!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.throw({message:__(\"Please enter {0} first\", [label]), title:__(\"Mandatory\")});\n\t\treturn false;\n\t}\n\treturn true;\n}\n\n// stock.utils.get_shipping_address = function(frm, callback) {\n// \tif (frm.doc.company) {\n// \t\tif ((frm.doc.inter_company_order_reference || frm.doc.internal_invoice_reference ||\n// \t\t\tfrm.doc.internal_order_reference)) {\n// \t\t\tif (callback) {\n// \t\t\t\treturn callback();\n// \t\t\t}\n// \t\t}\n// \t\tfrappe.call({\n// \t\t\tmethod: \"stock.accounts.custom.address.get_shipping_address\",\n// \t\t\targs: {\n// \t\t\t\tcompany: frm.doc.company,\n// \t\t\t\taddress: frm.doc.shipping_address\n// \t\t\t},\n// \t\t\tcallback: function(r) {\n// \t\t\t\tif (r.message) {\n// \t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]) //Address title or name\n// \t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]) //Address to be displayed on the page\n// \t\t\t\t}\n\n// \t\t\t\tif (callback){\n// \t\t\t\t\treturn callback();\n// \t\t\t\t}\n// \t\t\t}\n// \t\t});\n// \t} else {\n// \t\tfrappe.msgprint(__(\"Select company first\"));\n// \t}\n// }\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"stock.stock\");\n\nstock.stock.StockController = class StockController extends frappe.ui.form.Controller {\n\tonload() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t}\n\n\tsetup_warehouse_query() {\n\t\tvar me = this;\n\t\tstock.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn stock.queries.warehouse(me.frm.doc);\n\t\t});\n\t}\n\n\tsetup_posting_date_time_check() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_stock_ledger() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2,\n\t\t\t\t\tignore_prepared_report: true\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t}\n\n\tshow_general_ledger() {\n\t\tlet me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\",\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2,\n\t\t\t\t\tignore_prepared_report: true\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nstock.payments = class payments extends stock.stock.StockController {\n\tmake_payment() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Payment'\n\t\t});\n\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text();\n\t}\n\n\tselect_text() {\n\t\t$(this.$body).find('.form-control').click(function() {\n\t\t\t$(this).select();\n\t\t});\n\t}\n\n\tset_payment_primary_action() {\n\t\tvar me = this;\n\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function() {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t}\n\n\tmake_keyboard(){\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc))\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event()\n\t\tthis.clear_amount()\n\t}\n\n\tmake_multimode_payment(){\n\t\tvar me = this;\n\n\t\tif (this.frm.doc.change_amount > 0) {\n\t\t\tme.payment_val = me.doc.outstanding_amount;\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t}\n\n\tshow_payment_details(){\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find('.multimode-payments').empty();\n\t\tif (this.frm.doc.payments.length) {\n\t\t\t$.each(this.frm.doc.payments, function(index, data) {\n\t\t\t\t$(frappe.render_template('payment_details', {\n\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\tamount: data.amount,\n\t\t\t\t\tidx: data.idx,\n\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\ttype: data.type\n\t\t\t\t})).appendTo(multimode_payments)\n\n\t\t\t\tif (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t})\n\t\t}else{\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments)\n\t\t}\n\t}\n\n\tset_outstanding_amount(){\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': this.idx}));\n\t\tthis.highlight_selected_row();\n\t\tthis.payment_val = 0.0;\n\t\tif (this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0) {\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision(\"outstanding_amount\"))\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount();\n\t\t} else if (flt(this.selected_mode.val()) > 0) {\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select()\n\t\tthis.bind_amount_change_event();\n\t}\n\n\tbind_keyboard_event(){\n\t\tvar me = this;\n\t\tthis.payment_val = '';\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t}\n\n\tbind_form_control_event() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-payment-row').click(function() {\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t});\n\n\t\t$(this.$body).find('.form-control').click(function() {\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t\tme.update_paid_amount(true);\n\t\t});\n\n\t\t$(this.$body).find('.write_off_amount').change(function() {\n\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t});\n\n\t\t$(this.$body).find('.change_amount').change(function() {\n\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t});\n\t}\n\n\thighlight_selected_row() {\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\", {'idx': this.idx}));\n\t\t$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode');\n\t\tselected_row.addClass('selected-payment-mode');\n\t\t$(this.$body).find('.amount').attr('disabled', true);\n\t\tthis.selected_mode.attr('disabled', false);\n\t}\n\n\tbind_numeric_keys_event() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-keyboard-key').click(function(){\n\t\t\tme.payment_val += $(this).text();\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_paid_amount();\n\t\t});\n\n\t\t$(this.$body).find('.delete-btn').click(function() {\n\t\t\tme.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_paid_amount();\n\t\t})\n\n\t}\n\n\tbind_amount_change_event() {\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function() {\n\t\t\tme.payment_val =  flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_payment_amount();\n\t\t});\n\t}\n\n\tclear_amount() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.clr').click(function(e) {\n\t\t\te.stopPropagation();\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\tme.payment_val = 0.0;\n\t\t\tme.selected_mode.val(0.0);\n\t\t\tme.highlight_selected_row();\n\t\t\tme.update_payment_amount();\n\t\t});\n\t}\n\n\twrite_off_amount(write_off_amount) {\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\"));\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t}\n\n\tchange_amount(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount();\n\t\tthis.show_amounts();\n\t}\n\n\tupdate_paid_amount(update_write_off) {\n\t\tvar me = this;\n\t\tif (in_list(['change_amount', 'write_off_amount'], this.idx)) {\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif (me.idx == 'change_amount') {\n\t\t\t\tme.change_amount(value);\n\t\t\t} else {\n\t\t\t\tif(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.update_payment_amount();\n\t\t}\n\t}\n\n\tupdate_payment_amount(){\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function(index, data) {\n\t\t\tif (cint(me.idx) == cint(data.idx)) {\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2);\n\t\t\t}\n\t\t})\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t}\n\n\tshow_amounts(){\n\t\tvar me = this;\n\t\t$(this.$body).find(\".write_off_amount\").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(\":Company\", this.frm.doc.company).default_currency));\n\t\tthis.update_invoice();\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nstock.taxes_and_totals = class TaxesAndTotals extends stock.payments {\n\tsetup() {\n\t\tthis.fetch_round_off_accounts();\n\t}\n\n\tapply_pricing_rule_on_item(item) {\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tlet item_rate = item.rate;\n\t\tif (in_list([\"Sales Order\", \"Quotation\"], item.parenttype) && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif (item.margin_type == \"Percentage\") {\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem_rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif (item.discount_percentage) {\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t}\n\n\t\tif (item.discount_amount) {\n\t\t\titem_rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t\titem.discount_percentage = 100 * flt(item.discount_amount) / flt(item.rate_with_margin);\n\t\t}\n\n\t\tfrappe.model.set_value(item.doctype, item.name, \"rate\", item_rate);\n\t}\n\n\tasync calculate_taxes_and_totals(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// # Update grand total as per cash and non trade discount\n\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\tthis.frm.doc.grand_total -= this.frm.doc.discount_amount;\n\t\t\tthis.frm.doc.base_grand_total -= this.frm.doc.base_discount_amount;\n\t\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\t\tthis.frm.doc.base_rounding_adjustment = 0;\n\t\t\tthis.set_rounded_total();\n\t\t}\n\n\t\tawait this.calculate_shipping_charges();\n\n\t\t// Advance calculation applicable to Sales/Purchase Invoice\n\t\tif (\n\t\t\tin_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2\n\t\t\t&& !this.frm.doc.is_return\n\t\t) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\tif (\n\t\t\tin_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.is_pos\n\t\t\t&& this.frm.doc.is_return\n\t\t) {\n\t\t\tthis.set_total_amount_to_default_mop();\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\t// Update paid amount on return/debit note creation\n\t\tif (\n\t\t\tthis.frm.doc.doctype === \"Purchase Invoice\"\n\t\t\t&& this.frm.doc.is_return\n\t\t\t&& (this.frm.doc.grand_total > this.frm.doc.paid_amount)\n\t\t) {\n\t\t\tthis.frm.doc.paid_amount = flt(this.frm.doc.grand_total, precision(\"grand_total\"));\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tcalculate_discount_amount() {\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t}\n\n\t_calculate_taxes_and_totals() {\n\t\tconst is_quotation = this.frm.doc.doctype == \"Quotation\";\n\t\tthis.frm._items = is_quotation ? this.filtered_items() : this.frm.doc.items;\n\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\t// this.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t}\n\n\t// validate_conversion_rate() {\n\t// \tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t// \tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t// \t\tthis.frm.doc.name);\n\t// \t// var company_currency = this.get_company_currency();\n\n\t// \tif(!this.frm.doc.conversion_rate) {\n\t// \t\tif(this.frm.doc.currency == company_currency) {\n\t// \t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t// \t\t} else {\n\t// \t\t\tconst subs =  [conversion_rate_label, this.frm.doc.currency, company_currency];\n\t// \t\t\tconst err_message = __('{0} is mandatory. Maybe Currency Exchange record is not created for {1} to {2}', subs);\n\t// \t\t\tfrappe.throw(err_message);\n\t// \t\t}\n\t// \t}\n\t// }\n\n\tcalculate_item_values() {\n\t\tvar me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\tfor (const item of this.frm._items || []) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\t\t\t\titem.qty = item.qty === undefined ? (me.frm.doc.is_return ? -1 : 1) : item.qty;\n\n\t\t\t\tif (!(me.frm.doc.is_return || me.frm.doc.is_debit_note)) {\n\t\t\t\t\titem.net_amount = item.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// allow for '0' qty on Credit/Debit notes\n\t\t\t\t\tlet qty = flt(item.qty);\n\t\t\t\t\tif (!qty) {\n\t\t\t\t\t\tqty = (me.frm.doc.is_debit_note ? 1 : -1);\n\t\t\t\t\t\tif (me.frm.doc.doctype !== \"Purchase Receipt\" && me.frm.doc.is_return === 1) {\n\t\t\t\t\t\t\t// In case of Purchase Receipt, qty can be 0 if all items are rejected\n\t\t\t\t\t\t\tqty = flt(item.qty);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\titem.net_amount = item.amount = flt(item.rate * qty, precision(\"amount\", item));\n\t\t\t\t}\n\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t}\n\t}\n\n\tset_in_company_currency(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t}\n\n\t// initialize_taxes() {\n\t// \tvar me = this;\n\n\t// \t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t// \t\tif (!tax.dont_recompute_tax) {\n\t// \t\t\ttax.item_wise_tax_detail = {};\n\t// \t\t}\n\t// \t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t// \t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t// \t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t// \t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t// \t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t// \t\t\ttax_fields.push(\"tax_amount\");\n\t// \t\t}\n\n\t// \t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t// \t\tif (!this.discount_amount_applied) {\n\t// \t\t\tstock.accounts.taxes.validate_taxes_and_charges(tax.doctype, tax.name);\n\t// \t\t\tstock.accounts.taxes.validate_inclusive_tax(tax);\n\t// \t\t}\n\t// \t\tfrappe.model.round_floats_in(tax);\n\t// \t});\n\t// }\n\n\tfetch_round_off_accounts() {\n\t\tlet me = this;\n\t\tfrappe.flags.round_off_applicable_accounts = [];\n\n\t\tif (me.frm.doc.company) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"stock.controllers.taxes_and_totals.get_round_off_applicable_accounts\",\n\t\t\t\t\"args\": {\n\t\t\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\t\t\"account_list\": frappe.flags.round_off_applicable_accounts\n\t\t\t\t},\n\t\t\t\tcallback(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tfrappe.flags.round_off_applicable_accounts.push(...r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// frappe.db.get_single_value(\"Accounts Settings\", \"round_row_wise_tax\")\n\t\t// \t.then((round_row_wise_tax) => {\n\t\t// \t\tfrappe.flags.round_row_wise_tax = round_row_wise_tax;\n\t\t// \t})\n\t}\n\n\tdetermine_exclusive_rate() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm._items || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\t\t\tvar total_inclusive_tax_amount_per_qty = 0;\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tvar current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n\t\t\t\ttax.tax_fraction_for_current_item = current_tax_fraction[0];\n\t\t\t\tvar inclusive_tax_amount_per_qty = current_tax_fraction[1];\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t\ttotal_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n\t\t\t});\n\n\t\t\tif(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n\t\t\t\tvar amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n\t\t\t\titem.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t}\n\n\tget_current_tax_fraction(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\t\tvar inclusive_tax_amount_per_qty = 0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t\tinclusive_tax_amount_per_qty = flt(tax_rate);\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax && tax.add_deduct_tax == \"Deduct\") {\n\t\t\tcurrent_tax_fraction *= -1;\n\t\t\tinclusive_tax_amount_per_qty *= -1;\n\t\t}\n\t\treturn [current_tax_fraction, inclusive_tax_amount_per_qty];\n\t}\n\n\t_get_tax_rate(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t}\n\n\tcalculate_net_total() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm._items || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t});\n\t}\n\n\tcalculate_shipping_charges() {\n\t\t// Do not apply shipping rule for POS\n\t\tif (this.frm.doc.is_pos) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"shipping_rule\", this.frm.doc.name)) {\n\t\t\treturn this.shipping_rule();\n\t\t}\n\t}\n\n\tadd_taxes_from_item_tax_template(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif (item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif (typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif (!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculate_taxes() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm._items || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\t\t\t\tif (frappe.flags.round_row_wise_tax) {\n\t\t\t\t\tcurrent_tax_amount = flt(current_tax_amount, precision(\"tax_amount\", tax));\n\t\t\t\t}\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm._items.length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm._items.length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\tme.round_off_base_values(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax, [\"total\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tset_cumulative_total(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t}\n\n\t_load_item_tax_rate(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t}\n\n\tget_current_tax_amount(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\t// To set row_id by default as previous row.\n\t\tif([\"On Previous Row Amount\", \"On Previous Row Total\"].includes(tax.charge_type)) {\n\t\t\tif (tax.idx === 1) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\"));\n\t\t\t}\n\t\t\tif (!tax.row_id) {\n\t\t\t\ttax.row_id = tax.idx - 1;\n\t\t\t}\n\t\t}\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\tcurrent_tax_amount = tax_rate * item.qty;\n\t\t}\n\n\t\tif (!tax.dont_recompute_tax) {\n\t\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\t\t}\n\n\t\treturn current_tax_amount;\n\t}\n\n\tset_item_wise_tax(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tif(typeof (tax_detail) == \"string\") {\n\t\t\ttax.item_wise_tax_detail = JSON.parse(tax.item_wise_tax_detail);\n\t\t\ttax_detail = tax.item_wise_tax_detail;\n\t\t}\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (frappe.flags.round_row_wise_tax) {\n\t\t\titem_wise_tax_amount = flt(item_wise_tax_amount, precision(\"tax_amount\", tax));\n\t\t\tif (tax_detail && tax_detail[key]) {\n\t\t\t\titem_wise_tax_amount += flt(tax_detail[key][1], precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t} else {\n\t\t\tif (tax_detail && tax_detail[key])\n\t\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\t\t}\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t}\n\n\tround_off_totals(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.tax_amount= Math.round(tax.tax_amount);\n\t\t\ttax.tax_amount_after_discount_amount = Math.round(tax.tax_amount_after_discount_amount);\n\t\t}\n\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t}\n\n\tround_off_base_values(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.base_tax_amount= Math.round(tax.base_tax_amount);\n\t\t\ttax.base_tax_amount_after_discount_amount = Math.round(tax.base_tax_amount_after_discount_amount);\n\t\t}\n\t}\n\n\tmanipulate_grand_total_for_inclusive_tax() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif(me.discount_amount_applied && me.frm.doc.discount_amount) {\n\t\t\t\t\tdiff -= flt(me.frm.doc.discount_amount);\n\t\t\t\t}\n\n\t\t\t\tdiff = flt(diff, precision(\"rounding_adjustment\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tme.frm.doc.rounding_adjustment = diff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_totals() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t}\n\n\tset_rounded_total() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t}\n\n\t_cleanup() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\t\tlet items = this.frm._items;\n\n\t\tif(items && items.length) {\n\t\t\tif(!frappe.meta.get_docfield(items[0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(items || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tset_discount_amount() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t}\n\n\tapply_discount_amount() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm._items || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm._items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t}\n\n\tget_total_for_discount_amount() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (in_list([\"Actual\", \"On Item Quantity\"], tax.charge_type)) {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t}\n\n\tcalculate_total_advance(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tif (this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = 0;\n\t\t}\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t\tthis.calculate_write_off_amount();\n\t}\n\n\tis_internal_invoice() {\n\t\tif (['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tif (this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalculate_outstanding_amount(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif (this.frm.doc.is_return || (this.frm.doc.docstatus > 0) || this.is_internal_invoice()) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(base_grand_total, precision(\"base_grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t}\n\n\tset_total_amount_to_default_mop() {\n\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\tif (this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\tgrand_total - this.frm.doc.total_advance - this.frm.doc.write_off_amount,\n\t\t\t\tprecision(\"grand_total\")\n\t\t\t);\n\t\t} else {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t(\n\t\t\t\t\tflt(\n\t\t\t\t\t\tbase_grand_total,\n\t\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t\t)\n\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount\n\t\t\t\t),\n\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t);\n\t\t}\n\n\t\tif(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments.find(payment => {\n\t\t\t\tif (payment.default) {\n\t\t\t\t\tpayment.amount = total_amount_to_pay;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tset_default_payment(total_amount_to_pay, update_paid_amount) {\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data) {\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tlet base_amount, amount;\n\n\t\t\t\t\tif (me.frm.doc.party_account_currency == me.frm.doc.currency) {\n\t\t\t\t\t\t// if customer/supplier currency is same as company currency\n\t\t\t\t\t\t// total_amount_to_pay is already in customer/supplier currency\n\t\t\t\t\t\t// so base_amount has to be calculated using total_amount_to_pay\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay, precision(\"amount\", data));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\", data));\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"base_amount\", base_amount);\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", amount);\n\t\t\t\t\tpayment_status = false;\n\n\t\t\t\t} else if(me.frm.doc.paid_amount) {\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", 0.0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculate_paid_amount() {\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.set_value('paid_amount', flt(paid_amount, precision(\"paid_amount\")));\n\t\tthis.frm.set_value('base_paid_amount', flt(base_paid_amount, precision(\"base_paid_amount\")));\n\t}\n\n\tcalculate_change_amount(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total,\n\t\t\t\t\tprecision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total, precision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_write_off_amount() {\n\t\tif(this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.outstanding_amount, precision(\"write_off_amount\"));\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\n\t\t\tthis.calculate_outstanding_amount(false);\n\t\t}\n\n\t}\n\n\tfiltered_items() {\n\t\treturn this.frm.doc.items.filter(item => !item[\"is_alternative\"]);\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nstock.TransactionController = class TransactionController extends (\n  stock.taxes_and_totals\n) {\n  setup() {\n    super.setup();\n    let me = this;\n\n    this.frm.ignore_doctypes_on_cancel_all = ['Serial and Batch Bundle'];\n\n    frappe.flags.hide_serial_batch_dialog = true;\n    frappe.ui.form.on(\n      this.frm.doctype + ' Item',\n      'rate',\n      function (frm, cdt, cdn) {\n        var item = frappe.get_doc(cdt, cdn);\n        var has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n        frappe.model.round_floats_in(item, ['rate', 'price_list_rate']);\n\n        if (item.price_list_rate) {\n          if (item.rate > item.price_list_rate && has_margin_field) {\n            // if rate is greater than price_list_rate, set margin\n            // or set discount\n            item.discount_percentage = 0;\n            item.margin_type = 'Amount';\n            item.margin_rate_or_amount = flt(\n              item.rate - item.price_list_rate,\n              precision('margin_rate_or_amount', item)\n            );\n            item.rate_with_margin = item.rate;\n          } else {\n            item.discount_percentage = flt(\n              (1 - item.rate / item.price_list_rate) * 100.0,\n              precision('discount_percentage', item)\n            );\n            item.discount_amount = flt(item.price_list_rate) - flt(item.rate);\n            item.margin_type = '';\n            item.margin_rate_or_amount = 0;\n            item.rate_with_margin = 0;\n          }\n        } else {\n          item.discount_percentage = 0.0;\n          item.margin_type = '';\n          item.margin_rate_or_amount = 0;\n          item.rate_with_margin = 0;\n        }\n        item.base_rate_with_margin =\n          item.rate_with_margin * flt(frm.doc.conversion_rate);\n\n        cur_frm.cscript.set_gross_profit(item);\n        cur_frm.cscript.calculate_taxes_and_totals();\n        cur_frm.cscript.calculate_stock_uom_rate(frm, cdt, cdn);\n      }\n    );\n\n    frappe.ui.form.on(\n      this.frm.cscript.tax_table,\n      'rate',\n      function (frm, cdt, cdn) {\n        cur_frm.cscript.calculate_taxes_and_totals();\n      }\n    );\n\n    frappe.ui.form.on(\n      this.frm.cscript.tax_table,\n      'tax_amount',\n      function (frm, cdt, cdn) {\n        cur_frm.cscript.calculate_taxes_and_totals();\n      }\n    );\n\n    frappe.ui.form.on(\n      this.frm.cscript.tax_table,\n      'row_id',\n      function (frm, cdt, cdn) {\n        cur_frm.cscript.calculate_taxes_and_totals();\n      }\n    );\n\n    frappe.ui.form.on(\n      this.frm.cscript.tax_table,\n      'included_in_print_rate',\n      function (frm, cdt, cdn) {\n        cur_frm.cscript.set_dynamic_labels();\n        cur_frm.cscript.calculate_taxes_and_totals();\n      }\n    );\n\n    frappe.ui.form.on(this.frm.doctype, 'apply_discount_on', function (frm) {\n      if (frm.doc.additional_discount_percentage) {\n        frm.trigger('additional_discount_percentage');\n      } else {\n        cur_frm.cscript.calculate_taxes_and_totals();\n      }\n    });\n\n    frappe.ui.form.on(\n      this.frm.doctype,\n      'additional_discount_percentage',\n      function (frm) {\n        if (!frm.doc.apply_discount_on) {\n          frappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n          return;\n        }\n\n        frm.via_discount_percentage = true;\n\n        if (frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n          // Reset discount amount and net / grand total\n          frm.doc.discount_amount = 0;\n          frm.cscript.calculate_taxes_and_totals();\n        }\n\n        var total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n        var discount_amount = flt(\n          (total * flt(frm.doc.additional_discount_percentage)) / 100,\n          precision('discount_amount')\n        );\n\n        frm\n          .set_value('discount_amount', discount_amount)\n          .then(() => delete frm.via_discount_percentage);\n      }\n    );\n\n    frappe.ui.form.on(this.frm.doctype, 'discount_amount', function (frm) {\n      frm.cscript.set_dynamic_labels();\n\n      if (!frm.via_discount_percentage) {\n        frm.doc.additional_discount_percentage = 0;\n      }\n\n      frm.cscript.calculate_taxes_and_totals();\n    });\n\n    frappe.ui.form.on(this.frm.doctype + ' Item', {\n      items_add: function (frm, cdt, cdn) {\n        var item = frappe.get_doc(cdt, cdn);\n        if (!item.warehouse && frm.doc.set_warehouse) {\n          item.warehouse = frm.doc.set_warehouse;\n        }\n\n        if (!item.target_warehouse && frm.doc.set_target_warehouse) {\n          item.target_warehouse = frm.doc.set_target_warehouse;\n        }\n\n        if (!item.from_warehouse && frm.doc.set_from_warehouse) {\n          item.from_warehouse = frm.doc.set_from_warehouse;\n        }\n      },\n    });\n\n    if (\n      this.frm.fields_dict['items'].grid.get_field('serial_and_batch_bundle')\n    ) {\n      this.frm.set_query(\n        'serial_and_batch_bundle',\n        'items',\n        function (doc, cdt, cdn) {\n          let item_row = locals[cdt][cdn];\n          return {\n            filters: {\n              item_code: item_row.item_code,\n              voucher_type: doc.doctype,\n              voucher_no: ['in', [doc.name, '']],\n              is_cancelled: 0,\n            },\n          };\n        }\n      );\n    }\n\n    if (\n      this.frm.docstatus < 2 &&\n      this.frm.fields_dict['payment_terms_template'] &&\n      this.frm.fields_dict['payment_schedule'] &&\n      this.frm.doc.payment_terms_template &&\n      !this.frm.doc.payment_schedule.length\n    ) {\n      this.frm.trigger('payment_terms_template');\n    }\n\n    if (this.frm.fields_dict['taxes']) {\n      this['taxes_remove'] = this.calculate_taxes_and_totals;\n    }\n\n    if (this.frm.fields_dict['items']) {\n      this['items_remove'] = this.calculate_net_weight;\n    }\n\n    if (this.frm.fields_dict['recurring_print_format']) {\n      this.frm.set_query('recurring_print_format', function (doc) {\n        return {\n          filters: [['Print Format', 'doc_type', '=', cur_frm.doctype]],\n        };\n      });\n    }\n\n    if (this.frm.fields_dict['return_against']) {\n      this.frm.set_query('return_against', function (doc) {\n        var filters = {\n          docstatus: 1,\n          is_return: 0,\n          company: doc.company,\n        };\n        if (me.frm.fields_dict['customer'] && doc.customer)\n          filters['customer'] = doc.customer;\n        if (me.frm.fields_dict['supplier'] && doc.supplier)\n          filters['supplier'] = doc.supplier;\n\n        return {\n          filters: filters,\n        };\n      });\n    }\n\n    if (this.frm.fields_dict['items'].grid.get_field('expense_account')) {\n      this.frm.set_query('expense_account', 'items', function (doc) {\n        return {\n          filters: {\n            company: doc.company,\n            report_type: 'Profit and Loss',\n            is_group: 0,\n          },\n        };\n      });\n    }\n\n    if (frappe.meta.get_docfield(this.frm.doc.doctype, 'pricing_rules')) {\n      this.frm.set_indicator_formatter('pricing_rule', function (doc) {\n        return doc.rule_applied ? 'green' : 'red';\n      });\n    }\n\n    if (this.frm.fields_dict['items'].grid.get_field('blanket_order')) {\n      this.frm.set_query('blanket_order', 'items', function (doc, cdt, cdn) {\n        var item = locals[cdt][cdn];\n        return {\n          query: 'stock.controllers.queries.get_blanket_orders',\n          filters: {\n            company: doc.company,\n            blanket_order_type:\n              doc.doctype === 'Sales Order' ? 'Selling' : 'Purchasing',\n            item: item.item_code,\n          },\n        };\n      });\n    }\n\n    if (this.frm.fields_dict.taxes_and_charges) {\n      this.frm.set_query('taxes_and_charges', function () {\n        return {\n          filters: [\n            ['company', '=', me.frm.doc.company],\n            ['docstatus', '!=', 2],\n          ],\n        };\n      });\n    }\n  }\n\n  toggle_enable_for_stock_uom(field) {\n    frappe.db.get_single_value('Stock Settings', field).then((value) => {\n      this.frm.fields_dict['items'].grid.toggle_enable('stock_qty', value);\n    });\n  }\n\n  onload() {\n    var me = this;\n\n    if (this.frm.doc.__islocal) {\n      var currency = frappe.defaults.get_user_default('currency');\n\n      let set_value = (fieldname, value) => {\n        if (me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n          return me.frm.set_value(fieldname, value);\n        }\n      };\n\n      this.frm.trigger('set_default_internal_warehouse');\n\n      return frappe.run_serially([\n        () => set_value('currency', currency),\n        () => set_value('price_list_currency', currency),\n        () => set_value('status', 'Draft'),\n        () => set_value('is_subcontracted', 0),\n        () => {\n          if (this.frm.doc.company && !this.frm.doc.amended_from) {\n            this.frm.trigger('company');\n          }\n        },\n      ]);\n    }\n\n    if (\n      this.frm.fields_dict['items'].grid.get_field('serial_and_batch_bundle')\n    ) {\n      let sbb_field = this.frm.get_docfield('items', 'serial_and_batch_bundle');\n      if (sbb_field) {\n        sbb_field.get_route_options_for_new_doc = (row) => {\n          return {\n            item_code: row.doc.item_code,\n          };\n        };\n      }\n    }\n\n    if (this.frm.fields_dict['items'].grid.get_field('batch_no')) {\n      let batch_no_field = this.frm.get_docfield('items', 'batch_no');\n      if (batch_no_field) {\n        batch_no_field.get_route_options_for_new_doc = function (row) {\n          return {\n            item: row.doc.item_code,\n          };\n        };\n      }\n    }\n  }\n\n  is_return() {\n    if (!this.frm.doc.is_return && this.frm.doc.return_against) {\n      this.frm.set_value('return_against', '');\n    }\n  }\n\n  setup_quality_inspection() {\n    if (\n      !in_list(\n        [\n          'Delivery Note',\n          'Sales Invoice',\n          'Purchase Receipt',\n          'Purchase Invoice',\n          'Subcontracting Receipt',\n        ],\n        this.frm.doc.doctype\n      )\n    ) {\n      return;\n    }\n\n    const me = this;\n    if (!this.frm.is_new() && this.frm.doc.docstatus === 0) {\n      this.frm.add_custom_button(\n        __('Quality Inspection(s)'),\n        () => {\n          me.make_quality_inspection();\n        },\n        __('Create')\n      );\n      this.frm.page.set_inner_btn_group_as_primary(__('Create'));\n    }\n\n    const inspection_type = in_list(\n      ['Purchase Receipt', 'Purchase Invoice', 'Subcontracting Receipt'],\n      this.frm.doc.doctype\n    )\n      ? 'Incoming'\n      : 'Outgoing';\n\n    let quality_inspection_field = this.frm.get_docfield(\n      'items',\n      'quality_inspection'\n    );\n    quality_inspection_field.get_route_options_for_new_doc = function (row) {\n      if (me.frm.is_new()) return {};\n      return {\n        inspection_type: inspection_type,\n        reference_type: me.frm.doc.doctype,\n        reference_name: me.frm.doc.name,\n        item_code: row.doc.item_code,\n        description: row.doc.description,\n        item_serial_no: row.doc.serial_no\n          ? row.doc.serial_no.split('\\n')[0]\n          : null,\n        batch_no: row.doc.batch_no,\n      };\n    };\n\n    this.frm.set_query('quality_inspection', 'items', function (doc, cdt, cdn) {\n      let d = locals[cdt][cdn];\n      return {\n        filters: {\n          docstatus: 1,\n          inspection_type: inspection_type,\n          reference_name: doc.name,\n          item_code: d.item_code,\n        },\n      };\n    });\n  }\n\n  onload_post_render() {\n    if (\n      this.frm.doc.__islocal &&\n      !(this.frm.doc.taxes || []).length &&\n      !this.frm.doc.__onload?.load_after_mapping\n    ) {\n      frappe.after_ajax(() => this.apply_default_taxes());\n    } else if (\n      this.frm.doc.__islocal &&\n      this.frm.doc.company &&\n      this.frm.doc['items'] &&\n      !this.frm.doc.is_pos\n    ) {\n      frappe.after_ajax(() => this.calculate_taxes_and_totals());\n    }\n    if (frappe.meta.get_docfield(this.frm.doc.doctype + ' Item', 'item_code')) {\n      this.setup_item_selector();\n      this.frm.get_field('items').grid.set_multiple_add('item_code', 'qty');\n    }\n  }\n\n  refresh() {\n    // stock.toggle_naming_series();\n    // stock.hide_company();\n    // this.set_dynamic_labels();\n    this.setup_sms();\n    this.setup_quality_inspection();\n    this.validate_has_items();\n    stock.utils.view_serial_batch_nos(this.frm);\n  }\n\n  scan_barcode() {\n    frappe.flags.dialog_set = false;\n    const barcode_scanner = new stock.utils.BarcodeScanner({ frm: this.frm });\n    barcode_scanner.process_scan();\n  }\n\n  validate_has_items() {\n    let table = this.frm.doc.items;\n    this.frm.has_items =\n      table && table.length && table[0].qty && table[0].item_code;\n  }\n\n  apply_default_taxes() {\n    var me = this;\n    var taxes_and_charges_field = frappe.meta.get_docfield(\n      me.frm.doc.doctype,\n      'taxes_and_charges',\n      me.frm.doc.name\n    );\n\n    if (\n      !this.frm.doc.taxes_and_charges &&\n      this.frm.doc.taxes &&\n      this.frm.doc.taxes.length > 0\n    ) {\n      return;\n    }\n\n    if (taxes_and_charges_field) {\n      return frappe.call({\n        method:\n          'stock.controllers.accounts_controller.get_default_taxes_and_charges',\n        args: {\n          master_doctype: taxes_and_charges_field.options,\n          tax_template: me.frm.doc.taxes_and_charges || '',\n          company: me.frm.doc.company,\n        },\n        debounce: 2000,\n        callback: function (r) {\n          if (!r.exc && r.message) {\n            frappe.run_serially([\n              () => {\n                // directly set in doc, so as not to call triggers\n                if (r.message.taxes_and_charges) {\n                  me.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n                }\n\n                // set taxes table\n                if (r.message.taxes) {\n                  me.frm.set_value('taxes', r.message.taxes);\n                }\n              },\n              () => me.set_dynamic_labels(),\n              () => me.calculate_taxes_and_totals(),\n            ]);\n          }\n        },\n      });\n    }\n  }\n\n  setup_sms() {\n    var me = this;\n    let blacklist = ['Purchase Invoice', 'BOM'];\n    if (\n      this.frm.doc.docstatus === 1 &&\n      !in_list(['Lost', 'Stopped', 'Closed'], this.frm.doc.status) &&\n      !blacklist.includes(this.frm.doctype)\n    ) {\n      this.frm.page.add_menu_item(__('Send SMS'), function () {\n        me.send_sms();\n      });\n    }\n  }\n\n  send_sms() {\n    var sms_man = new stock.SMSManager(this.frm.doc);\n  }\n\n  item_code(doc, cdt, cdn) {\n    var me = this;\n    var item = frappe.get_doc(cdt, cdn);\n    var update_stock = 0,\n      show_batch_dialog = 0;\n\n    item.weight_per_unit = 0;\n    item.weight_uom = '';\n    item.conversion_factor = 0;\n\n    if (['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n      update_stock = cint(me.frm.doc.update_stock);\n      show_batch_dialog = update_stock;\n    } else if (\n      this.frm.doc.doctype === 'Purchase Receipt' ||\n      this.frm.doc.doctype === 'Delivery Note'\n    ) {\n      show_batch_dialog = 1;\n    }\n    item.barcode = null;\n\n    if (item.item_code || item.serial_no) {\n      if (!this.validate_company_and_party()) {\n        this.frm.fields_dict['items'].grid.grid_rows[item.idx - 1].remove();\n      } else {\n        item.pricing_rules = '';\n        return this.frm.call({\n          method: 'stock.stock.get_item_details.get_item_details',\n          child: item,\n          args: {\n            doc: me.frm.doc,\n            args: {\n              item_code: item.item_code,\n              barcode: item.barcode,\n              serial_no: item.serial_no,\n              batch_no: item.batch_no,\n              set_warehouse: me.frm.doc.set_warehouse,\n              warehouse: item.warehouse,\n              customer: me.frm.doc.customer || me.frm.doc.party_name,\n              quotation_to: me.frm.doc.quotation_to,\n              supplier: me.frm.doc.supplier,\n              currency: me.frm.doc.currency,\n              update_stock: update_stock,\n              conversion_rate: me.frm.doc.conversion_rate,\n              price_list:\n                me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n              price_list_currency: me.frm.doc.price_list_currency,\n              plc_conversion_rate: me.frm.doc.plc_conversion_rate,\n              company: me.frm.doc.company,\n              order_type: me.frm.doc.order_type,\n              is_pos: cint(me.frm.doc.is_pos),\n              is_return: cint(me.frm.doc.is_return),\n              is_subcontracted: me.frm.doc.is_subcontracted,\n              ignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n              doctype: me.frm.doc.doctype,\n              name: me.frm.doc.name,\n              project: item.project || me.frm.doc.project,\n              qty: item.qty || 1,\n              net_rate: item.rate,\n              stock_qty: item.stock_qty,\n              conversion_factor: item.conversion_factor,\n              weight_per_unit: item.weight_per_unit,\n              uom: item.uom,\n              weight_uom: item.weight_uom,\n              manufacturer: item.manufacturer,\n              stock_uom: item.stock_uom,\n              pos_profile: cint(me.frm.doc.is_pos)\n                ? me.frm.doc.pos_profile\n                : '',\n              cost_center: item.cost_center,\n              tax_category: me.frm.doc.tax_category,\n              item_tax_template: item.item_tax_template,\n              child_doctype: item.doctype,\n              child_docname: item.name,\n              is_old_subcontracting_flow: me.frm.doc.is_old_subcontracting_flow,\n            },\n          },\n\n          callback: function (r) {\n            if (!r.exc) {\n              frappe.run_serially([\n                () => {\n                  var d = locals[cdt][cdn];\n                  me.add_taxes_from_item_tax_template(d.item_tax_rate);\n                  if (d.free_item_data && d.free_item_data.length > 0) {\n                    me.apply_product_discount(d);\n                  }\n                },\n                () => {\n                  // for internal customer instead of pricing rule directly apply valuation rate on item\n                  if (\n                    (me.frm.doc.is_internal_customer ||\n                      me.frm.doc.is_internal_supplier) &&\n                    me.frm.doc.represents_company === me.frm.doc.company\n                  ) {\n                    me.get_incoming_rate(\n                      item,\n                      me.frm.posting_date,\n                      me.frm.posting_time,\n                      me.frm.doc.doctype,\n                      me.frm.doc.company\n                    );\n                  } else {\n                    me.frm.script_manager.trigger('price_list_rate', cdt, cdn);\n                  }\n                },\n                () => {\n                  if (\n                    me.frm.doc.is_internal_customer ||\n                    me.frm.doc.is_internal_supplier\n                  ) {\n                    me.calculate_taxes_and_totals();\n                  }\n                },\n                () => me.toggle_conversion_factor(item),\n                () => {\n                  if (\n                    show_batch_dialog &&\n                    !frappe.flags.trigger_from_barcode_scanner\n                  )\n                    return frappe.db\n                      .get_value('Item', item.item_code, [\n                        'has_batch_no',\n                        'has_serial_no',\n                      ])\n                      .then((r) => {\n                        if (\n                          r.message &&\n                          (r.message.has_batch_no || r.message.has_serial_no)\n                        ) {\n                          frappe.flags.hide_serial_batch_dialog = false;\n                        } else {\n                          show_batch_dialog = false;\n                        }\n                      });\n                },\n                () => {\n                  // check if batch serial selector is disabled or not\n                  if (\n                    show_batch_dialog &&\n                    !frappe.flags.hide_serial_batch_dialog\n                  )\n                    return frappe.db\n                      .get_single_value(\n                        'Stock Settings',\n                        'disable_serial_no_and_batch_selector'\n                      )\n                      .then((value) => {\n                        if (value) {\n                          frappe.flags.hide_serial_batch_dialog = true;\n                        }\n                      });\n                },\n                () => {\n                  if (\n                    show_batch_dialog &&\n                    !frappe.flags.hide_serial_batch_dialog &&\n                    !frappe.flags.dialog_set\n                  ) {\n                    var d = locals[cdt][cdn];\n                    $.each(r.message, function (k, v) {\n                      if (!d[k]) d[k] = v;\n                    });\n\n                    if (d.has_batch_no && d.has_serial_no) {\n                      d.batch_no = undefined;\n                    }\n\n                    frappe.flags.dialog_set = true;\n                    stock.show_serial_batch_selector(\n                      me.frm,\n                      d,\n                      (item) => {\n                        me.frm.script_manager.trigger(\n                          'qty',\n                          item.doctype,\n                          item.name\n                        );\n                        if (!me.frm.doc.set_warehouse)\n                          me.frm.script_manager.trigger(\n                            'warehouse',\n                            item.doctype,\n                            item.name\n                          );\n                        me.apply_price_list(item, true);\n                      },\n                      undefined,\n                      !frappe.flags.hide_serial_batch_dialog\n                    );\n                  } else {\n                    frappe.flags.dialog_set = false;\n                  }\n                },\n                () => me.conversion_factor(doc, cdt, cdn, true),\n                () => me.remove_pricing_rule(item),\n                () => {\n                  if (item.apply_rule_on_other_items) {\n                    let key = item.name;\n                    me.apply_rule_on_other_items({ key: item });\n                  }\n                },\n                () => {\n                  var company_currency = me.get_company_currency();\n                  me.update_item_grid_labels(company_currency);\n                },\n              ]);\n            }\n          },\n        });\n      }\n    }\n  }\n\n  price_list_rate(doc, cdt, cdn) {\n    var item = frappe.get_doc(cdt, cdn);\n    frappe.model.round_floats_in(item, [\n      'price_list_rate',\n      'discount_percentage',\n    ]);\n\n    // check if child doctype is Sales Order Item/Quotation Item and calculate the rate\n    if (\n      (in_list([\n        'Quotation Item',\n        'Sales Order Item',\n        'Delivery Note Item',\n        'Sales Invoice Item',\n        'POS Invoice Item',\n        // 'Purchase Invoice Item',\n        'Purchase Order Item',\n        'Purchase Receipt Item',\n      ]),\n      cdt)\n    )\n      this.apply_pricing_rule_on_item(item);\n    else\n      item.rate = flt(\n        item.price_list_rate * (1 - item.discount_percentage / 100.0),\n        precision('rate', item)\n      );\n\n    this.calculate_taxes_and_totals();\n  }\n\n  margin_rate_or_amount(doc, cdt, cdn) {\n    // calculated the revised total margin and rate on margin rate changes\n    let item = frappe.get_doc(cdt, cdn);\n    this.apply_pricing_rule_on_item(item);\n    this.calculate_taxes_and_totals();\n    cur_frm.refresh_fields();\n  }\n\n  margin_type(doc, cdt, cdn) {\n    // calculate the revised total margin and rate on margin type changes\n    let item = frappe.get_doc(cdt, cdn);\n    if (!item.margin_type) {\n      frappe.model.set_value(cdt, cdn, 'margin_rate_or_amount', 0);\n    } else {\n      this.apply_pricing_rule_on_item(item, doc, cdt, cdn);\n      this.calculate_taxes_and_totals();\n      cur_frm.refresh_fields();\n    }\n  }\n\n  get_incoming_rate(item, posting_date, posting_time, voucher_type, company) {\n    let item_args = {\n      item_code: item.item_code,\n      warehouse: in_list('Purchase Receipt', 'Purchase Invoice')\n        ? item.from_warehouse\n        : item.warehouse,\n      posting_date: posting_date,\n      posting_time: posting_time,\n      qty: item.qty * item.conversion_factor,\n      serial_no: item.serial_no,\n      batch_no: item.batch_no,\n      voucher_type: voucher_type,\n      company: company,\n      allow_zero_valuation_rate: item.allow_zero_valuation_rate,\n    };\n\n    frappe.call({\n      method: 'stock.stock.utils.get_incoming_rate',\n      args: {\n        args: item_args,\n      },\n      callback: function (r) {\n        frappe.model.set_value(\n          item.doctype,\n          item.name,\n          'rate',\n          r.message * item.conversion_factor\n        );\n      },\n    });\n  }\n\n  add_taxes_from_item_tax_template(item_tax_map) {\n    let me = this;\n\n    if (\n      item_tax_map &&\n      cint(frappe.defaults.get_default('add_taxes_from_item_tax_template'))\n    ) {\n      if (typeof item_tax_map == 'string') {\n        item_tax_map = JSON.parse(item_tax_map);\n      }\n\n      $.each(item_tax_map, function (tax, rate) {\n        let found = (me.frm.doc.taxes || []).find(\n          (d) => d.account_head === tax\n        );\n        if (!found) {\n          let child = frappe.model.add_child(me.frm.doc, 'taxes');\n          child.charge_type = 'On Net Total';\n          child.account_head = tax;\n          child.rate = 0;\n        }\n      });\n    }\n  }\n\n  serial_no(doc, cdt, cdn) {\n    var me = this;\n    var item = frappe.get_doc(cdt, cdn);\n\n    if (item && item.doctype === 'Purchase Receipt Item Supplied') {\n      return;\n    }\n\n    if (item && item.serial_no) {\n      if (!item.item_code) {\n        this.frm.trigger('item_code', cdt, cdn);\n      } else {\n        // Replace all occurences of comma with line feed\n        item.serial_no = item.serial_no.replace(/,/g, '\\n');\n        item.conversion_factor = item.conversion_factor || 1;\n        refresh_field('serial_no', item.name, item.parentfield);\n        if (\n          !doc.is_return &&\n          cint(\n            frappe.user_defaults\n              .set_qty_in_transactions_based_on_serial_no_input\n          )\n        ) {\n          setTimeout(() => {\n            me.update_qty(cdt, cdn);\n          }, 10000);\n        }\n      }\n    }\n  }\n\n  on_submit() {\n    if (\n      in_list(['Purchase Invoice', 'Sales Invoice'], this.frm.doc.doctype) &&\n      !this.frm.doc.update_stock\n    ) {\n      return;\n    }\n\n    this.refresh_serial_batch_bundle_field();\n  }\n\n  refresh_serial_batch_bundle_field() {\n    frappe.route_hooks.after_submit = (frm_obj) => {\n      frm_obj.reload_doc();\n    };\n  }\n\n  update_qty(cdt, cdn) {\n    var valid_serial_nos = [];\n    var serialnos = [];\n    var item = frappe.get_doc(cdt, cdn);\n    serialnos = item.serial_no.split('\\n');\n    for (var i = 0; i < serialnos.length; i++) {\n      if (serialnos[i] != '') {\n        valid_serial_nos.push(serialnos[i]);\n      }\n    }\n    frappe.model.set_value(\n      item.doctype,\n      item.name,\n      'qty',\n      valid_serial_nos.length / item.conversion_factor\n    );\n    frappe.model.set_value(\n      item.doctype,\n      item.name,\n      'stock_qty',\n      valid_serial_nos.length\n    );\n  }\n\n  validate() {\n    this.calculate_taxes_and_totals(false);\n  }\n\n  update_stock() {\n    this.frm.trigger('set_default_internal_warehouse');\n  }\n\n  set_default_internal_warehouse() {\n    let me = this;\n    if (\n      (this.frm.doc.doctype === 'Sales Invoice' && me.frm.doc.update_stock) ||\n      this.frm.doc.doctype == 'Delivery Note'\n    ) {\n      if (\n        this.frm.doc.is_internal_customer &&\n        this.frm.doc.company === this.frm.doc.represents_company\n      ) {\n        frappe.db.get_value(\n          'Company',\n          this.frm.doc.company,\n          'default_in_transit_warehouse',\n          function (value) {\n            me.frm.set_value(\n              'set_target_warehouse',\n              value.default_in_transit_warehouse\n            );\n          }\n        );\n      }\n    }\n\n    if (\n      (this.frm.doc.doctype === 'Purchase Invoice' &&\n        me.frm.doc.update_stock) ||\n      this.frm.doc.doctype == 'Purchase Receipt'\n    ) {\n      if (\n        this.frm.doc.is_internal_supplier &&\n        this.frm.doc.company === this.frm.doc.represents_company\n      ) {\n        frappe.db.get_value(\n          'Company',\n          this.frm.doc.company,\n          'default_in_transit_warehouse',\n          function (value) {\n            me.frm.set_value(\n              'set_from_warehouse',\n              value.default_in_transit_warehouse\n            );\n          }\n        );\n      }\n    }\n  }\n\n  company() {\n    var me = this;\n    var set_pricing = function () {\n      if (me.frm.doc.company && me.frm.fields_dict.currency) {\n        var company_currency = me.get_company_currency();\n        var company_doc = frappe.get_doc(':Company', me.frm.doc.company);\n\n        if (!me.frm.doc.currency) {\n          me.frm.set_value('currency', company_currency);\n        }\n\n        if (me.frm.doc.currency == company_currency) {\n          me.frm.set_value('conversion_rate', 1.0);\n        }\n        if (me.frm.doc.price_list_currency == company_currency) {\n          me.frm.set_value('plc_conversion_rate', 1.0);\n        }\n        if (company_doc) {\n          if (company_doc.default_letter_head) {\n            if (me.frm.fields_dict.letter_head) {\n              me.frm.set_value('letter_head', company_doc.default_letter_head);\n            }\n          }\n          let selling_doctypes_for_tc = [\n            'Sales Invoice',\n            'Quotation',\n            'Sales Order',\n            'Delivery Note',\n          ];\n          if (\n            company_doc.default_selling_terms &&\n            frappe.meta.has_field(me.frm.doc.doctype, 'tc_name') &&\n            selling_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1\n          ) {\n            me.frm.set_value('tc_name', company_doc.default_selling_terms);\n          }\n          let buying_doctypes_for_tc = [\n            'Request for Quotation',\n            'Supplier Quotation',\n            'Purchase Order',\n            'Material Request',\n            'Purchase Receipt',\n          ];\n          // Purchase Invoice is excluded as per issue #3345\n          if (\n            company_doc.default_buying_terms &&\n            frappe.meta.has_field(me.frm.doc.doctype, 'tc_name') &&\n            buying_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1\n          ) {\n            me.frm.set_value('tc_name', company_doc.default_buying_terms);\n          }\n        }\n        frappe.run_serially([\n          () => me.frm.script_manager.trigger('currency'),\n          () => me.update_item_tax_map(),\n          () => me.apply_default_taxes(),\n          () => me.apply_pricing_rule(),\n        ]);\n      }\n    };\n\n    // var set_party_account = function(set_pricing) {\n    // \tif (in_list([\"Sales Invoice\", \"Purchase Invoice\"], me.frm.doc.doctype)) {\n    // \t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n    // \t\t\tvar party_type = \"Customer\";\n    // \t\t\tvar party_account_field = 'debit_to';\n    // \t\t} else {\n    // \t\t\tvar party_type = \"Supplier\";\n    // \t\t\tvar party_account_field = 'credit_to';\n    // \t\t}\n\n    // \t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n    // \t\tif(party && me.frm.doc.company) {\n    // \t\t\treturn frappe.call({\n    // \t\t\t\tmethod: \"stock.accounts.party.get_party_account\",\n    // \t\t\t\targs: {\n    // \t\t\t\t\tcompany: me.frm.doc.company,\n    // \t\t\t\t\tparty_type: party_type,\n    // \t\t\t\t\tparty: party\n    // \t\t\t\t},\n    // \t\t\t\tcallback: function(r) {\n    // \t\t\t\t\tif(!r.exc && r.message) {\n    // \t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n    // \t\t\t\t\t\tset_pricing();\n    // \t\t\t\t\t}\n    // \t\t\t\t}\n    // \t\t\t});\n    // \t\t} else {\n    // \t\t\tset_pricing();\n    // \t\t}\n    // \t} else {\n    // \t\tset_pricing();\n    // \t}\n\n    // }\n\n    if (\n      frappe.meta.get_docfield(this.frm.doctype, 'shipping_address') &&\n      in_list(\n        ['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'],\n        this.frm.doctype\n      )\n    ) {\n      // stock.utils.get_shipping_address(this.frm, function() {\n      // \tset_party_account(set_pricing);\n      // });\n    } else {\n      set_party_account(set_pricing);\n    }\n\n    if (this.frm.doc.company) {\n      stock.last_selected_company = this.frm.doc.company;\n    }\n  }\n\n  transaction_date() {\n    if (this.frm.doc.transaction_date) {\n      this.frm.transaction_date = this.frm.doc.transaction_date;\n      frappe.ui.form.trigger(this.frm.doc.doctype, 'currency');\n    }\n  }\n\n  // posting_date() {\n  // \tvar me = this;\n  // \tif (this.frm.doc.posting_date) {\n  // \t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n  // \t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n  // \t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n  // \t\t\treturn frappe.call({\n  // \t\t\t\tmethod: \"stock.accounts.party.get_due_date\",\n  // \t\t\t\targs: {\n  // \t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n  // \t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n  // \t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n  // \t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n  // \t\t\t\t\t\"company\": me.frm.doc.company\n  // \t\t\t\t},\n  // \t\t\t\tcallback: function(r, rt) {\n  // \t\t\t\t\tif(r.message) {\n  // \t\t\t\t\t\tme.frm.doc.due_date = r.message;\n  // \t\t\t\t\t\trefresh_field(\"due_date\");\n  // \t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n  // \t\t\t\t\t\tme.recalculate_terms();\n  // \t\t\t\t\t}\n  // \t\t\t\t}\n  // \t\t\t})\n  // \t\t} else {\n  // \t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n  // \t\t}\n  // \t}\n  // }\n\n  due_date() {\n    // due_date is to be changed, payment terms template and/or payment schedule must\n    // be removed as due_date is automatically changed based on payment terms\n    if (\n      this.frm.doc.due_date &&\n      !this.frm.updating_party_details &&\n      !this.frm.doc.is_pos\n    ) {\n      if (\n        this.frm.doc.payment_terms_template ||\n        (this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)\n      ) {\n        var message1 = '';\n        var message2 = '';\n        var final_message = __('Please clear the') + ' ';\n\n        if (this.frm.doc.payment_terms_template) {\n          message1 = __('selected Payment Terms Template');\n          final_message = final_message + message1;\n        }\n\n        if ((this.frm.doc.payment_schedule || []).length) {\n          message2 = __('Payment Schedule Table');\n          if (message1.length !== 0) message2 = ' and ' + message2;\n          final_message = final_message + message2;\n        }\n        frappe.msgprint(final_message);\n      }\n    }\n  }\n\n  bill_date() {\n    this.posting_date();\n  }\n\n  recalculate_terms() {\n    const doc = this.frm.doc;\n    if (doc.payment_terms_template) {\n      this.payment_terms_template();\n    } else if (doc.payment_schedule) {\n      const me = this;\n      doc.payment_schedule.forEach(function (term) {\n        if (term.payment_term) {\n          me.payment_term(doc, term.doctype, term.name);\n        } else {\n          frappe.model.set_value(\n            term.doctype,\n            term.name,\n            'due_date',\n            doc.posting_date || doc.transaction_date\n          );\n        }\n      });\n    }\n  }\n\n  // get_company_currency() {\n  // \treturn stock.get_currency(this.frm.doc.company);\n  // }\n\n  contact_person() {\n    stock.utils.get_contact_details(this.frm);\n  }\n\n  // currency() {\n  //   // The transaction date be either transaction_date (from orders) or posting_date (from invoices)\n  //   let transaction_date =\n  //     this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\n  //   let me = this;\n  //   // this.set_dynamic_labels();\n  //   // let company_currency = this.get_company_currency();\n  //   // Added `load_after_mapping` to determine if document is loading after mapping from another doc\n  //   if (\n  //     this.frm.doc.currency &&\n  //     this.frm.doc.currency !== company_currency &&\n  //     !this.frm.doc.__onload?.load_after_mapping\n  //   ) {\n  //     this.get_exchange_rate(\n  //       transaction_date,\n  //       this.frm.doc.currency,\n  //       company_currency,\n  //       function (exchange_rate) {\n  //         if (exchange_rate != me.frm.doc.conversion_rate) {\n  //           me.set_margin_amount_based_on_currency(exchange_rate);\n  //           me.set_actual_charges_based_on_currency(exchange_rate);\n  //           me.frm.set_value('conversion_rate', exchange_rate);\n  //         }\n  //       }\n  //     );\n  //   } else {\n  //     // company currency and doc currency is same\n  //     // this will prevent unnecessary conversion rate triggers\n  //     if (this.frm.doc.currency === this.get_company_currency()) {\n  //       this.frm.set_value('conversion_rate', 1.0);\n  //     } else {\n  //       this.conversion_rate();\n  //     }\n  //   }\n  // }\n\n  conversion_rate() {\n    const me = this.frm;\n    if (this.frm.doc.currency === this.get_company_currency()) {\n      this.frm.set_value('conversion_rate', 1.0);\n    }\n    if (\n      this.frm.doc.currency === this.frm.doc.price_list_currency &&\n      this.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate\n    ) {\n      this.frm.set_value('plc_conversion_rate', this.frm.doc.conversion_rate);\n    }\n\n    if (flt(this.frm.doc.conversion_rate) > 0.0) {\n      if (this.frm.doc.__onload?.load_after_mapping) {\n        this.calculate_taxes_and_totals();\n      } else if (!this.in_apply_price_list) {\n        this.apply_price_list();\n      }\n    }\n    // Make read only if Accounts Settings doesn't allow stale rates\n    this.frm.set_df_property(\n      'conversion_rate',\n      'read_only',\n      stock.stale_rate_allowed() ? 0 : 1\n    );\n  }\n\n  apply_discount_on_item(doc, cdt, cdn, field) {\n    var item = frappe.get_doc(cdt, cdn);\n    if (!item.price_list_rate) {\n      item[field] = 0.0;\n    } else {\n      this.price_list_rate(doc, cdt, cdn);\n    }\n    this.set_gross_profit(item);\n  }\n\n  shipping_rule() {\n    var me = this;\n    if (this.frm.doc.shipping_rule) {\n      return this.frm\n        .call({\n          doc: this.frm.doc,\n          method: 'apply_shipping_rule',\n          callback: function (r) {\n            me._calculate_taxes_and_totals();\n          },\n        })\n        .fail(() => this.frm.set_value('shipping_rule', ''));\n    }\n  }\n\n  set_margin_amount_based_on_currency(exchange_rate) {\n    if (\n      (in_list([\n        'Quotation',\n        'Sales Order',\n        'Delivery Note',\n        'Sales Invoice',\n        'Purchase Invoice',\n        'Purchase Order',\n        'Purchase Receipt',\n      ]),\n      this.frm.doc.doctype)\n    ) {\n      var me = this;\n      $.each(this.frm.doc.items || [], function (i, d) {\n        if (d.margin_type == 'Amount') {\n          frappe.model.set_value(\n            d.doctype,\n            d.name,\n            'margin_rate_or_amount',\n            flt(d.margin_rate_or_amount) / flt(exchange_rate)\n          );\n        }\n      });\n    }\n  }\n\n  set_actual_charges_based_on_currency(exchange_rate) {\n    var me = this;\n    $.each(this.frm.doc.taxes || [], function (i, d) {\n      if (d.charge_type == 'Actual') {\n        frappe.model.set_value(\n          d.doctype,\n          d.name,\n          'tax_amount',\n          flt(d.base_tax_amount) / flt(exchange_rate)\n        );\n      }\n    });\n  }\n\n  get_exchange_rate(transaction_date, from_currency, to_currency, callback) {\n    var args;\n    if (\n      ['Quotation', 'Sales Order', 'Delivery Note', 'Sales Invoice'].includes(\n        this.frm.doctype\n      )\n    ) {\n      args = 'for_selling';\n    } else if (\n      ['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'].includes(\n        this.frm.doctype\n      )\n    ) {\n      args = 'for_buying';\n    }\n\n    if (!transaction_date || !from_currency || !to_currency) return;\n    return frappe.call({\n      method: 'basic.setuputils.get_exchange_rate',\n      args: {\n        transaction_date: transaction_date,\n        from_currency: from_currency,\n        to_currency: to_currency,\n        args: args,\n      },\n      freeze: true,\n      freeze_message: __('Fetching exchange rates ...'),\n      callback: function (r) {\n        callback(flt(r.message));\n      },\n    });\n  }\n\n  // price_list_currency() {\n  //   var me = this;\n  //   // this.set_dynamic_labels();\n\n  //   // var company_currency = this.get_company_currency();\n  //   // Added `load_after_mapping` to determine if document is loading after mapping from another doc\n  //   if (\n  //     this.frm.doc.price_list_currency !== company_currency &&\n  //     !this.frm.doc.__onload?.load_after_mapping\n  //   ) {\n  //     this.get_exchange_rate(\n  //       this.frm.doc.posting_date,\n  //       this.frm.doc.price_list_currency,\n  //       company_currency,\n  //       function (exchange_rate) {\n  //         me.frm.set_value('plc_conversion_rate', exchange_rate);\n  //       }\n  //     );\n  //   } else {\n  //     this.plc_conversion_rate();\n  //   }\n  // }\n\n  plc_conversion_rate() {\n    if (this.frm.doc.price_list_currency === this.get_company_currency()) {\n      this.frm.set_value('plc_conversion_rate', 1.0);\n    } else if (\n      this.frm.doc.price_list_currency === this.frm.doc.currency &&\n      this.frm.doc.plc_conversion_rate &&\n      cint(this.frm.doc.plc_conversion_rate) != 1 &&\n      cint(this.frm.doc.plc_conversion_rate) !=\n        cint(this.frm.doc.conversion_rate)\n    ) {\n      this.frm.set_value('conversion_rate', this.frm.doc.plc_conversion_rate);\n    }\n\n    if (!this.in_apply_price_list) {\n      this.apply_price_list(null, true);\n    }\n  }\n\n  uom(doc, cdt, cdn) {\n    var me = this;\n    var item = frappe.get_doc(cdt, cdn);\n    item.pricing_rules = '';\n    if (item.item_code && item.uom) {\n      return this.frm.call({\n        method: 'stock.stock.get_item_details.get_conversion_factor',\n        args: {\n          item_code: item.item_code,\n          uom: item.uom,\n        },\n        callback: function (r) {\n          if (!r.exc) {\n            frappe.model.set_value(\n              cdt,\n              cdn,\n              'conversion_factor',\n              r.message.conversion_factor\n            );\n          }\n        },\n      });\n    }\n    me.calculate_stock_uom_rate(doc, cdt, cdn);\n  }\n\n  conversion_factor(doc, cdt, cdn, dont_fetch_price_list_rate) {\n    if (frappe.meta.get_docfield(cdt, 'stock_qty', cdn)) {\n      var item = frappe.get_doc(cdt, cdn);\n      frappe.model.round_floats_in(item, ['qty', 'conversion_factor']);\n      item.stock_qty = flt(\n        item.qty * item.conversion_factor,\n        precision('stock_qty', item)\n      );\n      refresh_field('stock_qty', item.name, item.parentfield);\n      this.toggle_conversion_factor(item);\n\n      if (doc.doctype != 'Material Request') {\n        item.total_weight = flt(item.stock_qty * item.weight_per_unit);\n        refresh_field('total_weight', item.name, item.parentfield);\n        this.calculate_net_weight();\n      }\n\n      // for handling customization not to fetch price list rate\n      if (frappe.flags.dont_fetch_price_list_rate) {\n        return;\n      }\n\n      if (\n        !dont_fetch_price_list_rate &&\n        frappe.meta.has_field(doc.doctype, 'price_list_currency')\n      ) {\n        this.apply_price_list(item, true);\n      }\n      this.calculate_stock_uom_rate(doc, cdt, cdn);\n    }\n  }\n\n  is_a_mapped_document(item) {\n    const mapped_item_field_map = {\n      'Delivery Note Item': ['si_detail', 'so_detail', 'dn_detail'],\n      'Sales Invoice Item': ['dn_detail', 'so_detail', 'sales_invoice_item'],\n      'Purchase Receipt Item': [\n        'purchase_order_item',\n        'purchase_invoice_item',\n        'purchase_receipt_item',\n      ],\n      // 'Purchase Invoice Item': [\n      //   'purchase_order_item',\n      //   'pr_detail',\n      //   'po_detail',\n      // ],\n    };\n    const mappped_fields = mapped_item_field_map[item.doctype] || [];\n\n    return (\n      mappped_fields.map((field) => item[field]).filter(Boolean).length > 0\n    );\n  }\n\n  batch_no(doc, cdt, cdn) {\n    let item = frappe.get_doc(cdt, cdn);\n    if (!this.is_a_mapped_document(item)) {\n      this.apply_price_list(item, true);\n    }\n  }\n\n  toggle_conversion_factor(item) {\n    // toggle read only property for conversion factor field if the uom and stock uom are same\n    if (this.frm.get_field('items').grid.fields_map.conversion_factor) {\n      this.frm.fields_dict.items.grid.toggle_enable(\n        'conversion_factor',\n        item.uom != item.stock_uom &&\n          !frappe.meta.get_docfield(\n            cur_frm.fields_dict.items.grid.doctype,\n            'conversion_factor'\n          ).read_only\n          ? true\n          : false\n      );\n    }\n  }\n\n  qty(doc, cdt, cdn) {\n    let item = frappe.get_doc(cdt, cdn);\n    // item.pricing_rules = ''\n    frappe.run_serially([\n      () => this.remove_pricing_rule(item),\n      () => this.conversion_factor(doc, cdt, cdn, true),\n      () => this.calculate_stock_uom_rate(doc, cdt, cdn),\n      () => this.apply_pricing_rule(item, true),\n    ]);\n  }\n\n  stock_qty(doc, cdt, cdn) {\n    let item = frappe.get_doc(cdt, cdn);\n    item.conversion_factor = 1.0;\n    if (item.stock_qty) {\n      item.conversion_factor = flt(item.stock_qty) / flt(item.qty);\n    }\n\n    refresh_field('conversion_factor', item.name, item.parentfield);\n  }\n\n  calculate_stock_uom_rate(doc, cdt, cdn) {\n    let item = frappe.get_doc(cdt, cdn);\n    item.stock_uom_rate = flt(item.rate) / flt(item.conversion_factor);\n    refresh_field('stock_uom_rate', item.name, item.parentfield);\n  }\n  service_stop_date(frm, cdt, cdn) {\n    var child = locals[cdt][cdn];\n\n    if (child.service_stop_date) {\n      let start_date = Date.parse(child.service_start_date);\n      let end_date = Date.parse(child.service_end_date);\n      let stop_date = Date.parse(child.service_stop_date);\n\n      if (stop_date < start_date) {\n        frappe.model.set_value(cdt, cdn, 'service_stop_date', '');\n        frappe.throw(\n          __('Service Stop Date cannot be before Service Start Date')\n        );\n      } else if (stop_date > end_date) {\n        frappe.model.set_value(cdt, cdn, 'service_stop_date', '');\n        frappe.throw(__('Service Stop Date cannot be after Service End Date'));\n      }\n    }\n  }\n\n  sync_bundle_data() {\n    let doctypes = [\n      'Sales Invoice',\n      'Purchase Invoice',\n      'Delivery Note',\n      'Purchase Receipt',\n    ];\n\n    if (this.frm.is_new() && doctypes.includes(this.frm.doc.doctype)) {\n      const barcode_scanner = new stock.utils.BarcodeScanner({ frm: this.frm });\n      barcode_scanner.sync_bundle_data();\n      barcode_scanner.remove_item_from_localstorage();\n    }\n  }\n\n  before_save(doc) {\n    this.sync_bundle_data();\n  }\n\n  service_start_date(frm, cdt, cdn) {\n    var child = locals[cdt][cdn];\n\n    if (child.service_start_date) {\n      frappe.call({\n        method: 'stock.stock.get_item_details.calculate_service_end_date',\n        args: { args: child },\n        callback: function (r) {\n          frappe.model.set_value(\n            cdt,\n            cdn,\n            'service_end_date',\n            r.message.service_end_date\n          );\n        },\n      });\n    }\n  }\n\n  calculate_net_weight() {\n    /* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n    var me = this;\n    this.frm.doc.total_net_weight = 0.0;\n\n    $.each(this.frm.doc['items'] || [], function (i, item) {\n      me.frm.doc.total_net_weight += flt(item.total_weight);\n    });\n    refresh_field('total_net_weight');\n    this.shipping_rule();\n  }\n\n  // set_dynamic_labels() {\n  // \t// What TODO? should we make price list system non-mandatory?\n  // \tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n  // \t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n  // \t// var company_currency = this.get_company_currency();\n  // \tthis.change_form_labels(company_currency);\n  // \tthis.change_grid_labels(company_currency);\n  // \tthis.frm.refresh_fields();\n  // }\n\n  change_form_labels(company_currency) {\n    var me = this;\n\n    this.frm.set_currency_labels(\n      [\n        'base_total',\n        'base_net_total',\n        'base_total_taxes_and_charges',\n        'base_discount_amount',\n        'base_grand_total',\n        'base_rounded_total',\n        'base_in_words',\n        'base_taxes_and_charges_added',\n        'base_taxes_and_charges_deducted',\n        'total_amount_to_pay',\n        'base_paid_amount',\n        'base_write_off_amount',\n        'base_change_amount',\n        'base_operating_cost',\n        'base_raw_material_cost',\n        'base_total_cost',\n        'base_scrap_material_cost',\n        'base_rounding_adjustment',\n      ],\n      company_currency\n    );\n\n    this.frm.set_currency_labels(\n      [\n        'total',\n        'net_total',\n        'total_taxes_and_charges',\n        'discount_amount',\n        'grand_total',\n        'taxes_and_charges_added',\n        'taxes_and_charges_deducted',\n        'tax_withholding_net_total',\n        'rounded_total',\n        'in_words',\n        'paid_amount',\n        'write_off_amount',\n        'operating_cost',\n        'scrap_material_cost',\n        'rounding_adjustment',\n        'raw_material_cost',\n        'total_cost',\n      ],\n      this.frm.doc.currency\n    );\n\n    this.frm.set_currency_labels(\n      ['outstanding_amount', 'total_advance'],\n      this.frm.doc.party_account_currency\n    );\n\n    cur_frm.set_df_property(\n      'conversion_rate',\n      'description',\n      '1 ' + this.frm.doc.currency + ' = [?] ' + company_currency\n    );\n\n    if (\n      this.frm.doc.price_list_currency &&\n      this.frm.doc.price_list_currency != company_currency\n    ) {\n      cur_frm.set_df_property(\n        'plc_conversion_rate',\n        'description',\n        '1 ' + this.frm.doc.price_list_currency + ' = [?] ' + company_currency\n      );\n    }\n\n    // toggle fields\n    this.frm.toggle_display(\n      [\n        'conversion_rate',\n        'base_total',\n        'base_net_total',\n        'base_tax_withholding_net_total',\n        'base_total_taxes_and_charges',\n        'base_taxes_and_charges_added',\n        'base_taxes_and_charges_deducted',\n        'base_grand_total',\n        'base_rounded_total',\n        'base_in_words',\n        'base_discount_amount',\n        'base_paid_amount',\n        'base_write_off_amount',\n        'base_operating_cost',\n        'base_raw_material_cost',\n        'base_total_cost',\n        'base_scrap_material_cost',\n        'base_rounding_adjustment',\n      ],\n      this.frm.doc.currency != company_currency\n    );\n\n    this.frm.toggle_display(\n      ['plc_conversion_rate', 'price_list_currency'],\n      this.frm.doc.price_list_currency != company_currency\n    );\n\n    var show =\n      cint(cur_frm.doc.discount_amount) ||\n      (cur_frm.doc.taxes || []).filter(function (d) {\n        return d.included_in_print_rate === 1;\n      }).length;\n\n    if (frappe.meta.get_docfield(cur_frm.doctype, 'net_total'))\n      cur_frm.toggle_display('net_total', show);\n\n    if (frappe.meta.get_docfield(cur_frm.doctype, 'base_net_total'))\n      cur_frm.toggle_display(\n        'base_net_total',\n        show && me.frm.doc.currency != company_currency\n      );\n  }\n\n  change_grid_labels(company_currency) {\n    var me = this;\n\n    this.update_item_grid_labels(company_currency);\n\n    this.toggle_item_grid_columns(company_currency);\n\n    if (this.frm.doc.operations && this.frm.doc.operations.length > 0) {\n      this.frm.set_currency_labels(\n        ['operating_cost', 'hour_rate'],\n        this.frm.doc.currency,\n        'operations'\n      );\n      this.frm.set_currency_labels(\n        ['base_operating_cost', 'base_hour_rate'],\n        company_currency,\n        'operations'\n      );\n\n      var item_grid = this.frm.fields_dict['operations'].grid;\n      $.each(['base_operating_cost', 'base_hour_rate'], function (i, fname) {\n        if (frappe.meta.get_docfield(item_grid.doctype, fname))\n          item_grid.set_column_disp(\n            fname,\n            me.frm.doc.currency != company_currency\n          );\n      });\n    }\n\n    if (this.frm.doc.scrap_items && this.frm.doc.scrap_items.length > 0) {\n      this.frm.set_currency_labels(\n        ['rate', 'amount'],\n        this.frm.doc.currency,\n        'scrap_items'\n      );\n      this.frm.set_currency_labels(\n        ['base_rate', 'base_amount'],\n        company_currency,\n        'scrap_items'\n      );\n\n      var item_grid = this.frm.fields_dict['scrap_items'].grid;\n      $.each(['base_rate', 'base_amount'], function (i, fname) {\n        if (frappe.meta.get_docfield(item_grid.doctype, fname))\n          item_grid.set_column_disp(\n            fname,\n            me.frm.doc.currency != company_currency\n          );\n      });\n    }\n\n    if (this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n      this.frm.set_currency_labels(\n        ['tax_amount', 'total', 'tax_amount_after_discount'],\n        this.frm.doc.currency,\n        'taxes'\n      );\n\n      this.frm.set_currency_labels(\n        ['base_tax_amount', 'base_total', 'base_tax_amount_after_discount'],\n        company_currency,\n        'taxes'\n      );\n    }\n\n    if (this.frm.doc.advances && this.frm.doc.advances.length > 0) {\n      this.frm.set_currency_labels(\n        ['advance_amount', 'allocated_amount'],\n        this.frm.doc.party_account_currency,\n        'advances'\n      );\n    }\n\n    this.update_payment_schedule_grid_labels(company_currency);\n  }\n\n  update_item_grid_labels(company_currency) {\n    this.frm.set_currency_labels(\n      [\n        'base_rate',\n        'base_net_rate',\n        'base_price_list_rate',\n        'base_amount',\n        'base_net_amount',\n        'base_rate_with_margin',\n      ],\n      company_currency,\n      'items'\n    );\n\n    this.frm.set_currency_labels(\n      [\n        'rate',\n        'net_rate',\n        'price_list_rate',\n        'amount',\n        'net_amount',\n        'stock_uom_rate',\n        'rate_with_margin',\n      ],\n      this.frm.doc.currency,\n      'items'\n    );\n  }\n\n  update_payment_schedule_grid_labels(company_currency) {\n    const me = this;\n    if (\n      this.frm.doc.payment_schedule &&\n      this.frm.doc.payment_schedule.length > 0\n    ) {\n      this.frm.set_currency_labels(\n        ['base_payment_amount', 'base_outstanding', 'base_paid_amount'],\n        company_currency,\n        'payment_schedule'\n      );\n      this.frm.set_currency_labels(\n        ['payment_amount', 'outstanding', 'paid_amount'],\n        this.frm.doc.currency,\n        'payment_schedule'\n      );\n\n      var schedule_grid = this.frm.fields_dict['payment_schedule'].grid;\n      $.each(\n        ['base_payment_amount', 'base_outstanding', 'base_paid_amount'],\n        function (i, fname) {\n          if (frappe.meta.get_docfield(schedule_grid.doctype, fname))\n            schedule_grid.set_column_disp(\n              fname,\n              me.frm.doc.currency != company_currency\n            );\n        }\n      );\n    }\n  }\n\n  toggle_item_grid_columns(company_currency) {\n    const me = this;\n    // toggle columns\n    var item_grid = this.frm.fields_dict['items'].grid;\n    $.each(\n      [\n        'base_rate',\n        'base_price_list_rate',\n        'base_amount',\n        'base_rate_with_margin',\n      ],\n      function (i, fname) {\n        if (frappe.meta.get_docfield(item_grid.doctype, fname))\n          item_grid.set_column_disp(\n            fname,\n            me.frm.doc.currency != company_currency\n          );\n      }\n    );\n\n    var show =\n      cint(cur_frm.doc.discount_amount) ||\n      (cur_frm.doc.taxes || []).filter(function (d) {\n        return d.included_in_print_rate === 1;\n      }).length;\n\n    $.each(['net_rate', 'net_amount'], function (i, fname) {\n      if (frappe.meta.get_docfield(item_grid.doctype, fname))\n        item_grid.set_column_disp(fname, show);\n    });\n\n    $.each(['base_net_rate', 'base_net_amount'], function (i, fname) {\n      if (frappe.meta.get_docfield(item_grid.doctype, fname))\n        item_grid.set_column_disp(\n          fname,\n          show && me.frm.doc.currency != company_currency\n        );\n    });\n  }\n\n  recalculate() {\n    this.calculate_taxes_and_totals();\n  }\n\n  recalculate_values() {\n    this.calculate_taxes_and_totals();\n  }\n\n  calculate_charges() {\n    this.calculate_taxes_and_totals();\n  }\n\n  // ignore_pricing_rule() {\n  // \tif(this.frm.doc.ignore_pricing_rule) {\n  // \t\tvar me = this;\n  // \t\tvar item_list = [];\n\n  // \t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n  // \t\t\tif (d.item_code) {\n  // \t\t\t\tif (d.is_free_item) {\n  // \t\t\t\t\t// Simply remove free items\n  // \t\t\t\t\tme.frm.get_field(\"items\").grid.grid_rows[i].remove();\n  // \t\t\t\t} else {\n  // \t\t\t\t\titem_list.push({\n  // \t\t\t\t\t\t\"doctype\": d.doctype,\n  // \t\t\t\t\t\t\"name\": d.name,\n  // \t\t\t\t\t\t\"item_code\": d.item_code,\n  // \t\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n  // \t\t\t\t\t\t\"parenttype\": d.parenttype,\n  // \t\t\t\t\t\t\"parent\": d.parent,\n  // \t\t\t\t\t\t\"price_list_rate\": d.price_list_rate\n  // \t\t\t\t\t})\n  // \t\t\t\t}\n  // \t\t\t}\n  // \t\t});\n  // \t\treturn this.frm.call({\n  // \t\t\tmethod: \"stock.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n  // \t\t\targs: { item_list: item_list },\n  // \t\t\tcallback: function(r) {\n  // \t\t\t\tif (!r.exc && r.message) {\n  // \t\t\t\t\tr.message.forEach(row_item => {\n  // \t\t\t\t\t\tme.remove_pricing_rule(row_item);\n  // \t\t\t\t\t});\n  // \t\t\t\t\tme._set_values_for_item_list(r.message);\n  // \t\t\t\t\tme.calculate_taxes_and_totals();\n  // \t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n  // \t\t\t\t}\n  // \t\t\t}\n  // \t\t});\n  // \t} else {\n  // \t\tthis.apply_pricing_rule();\n  // \t}\n  // }\n\n  // apply_pricing_rule(item, calculate_taxes_and_totals) {\n  // \tvar me = this;\n  // \tvar args = this._get_args(item);\n  // \tif (!(args.items && args.items.length)) {\n  // \t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n  // \t\treturn;\n  // \t}\n\n  // \t// Target doc created from a mapped doc\n  // \tif (this.frm.doc.__onload?.load_after_mapping) {\n  // \t\t// Calculate totals even though pricing rule is not applied.\n  // \t\t// `apply_pricing_rule` is triggered due to change in data which most likely contributes to Total.\n  // \t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n  // \t\treturn;\n  // \t}\n\n  // \treturn this.frm.call({\n  // \t\tmethod: \"stock.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n  // \t\targs: {\targs: args, doc: me.frm.doc },\n  // \t\tcallback: function(r) {\n  // \t\t\tif (!r.exc && r.message) {\n  // \t\t\t\tme._set_values_for_item_list(r.message);\n  // \t\t\t\tif(item) me.set_gross_profit(item);\n  // \t\t\t\tif (me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n  // \t\t\t}\n  // \t\t}\n  // \t});\n  // }\n\n  _get_args(item) {\n    var me = this;\n    return {\n      items: this._get_item_list(item),\n      customer: me.frm.doc.customer || me.frm.doc.party_name,\n      quotation_to: me.frm.doc.quotation_to,\n      customer_group: me.frm.doc.customer_group,\n      territory: me.frm.doc.territory,\n      supplier: me.frm.doc.supplier,\n      supplier_group: me.frm.doc.supplier_group,\n      currency: me.frm.doc.currency,\n      conversion_rate: me.frm.doc.conversion_rate,\n      price_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n      price_list_currency: me.frm.doc.price_list_currency,\n      plc_conversion_rate: me.frm.doc.plc_conversion_rate,\n      company: me.frm.doc.company,\n      transaction_date: me.frm.doc.transaction_date || me.frm.doc.posting_date,\n      campaign: me.frm.doc.campaign,\n      sales_partner: me.frm.doc.sales_partner,\n      ignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n      doctype: me.frm.doc.doctype,\n      name: me.frm.doc.name,\n      is_return: cint(me.frm.doc.is_return),\n      update_stock: in_list(\n        ['Sales Invoice', 'Purchase Invoice'],\n        me.frm.doc.doctype\n      )\n        ? cint(me.frm.doc.update_stock)\n        : 0,\n      conversion_factor: me.frm.doc.conversion_factor,\n      pos_profile:\n        me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n      coupon_code: me.frm.doc.coupon_code,\n    };\n  }\n\n  _get_item_list(item) {\n    var item_list = [];\n    var append_item = function (d) {\n      if (d.item_code) {\n        item_list.push({\n          doctype: d.doctype,\n          name: d.name,\n          child_docname: d.name,\n          item_code: d.item_code,\n          item_group: d.item_group,\n          brand: d.brand,\n          qty: d.qty,\n          stock_qty: d.stock_qty,\n          uom: d.uom,\n          stock_uom: d.stock_uom,\n          parenttype: d.parenttype,\n          parent: d.parent,\n          pricing_rules: d.pricing_rules,\n          is_free_item: d.is_free_item,\n          warehouse: d.warehouse,\n          serial_no: d.serial_no,\n          batch_no: d.batch_no,\n          price_list_rate: d.price_list_rate,\n          conversion_factor: d.conversion_factor || 1.0,\n        });\n\n        // if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n        if (\n          (in_list([\n            'Quotation Item',\n            'Sales Order Item',\n            'Delivery Note Item',\n            'Sales Invoice Item',\n            // 'Purchase Invoice Item',\n            'Purchase Order Item',\n            'Purchase Receipt Item',\n          ]),\n          d.doctype)\n        ) {\n          item_list[0]['margin_type'] = d.margin_type;\n          item_list[0]['margin_rate_or_amount'] = d.margin_rate_or_amount;\n        }\n      }\n    };\n\n    if (item) {\n      append_item(item);\n    } else {\n      $.each(this.frm.doc['items'] || [], function (i, d) {\n        append_item(d);\n      });\n    }\n    return item_list;\n  }\n\n  items_delete() {\n    this.update_localstorage_scanned_data();\n  }\n\n  update_localstorage_scanned_data() {\n    let doctypes = [\n      'Sales Invoice',\n      'Purchase Invoice',\n      'Delivery Note',\n      'Purchase Receipt',\n    ];\n    if (this.frm.is_new() && doctypes.includes(this.frm.doc.doctype)) {\n      const barcode_scanner = new stock.utils.BarcodeScanner({ frm: this.frm });\n      barcode_scanner.update_localstorage_scanned_data();\n    }\n  }\n\n  _set_values_for_item_list(children) {\n    const items_rule_dict = {};\n\n    for (const child of children) {\n      const existing_pricing_rule = frappe.model.get_value(\n        child.doctype,\n        child.name,\n        'pricing_rules'\n      );\n\n      for (const [key, value] of Object.entries(child)) {\n        if (!['doctype', 'name'].includes(key)) {\n          if (key === 'price_list_rate') {\n            frappe.model.set_value(child.doctype, child.name, 'rate', value);\n          }\n\n          if (key === 'pricing_rules') {\n            frappe.model.set_value(child.doctype, child.name, key, value);\n          }\n\n          if (key !== 'free_item_data') {\n            if (\n              child.apply_rule_on_other_items &&\n              JSON.parse(child.apply_rule_on_other_items).length\n            ) {\n              if (\n                !in_list(\n                  JSON.parse(child.apply_rule_on_other_items),\n                  child.item_code\n                )\n              ) {\n                continue;\n              }\n            }\n\n            frappe.model.set_value(child.doctype, child.name, key, value);\n          }\n        }\n      }\n\n      frappe.model.round_floats_in(frappe.get_doc(child.doctype, child.name), [\n        'price_list_rate',\n        'discount_percentage',\n      ]);\n\n      // if pricing rule set as blank from an existing value, apply price_list\n      if (\n        !this.frm.doc.ignore_pricing_rule &&\n        existing_pricing_rule &&\n        !child.pricing_rules\n      ) {\n        this.apply_price_list(frappe.get_doc(child.doctype, child.name));\n      } else if (!child.pricing_rules) {\n        this.remove_pricing_rule(frappe.get_doc(child.doctype, child.name));\n      }\n\n      if (child.free_item_data && child.free_item_data.length > 0) {\n        this.apply_product_discount(child);\n      }\n\n      if (\n        child.apply_rule_on_other_items &&\n        JSON.parse(child.apply_rule_on_other_items).length\n      ) {\n        items_rule_dict[child.name] = child;\n      }\n    }\n\n    this.apply_rule_on_other_items(items_rule_dict);\n    this.calculate_taxes_and_totals();\n  }\n\n  apply_rule_on_other_items(args) {\n    const me = this;\n    const fields = [\n      'discount_percentage',\n      'pricing_rules',\n      'discount_amount',\n      'rate',\n    ];\n\n    for (var k in args) {\n      let data = args[k];\n\n      if (\n        data &&\n        data.apply_rule_on_other_items &&\n        JSON.parse(data.apply_rule_on_other_items)\n      ) {\n        me.frm.doc.items.forEach((d) => {\n          if (\n            in_list(\n              JSON.parse(data.apply_rule_on_other_items),\n              d[data.apply_rule_on]\n            )\n          ) {\n            for (var k in data) {\n              if (\n                in_list(fields, k) &&\n                data[k] &&\n                (data.price_or_product_discount === 'Price' ||\n                  k === 'pricing_rules')\n              ) {\n                frappe.model.set_value(d.doctype, d.name, k, data[k]);\n              }\n            }\n          }\n        });\n      }\n    }\n  }\n\n  apply_product_discount(args) {\n    const items = this.frm.doc.items.filter((d) => d.is_free_item) || [];\n\n    const exist_items = items.map((row) => (row.item_code, row.pricing_rules));\n\n    args.free_item_data.forEach((pr_row) => {\n      let row_to_modify = {};\n      if (\n        !items ||\n        !in_list(exist_items, (pr_row.item_code, pr_row.pricing_rules))\n      ) {\n        row_to_modify = frappe.model.add_child(\n          this.frm.doc,\n          this.frm.doc.doctype + ' Item',\n          'items'\n        );\n      } else if (items) {\n        row_to_modify = items.filter(\n          (d) =>\n            d.item_code === pr_row.item_code &&\n            d.pricing_rules === pr_row.pricing_rules\n        )[0];\n      }\n\n      for (let key in pr_row) {\n        row_to_modify[key] = pr_row[key];\n      }\n      this.frm.script_manager.copy_from_first_row('items', row_to_modify, [\n        'expense_account',\n        'income_account',\n      ]);\n    });\n\n    // free_item_data is a temporary variable\n    args.free_item_data = '';\n    refresh_field('items');\n  }\n\n  apply_price_list(item, reset_plc_conversion) {\n    // We need to reset plc_conversion_rate sometimes because the call to\n    // `stock.stock.get_item_details.apply_price_list` is sensitive to its value\n    if (!reset_plc_conversion) {\n      this.frm.set_value('plc_conversion_rate', '');\n    }\n\n    var me = this;\n    var args = this._get_args(item);\n    if (!((args.items && args.items.length) || args.price_list)) {\n      return;\n    }\n\n    if (me.in_apply_price_list == true) return;\n\n    me.in_apply_price_list = true;\n    return this.frm\n      .call({\n        method: 'stock.stock.get_item_details.apply_price_list',\n        args: { args: args },\n        callback: function (r) {\n          if (!r.exc) {\n            frappe.run_serially([\n              () =>\n                me.frm.set_value(\n                  'price_list_currency',\n                  r.message.parent.price_list_currency\n                ),\n              () =>\n                me.frm.set_value(\n                  'plc_conversion_rate',\n                  r.message.parent.plc_conversion_rate\n                ),\n              () => {\n                if (args.items.length) {\n                  me._set_values_for_item_list(r.message.children);\n                  $.each(r.message.children || [], function (i, d) {\n                    me.apply_discount_on_item(\n                      d,\n                      d.doctype,\n                      d.name,\n                      'discount_percentage'\n                    );\n                  });\n                }\n              },\n              () => {\n                me.in_apply_price_list = false;\n              },\n            ]);\n          } else {\n            me.in_apply_price_list = false;\n          }\n        },\n      })\n      .always(() => {\n        me.in_apply_price_list = false;\n      });\n  }\n\n  remove_pricing_rule(item) {\n    let me = this;\n    const fields = [\n      'discount_percentage',\n      'discount_amount',\n      'margin_rate_or_amount',\n      'rate_with_margin',\n    ];\n\n    if (item.remove_free_item) {\n      var items = [];\n\n      me.frm.doc.items.forEach((d) => {\n        if (d.item_code != item.remove_free_item || !d.is_free_item) {\n          items.push(d);\n        }\n      });\n\n      me.frm.doc.items = items;\n      refresh_field('items');\n    } else if (item.applied_on_items && item.apply_on) {\n      const applied_on_items = item.applied_on_items.split(',');\n      me.frm.doc.items.forEach((row) => {\n        if (applied_on_items.includes(row[item.apply_on])) {\n          fields.forEach((f) => {\n            row[f] = 0;\n          });\n\n          ['pricing_rules', 'margin_type'].forEach((field) => {\n            if (row[field]) {\n              row[field] = '';\n            }\n          });\n        }\n      });\n\n      me.trigger_price_list_rate();\n    }\n  }\n\n  trigger_price_list_rate() {\n    var me = this;\n\n    this.frm.doc.items.forEach((child_row) => {\n      me.frm.script_manager.trigger(\n        'price_list_rate',\n        child_row.doctype,\n        child_row.name\n      );\n    });\n  }\n\n  // validate_company_and_party() {\n  //   var me = this;\n  //   var valid = true;\n\n  //   if (frappe.flags.ignore_company_party_validation) {\n  //     return valid;\n  //   }\n\n  //   $.each(['company', 'customer'], function (i, fieldname) {\n  //     if (\n  //       frappe.meta.has_field(me.frm.doc.doctype, fieldname) &&\n  //       !['Purchase Order', 'Purchase Invoice'].includes(me.frm.doc.doctype)\n  //     ) {\n  //       if (!me.frm.doc[fieldname]) {\n  //         frappe.msgprint(\n  //           __('Please specify') +\n  //             ': ' +\n  //             frappe.meta.get_label(\n  //               me.frm.doc.doctype,\n  //               fieldname,\n  //               me.frm.doc.name\n  //             ) +\n  //             '. ' +\n  //             __('It is needed to fetch Item Details.')\n  //         );\n  //         valid = false;\n  //       }\n  //     }\n  //   });\n  //   return valid;\n  // }\n\n  get_terms() {\n    var me = this;\n\n    stock.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function (r) {\n      if (!r.exc) {\n        me.frm.set_value('terms', r.message);\n      }\n    });\n  }\n\n  taxes_and_charges() {\n    var me = this;\n    if (this.frm.doc.taxes_and_charges) {\n      return this.frm.call({\n        method: 'stock.controllers.accounts_controller.get_taxes_and_charges',\n        args: {\n          master_doctype: frappe.meta.get_docfield(\n            this.frm.doc.doctype,\n            'taxes_and_charges',\n            this.frm.doc.name\n          ).options,\n          master_name: this.frm.doc.taxes_and_charges,\n        },\n        callback: function (r) {\n          if (!r.exc) {\n            if (me.frm.doc.shipping_rule && me.frm.doc.taxes) {\n              for (let tax of r.message) {\n                me.frm.add_child('taxes', tax);\n              }\n\n              refresh_field('taxes');\n            } else {\n              me.frm.set_value('taxes', r.message);\n              me.calculate_taxes_and_totals();\n            }\n          }\n        },\n      });\n    }\n  }\n\n  tax_category() {\n    var me = this;\n    if (me.frm.updating_party_details) return;\n\n    frappe.run_serially([\n      () => this.update_item_tax_map(),\n      () => stock.utils.set_taxes(this.frm, 'tax_category'),\n    ]);\n  }\n\n  update_item_tax_map() {\n    let me = this;\n    let item_codes = [];\n    let item_rates = {};\n    let item_tax_templates = {};\n\n    $.each(this.frm.doc.items || [], function (i, item) {\n      if (item.item_code) {\n        // Use combination of name and item code in case same item is added multiple times\n        item_codes.push([item.item_code, item.name]);\n        item_rates[item.name] = item.net_rate;\n        item_tax_templates[item.name] = item.item_tax_template;\n      }\n    });\n\n    if (item_codes.length) {\n      return this.frm.call({\n        method: 'stock.stock.get_item_details.get_item_tax_info',\n        args: {\n          company: me.frm.doc.company,\n          tax_category: cstr(me.frm.doc.tax_category),\n          item_codes: item_codes,\n          item_rates: item_rates,\n          item_tax_templates: item_tax_templates,\n        },\n        callback: function (r) {\n          if (!r.exc) {\n            $.each(me.frm.doc.items || [], function (i, item) {\n              if (\n                item.name &&\n                r.message.hasOwnProperty(item.name) &&\n                r.message[item.name].item_tax_template\n              ) {\n                item.item_tax_template = r.message[item.name].item_tax_template;\n                item.item_tax_rate = r.message[item.name].item_tax_rate;\n                me.add_taxes_from_item_tax_template(item.item_tax_rate);\n              }\n            });\n          }\n        },\n      });\n    }\n  }\n\n  item_tax_template(doc, cdt, cdn) {\n    var me = this;\n    if (me.frm.updating_party_details) return;\n\n    var item = frappe.get_doc(cdt, cdn);\n\n    if (item.item_tax_template) {\n      return this.frm.call({\n        method: 'stock.stock.get_item_details.get_item_tax_map',\n        args: {\n          company: me.frm.doc.company,\n          item_tax_template: item.item_tax_template,\n          as_json: true,\n        },\n        callback: function (r) {\n          if (!r.exc) {\n            item.item_tax_rate = r.message;\n            me.add_taxes_from_item_tax_template(item.item_tax_rate);\n            me.calculate_taxes_and_totals();\n          }\n        },\n      });\n    } else {\n      item.item_tax_rate = '{}';\n      me.calculate_taxes_and_totals();\n    }\n  }\n\n  is_recurring() {\n    // set default values for recurring documents\n    if (this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n      frappe.msgprint(__('Please set recurring after saving'));\n      this.frm.set_value('is_recurring', 0);\n      return;\n    }\n\n    if (this.frm.doc.is_recurring) {\n      if (!this.frm.doc.recurring_id) {\n        this.frm.set_value('recurring_id', this.frm.doc.name);\n      }\n\n      var owner_email =\n        this.frm.doc.owner == 'Administrator'\n          ? frappe.user_info('Administrator').email\n          : this.frm.doc.owner;\n\n      this.frm.doc.notification_email_address = $.map(\n        [cstr(owner_email), cstr(this.frm.doc.contact_email)],\n        function (v) {\n          return v || null;\n        }\n      ).join(', ');\n      this.frm.doc.repeat_on_day_of_month = frappe.datetime\n        .str_to_obj(this.frm.doc.posting_date)\n        .getDate();\n    }\n\n    refresh_many(['notification_email_address', 'repeat_on_day_of_month']);\n  }\n\n  from_date() {\n    // set to_date\n    if (this.frm.doc.from_date) {\n      var recurring_type_map = {\n        Monthly: 1,\n        Quarterly: 3,\n        'Half-yearly': 6,\n        Yearly: 12,\n      };\n\n      var months = recurring_type_map[this.frm.doc.recurring_type];\n      if (months) {\n        var to_date = frappe.datetime.add_months(\n          this.frm.doc.from_date,\n          months\n        );\n        this.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n        refresh_field('to_date');\n      }\n    }\n  }\n\n  set_gross_profit(item) {\n    if (\n      ['Sales Order', 'Quotation'].includes(this.frm.doc.doctype) &&\n      item.valuation_rate\n    ) {\n      var rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n      item.gross_profit = flt(\n        (rate - item.valuation_rate) * item.stock_qty,\n        precision('amount', item)\n      );\n    }\n  }\n\n  setup_item_selector() {\n    // TODO: remove item selector\n\n    return;\n    // if(!this.item_selector) {\n    // \tthis.item_selector = new stock.ItemSelector({frm: this.frm});\n    // }\n  }\n\n  get_advances() {\n    if (!this.frm.is_return) {\n      var me = this;\n      return this.frm.call({\n        method: 'set_advances',\n        doc: this.frm.doc,\n        callback: function (r, rt) {\n          refresh_field('advances');\n          me.frm.dirty();\n        },\n      });\n    }\n  }\n\n  make_payment_entry() {\n    let via_journal_entry =\n      this.frm.doc.__onload &&\n      this.frm.doc.__onload.make_payment_via_journal_entry;\n    if (this.has_discount_in_schedule() && !via_journal_entry) {\n      // If early payment discount is applied, ask user for reference date\n      this.prompt_user_for_reference_date();\n    } else {\n      this.make_mapped_payment_entry();\n    }\n  }\n\n  make_mapped_payment_entry(args) {\n    var me = this;\n    args = args || { dt: this.frm.doc.doctype, dn: this.frm.doc.name };\n    return frappe.call({\n      method: me.get_method_for_payment(),\n      args: args,\n      callback: function (r) {\n        var doclist = frappe.model.sync(r.message);\n        frappe.set_route('Form', doclist[0].doctype, doclist[0].name);\n      },\n    });\n  }\n\n  prompt_user_for_reference_date() {\n    let me = this;\n    frappe.prompt(\n      {\n        label: __('Cheque/Reference Date'),\n        fieldname: 'reference_date',\n        fieldtype: 'Date',\n        reqd: 1,\n      },\n      (values) => {\n        let args = {\n          dt: me.frm.doc.doctype,\n          dn: me.frm.doc.name,\n          reference_date: values.reference_date,\n        };\n        me.make_mapped_payment_entry(args);\n      },\n      __('Reference Date for Early Payment Discount'),\n      __('Continue')\n    );\n  }\n\n  has_discount_in_schedule() {\n    let is_eligible = in_list(\n      ['Sales Order', 'Sales Invoice', 'Purchase Order', 'Purchase Invoice'],\n      this.frm.doctype\n    );\n    let has_payment_schedule =\n      this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length;\n    if (!is_eligible || !has_payment_schedule) return false;\n\n    let has_discount = this.frm.doc.payment_schedule.some(\n      (row) => row.discount\n    );\n    return has_discount;\n  }\n\n  make_quality_inspection() {\n    let data = [];\n    const fields = [\n      {\n        label: 'Items',\n        fieldtype: 'Table',\n        fieldname: 'items',\n        cannot_add_rows: true,\n        in_place_edit: true,\n        data: data,\n        get_data: () => {\n          return data;\n        },\n        fields: [\n          {\n            fieldtype: 'Data',\n            fieldname: 'docname',\n            hidden: true,\n          },\n          {\n            fieldtype: 'Read Only',\n            fieldname: 'item_code',\n            label: __('Item Code'),\n            in_list_view: true,\n          },\n          {\n            fieldtype: 'Read Only',\n            fieldname: 'item_name',\n            label: __('Item Name'),\n            in_list_view: true,\n          },\n          {\n            fieldtype: 'Float',\n            fieldname: 'qty',\n            label: __('Accepted Quantity'),\n            in_list_view: true,\n            read_only: true,\n          },\n          {\n            fieldtype: 'Float',\n            fieldname: 'sample_size',\n            label: __('Sample Size'),\n            reqd: true,\n            in_list_view: true,\n          },\n          {\n            fieldtype: 'Data',\n            fieldname: 'description',\n            label: __('Description'),\n            hidden: true,\n          },\n          {\n            fieldtype: 'Data',\n            fieldname: 'serial_no',\n            label: __('Serial No'),\n            hidden: true,\n          },\n          {\n            fieldtype: 'Data',\n            fieldname: 'batch_no',\n            label: __('Batch No'),\n            hidden: true,\n          },\n        ],\n      },\n    ];\n\n    const me = this;\n    const dialog = new frappe.ui.Dialog({\n      title: __('Select Items for Quality Inspection'),\n      size: 'extra-large',\n      fields: fields,\n      primary_action: function () {\n        const data = dialog.get_values();\n        frappe.call({\n          method: 'stock.controllers.stock_controller.make_quality_inspections',\n          args: {\n            doctype: me.frm.doc.doctype,\n            docname: me.frm.doc.name,\n            items: data.items,\n          },\n          freeze: true,\n          callback: function (r) {\n            if (r.message.length > 0) {\n              if (r.message.length === 1) {\n                frappe.set_route('Form', 'Quality Inspection', r.message[0]);\n              } else {\n                frappe.route_options = {\n                  reference_type: me.frm.doc.doctype,\n                  reference_name: me.frm.doc.name,\n                };\n                frappe.set_route('List', 'Quality Inspection');\n              }\n            }\n            dialog.hide();\n          },\n        });\n      },\n      primary_action_label: __('Create'),\n    });\n\n    this.frm.doc.items.forEach((item) => {\n      if (!item.quality_inspection) {\n        let dialog_items = dialog.fields_dict.items;\n        dialog_items.df.data.push({\n          docname: item.name,\n          item_code: item.item_code,\n          item_name: item.item_name,\n          qty: item.qty,\n          description: item.description,\n          serial_no: item.serial_no,\n          batch_no: item.batch_no,\n          sample_size: item.sample_quantity,\n        });\n        dialog_items.grid.refresh();\n      }\n    });\n\n    data = dialog.fields_dict.items.df.data;\n    if (!data.length) {\n      frappe.msgprint(\n        __(\n          'All items in this document already have a linked Quality Inspection.'\n        )\n      );\n    } else {\n      dialog.show();\n    }\n  }\n\n  // get_method_for_payment() {\n  // \tvar method = \"stock.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n  // \tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\n  // \t\tif(in_list(['Sales Invoice', 'Purchase Invoice'],  cur_frm.doc.doctype)){\n  // \t\t\tmethod = \"stock.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n  // \t\t}else {\n  // \t\t\tmethod= \"stock.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n  // \t\t}\n  // \t}\n\n  // \treturn method\n  // }\n\n  set_query_for_batch(doc, cdt, cdn) {\n    // Show item's batches in the dropdown of batch no\n\n    var me = this;\n    var item = frappe.get_doc(cdt, cdn);\n\n    if (!item.item_code) {\n      frappe.throw(__('Please enter Item Code to get batch no'));\n    } else if (\n      doc.doctype == 'Purchase Receipt' ||\n      (doc.doctype == 'Purchase Invoice' && doc.update_stock)\n    ) {\n      return {\n        filters: { item: item.item_code },\n      };\n    } else {\n      let filters = {\n        item_code: item.item_code,\n        posting_date: me.frm.doc.posting_date || frappe.datetime.nowdate(),\n      };\n\n      if (doc.is_return) {\n        filters['is_return'] = 1;\n      }\n\n      if (item.warehouse) filters['warehouse'] = item.warehouse;\n\n      return {\n        query: 'stock.controllers.queries.get_batch_no',\n        filters: filters,\n      };\n    }\n  }\n\n  set_query_for_item_tax_template(doc, cdt, cdn) {\n    var item = frappe.get_doc(cdt, cdn);\n    if (!item.item_code) {\n      return doc.company ? { filters: { company: doc.company } } : {};\n    } else {\n      let filters = {\n        item_code: item.item_code,\n        valid_from: [\n          '<=',\n          doc.transaction_date || doc.bill_date || doc.posting_date,\n        ],\n        item_group: item.item_group,\n      };\n\n      if (doc.tax_category) filters['tax_category'] = doc.tax_category;\n      if (doc.company) filters['company'] = doc.company;\n      return {\n        query: 'stock.controllers.queries.get_tax_template',\n        filters: filters,\n      };\n    }\n  }\n\n  payment_terms_template() {\n    var me = this;\n    const doc = this.frm.doc;\n    if (doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\n      var posting_date = doc.posting_date || doc.transaction_date;\n      frappe.call({\n        method: 'stock.controllers.accounts_controller.get_payment_terms',\n        args: {\n          terms_template: doc.payment_terms_template,\n          posting_date: posting_date,\n          grand_total: doc.rounded_total || doc.grand_total,\n          base_grand_total: doc.base_rounded_total || doc.base_grand_total,\n          bill_date: doc.bill_date,\n        },\n        callback: function (r) {\n          if (r.message && !r.exc) {\n            me.frm.set_value('payment_schedule', r.message);\n            const company_currency = me.get_company_currency();\n            me.update_payment_schedule_grid_labels(company_currency);\n          }\n        },\n      });\n    }\n  }\n\n  payment_term(doc, cdt, cdn) {\n    const me = this;\n    var row = locals[cdt][cdn];\n    if (row.payment_term) {\n      frappe.call({\n        method:\n          'stock.controllers.accounts_controller.get_payment_term_details',\n        args: {\n          term: row.payment_term,\n          bill_date: this.frm.doc.bill_date,\n          posting_date:\n            this.frm.doc.posting_date || this.frm.doc.transaction_date,\n          grand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total,\n          base_grand_total:\n            this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total,\n        },\n        callback: function (r) {\n          if (r.message && !r.exc) {\n            for (var d in r.message) {\n              frappe.model.set_value(cdt, cdn, d, r.message[d]);\n              const company_currency = me.get_company_currency();\n              me.update_payment_schedule_grid_labels(company_currency);\n            }\n          }\n        },\n      });\n    }\n  }\n\n  against_blanket_order(doc, cdt, cdn) {\n    var item = locals[cdt][cdn];\n    if (!item.against_blanket_order) {\n      frappe.model.set_value(\n        this.frm.doctype + ' Item',\n        item.name,\n        'blanket_order',\n        null\n      );\n      frappe.model.set_value(\n        this.frm.doctype + ' Item',\n        item.name,\n        'blanket_order_rate',\n        0.0\n      );\n    }\n  }\n\n  blanket_order(doc, cdt, cdn) {\n    var me = this;\n    var item = locals[cdt][cdn];\n    if (\n      item.blanket_order &&\n      (item.parenttype == 'Sales Order' || item.parenttype == 'Purchase Order')\n    ) {\n      frappe.call({\n        method: 'stock.stock.get_item_details.get_blanket_order_details',\n        args: {\n          args: {\n            item_code: item.item_code,\n            customer: doc.customer,\n            supplier: doc.supplier,\n            company: doc.company,\n            transaction_date: doc.transaction_date,\n            blanket_order: item.blanket_order,\n          },\n        },\n        callback: function (r) {\n          if (!r.message) {\n            frappe.throw(\n              __('Invalid Blanket Order for the selected Customer and Item')\n            );\n          } else {\n            frappe.run_serially([\n              () =>\n                frappe.model.set_value(\n                  cdt,\n                  cdn,\n                  'blanket_order_rate',\n                  r.message.blanket_order_rate\n                ),\n              () => me.frm.script_manager.trigger('price_list_rate', cdt, cdn),\n            ]);\n          }\n        },\n      });\n    }\n  }\n\n  set_reserve_warehouse() {\n    this.autofill_warehouse(\n      this.frm.doc.supplied_items,\n      'reserve_warehouse',\n      this.frm.doc.set_reserve_warehouse\n    );\n  }\n\n  set_warehouse() {\n    this.autofill_warehouse(\n      this.frm.doc.items,\n      'warehouse',\n      this.frm.doc.set_warehouse\n    );\n  }\n\n  set_target_warehouse() {\n    this.autofill_warehouse(\n      this.frm.doc.items,\n      'target_warehouse',\n      this.frm.doc.set_target_warehouse\n    );\n  }\n\n  set_from_warehouse() {\n    this.autofill_warehouse(\n      this.frm.doc.items,\n      'from_warehouse',\n      this.frm.doc.set_from_warehouse\n    );\n  }\n\n  autofill_warehouse(child_table, warehouse_field, warehouse) {\n    if (warehouse && child_table && child_table.length) {\n      let doctype = child_table[0].doctype;\n      $.each(child_table || [], function (i, item) {\n        frappe.model.set_value(doctype, item.name, warehouse_field, warehouse);\n      });\n    }\n  }\n\n  coupon_code() {\n    if (this.frm.doc.coupon_code || this.frm._last_coupon_code) {\n      // reset pricing rules if coupon code is set or is unset\n      const _ignore_pricing_rule = this.frm.doc.ignore_pricing_rule;\n      return frappe.run_serially([\n        () => (this.frm.doc.ignore_pricing_rule = 1),\n        () => this.frm.trigger('ignore_pricing_rule'),\n        () => (this.frm.doc.ignore_pricing_rule = _ignore_pricing_rule),\n        () => this.frm.trigger('apply_pricing_rule'),\n        () => (this.frm._last_coupon_code = this.frm.doc.coupon_code),\n      ]);\n    }\n  }\n};\n\nstock.show_serial_batch_selector = function (\n  frm,\n  item_row,\n  callback,\n  on_close,\n  show_dialog\n) {\n  let warehouse, receiving_stock, existing_stock;\n\n  let warehouse_field = 'warehouse';\n  if (frm.doc.is_return) {\n    if (['Purchase Receipt', 'Purchase Invoice'].includes(frm.doc.doctype)) {\n      existing_stock = true;\n      warehouse = item_row.warehouse;\n    } else if (['Delivery Note', 'Sales Invoice'].includes(frm.doc.doctype)) {\n      receiving_stock = true;\n    }\n  } else {\n    if (frm.doc.doctype == 'Stock Entry') {\n      if (frm.doc.purpose == 'Material Receipt') {\n        receiving_stock = true;\n      } else {\n        existing_stock = true;\n        warehouse = item_row.s_warehouse;\n      }\n\n      if (\n        in_list(\n          [\n            'Material Transfer',\n            'Send to Subcontractor',\n            'Material Issue',\n            'Material Consumption for Manufacture',\n            'Material Transfer for Manufacture',\n          ],\n          frm.doc.purpose\n        )\n      ) {\n        warehouse_field = 's_warehouse';\n      } else {\n        warehouse_field = 't_warehouse';\n      }\n    } else {\n      existing_stock = true;\n      warehouse = item_row.warehouse;\n    }\n  }\n\n  if (!warehouse) {\n    if (receiving_stock) {\n      warehouse = ['like', ''];\n    } else if (existing_stock) {\n      warehouse = ['!=', ''];\n    }\n  }\n\n  frappe.require(\n    'assets/stock/js/utils/serial_no_batch_selector.js',\n    function () {\n      if (in_list(['Sales Invoice', 'Delivery Note'], frm.doc.doctype)) {\n        item_row.type_of_transaction = frm.doc.is_return ? 'Inward' : 'Outward';\n      } else {\n        item_row.type_of_transaction = frm.doc.is_return ? 'Outward' : 'Inward';\n      }\n\n      new stock.SerialBatchPackageSelector(frm, item_row, (r) => {\n        if (r) {\n          let update_values = {\n            serial_and_batch_bundle: r.name,\n            qty: Math.abs(r.total_qty),\n          };\n\n          if (r.warehouse) {\n            update_values[warehouse_field] = r.warehouse;\n          }\n\n          frappe.model.set_value(\n            item_row.doctype,\n            item_row.name,\n            update_values\n          );\n        }\n      });\n    }\n  );\n};\n\nstock.apply_putaway_rule = (frm, purpose = null) => {\n  if (!frm.doc.company) {\n    frappe.throw({\n      message: __('Please select a Company first.'),\n      title: __('Mandatory'),\n    });\n  }\n  if (!frm.doc.items.length) return;\n\n  frappe.call({\n    method: 'stock.stock.doctype.putaway_rule.putaway_rule.apply_putaway_rule',\n    args: {\n      doctype: frm.doctype,\n      items: frm.doc.items,\n      company: frm.doc.company,\n      sync: true,\n      purpose: purpose,\n    },\n    callback: (result) => {\n      if (!result.exc && result.message) {\n        frm.clear_table('items');\n\n        let items = result.message;\n        items.forEach((row) => {\n          delete row['name']; // dont overwrite name from server side\n          let child = frm.add_child('items');\n          Object.assign(child, row);\n          frm.script_manager.trigger('qty', child.doctype, child.name);\n        });\n        frm.get_field('items').grid.refresh();\n      }\n    },\n  });\n};\n", "\n\tfrappe.templates['item_selector'] = `<div class=\"app-listing item-list image-view-container item-selector\">\n{% for (var i=0; i < data.length; i++) { var item = data[i]; %}\n\t{% if (i % 4 === 0) { %}<div class=\"image-view-row\">{% } %}\n\t<div class=\"image-view-item\" data-name=\"{{ item.name }}\">\n\t\t<div class=\"image-view-header doclist-row\">\n\t\t\t<div class=\"list-value\">\n\t\t\t\t<a class=\"grey list-id\" data-name=\"{{item.name}}\"\n\t\t\t\t\ttitle=\"{{ item.item_name || item.name}}\">\n\t\t\t\t\t{{item.item_name || item.name}}</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"image-view-body\">\n\t\t\t<a  data-item-code=\"{{ item.name }}\"\n\t\t\t\ttitle=\"{{ item.item_name || item.name }}\"\n\t\t\t>\n\t\t\t\t<div class=\"image-field\"\n\t\t\t\t\tstyle=\"\n\t\t\t\t\t{% if (!item.image) { %}\n\t\t\t\t\t\tbackground-color: #fafbfc;\n\t\t\t\t\t{% } %}\n\t\t\t\t\tborder: 0px;\"\n\t\t\t\t>\n\t\t\t\t\t{% if (!item.image) { %}\n\t\t\t\t\t<span class=\"placeholder-text\">\n\t\t\t\t\t\t{%= frappe.get_abbr(item.item_name || item.name) %}\n\t\t\t\t\t</span>\n\t\t\t\t\t{% } %}\n\t\t\t\t\t{% if (item.image) { %}\n\t\t\t\t\t<img src=\"{{ item.image }}\" alt=\"{{item.item_name || item.name}}\">\n\t\t\t\t\t{% } %}\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t{% if ((i % 4 === 3) || (i===data.length - 1)) { %}</div>{% } %}\n{% endfor %}\n</div>\n`;\n", "stock.ItemSelector = class ItemSelector {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = 'item_code';\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = stock.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tvar me = this;\n\t\tif(!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__('Add Items'), function() {\n\t\t\t\tif(!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function() { me.dialog.input.focus(); }, 1000);\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_dialog() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Items')\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html('<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>');\n\n\t\tthis.dialog.input = body.find('.form-control');\n\t\tthis.dialog.results = body.find('.results');\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on('click', '.image-view-item', function() {\n\t\t\tme.add_item($(this).attr('data-name'));\n\t\t});\n\n\t\tthis.dialog.input.on('keyup', function() {\n\t\t\tif(me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function() {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t}\n\n\tadd_item(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif(d[this.item_field]===item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', d.qty + 1);\n\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: 'green'});\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => { d = this.grid.add_new_row(); },\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', 1);\n\t\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: 'green'});\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t}\n\n\trender_items() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {}\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function(results) {\n\t\t\t$.each(results, function(i, d) {\n\t\t\t\tif(!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template('item_selector', {'data': results}));\n\t\t});\n\t}\n};\n", "frappe.provide(\"frappe.help.help_links\");\n\nconst docsUrl = \"https://stock.com/docs/\";\n\nfrappe.help.help_links[\"Form/Rename Tool\"] = [\n\t{\n\t\tlabel: \"Bulk Rename\",\n\t\turl: docsUrl + \"user/manual/en/transactions-bulk-rename\",\n\t},\n];\n\n//Setup\n\nfrappe.help.help_links[\"List/User\"] = [\n\t{\n\t\tlabel: \"New User\",\n\t\turl: docsUrl + \"user/manual/en/adding-users\",\n\t},\n\t{\n\t\tlabel: \"Rename User\",\n\t\turl: docsUrl + \"user/manual/en/renaming-documents\",\n\t},\n];\n\nfrappe.help.help_links[\"permission-manager\"] = [\n\t{\n\t\tlabel: \"Role Based Permissions\",\n\t\turl: docsUrl + \"user/manual/en/role-based-permissions\",\n\t},\n\t{\n\t\tlabel: \"Managing Perm Level in Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/managing-perm-level\",\n\t},\n\t{\n\t\tlabel: \"User Permissions\",\n\t\turl: docsUrl + \"user/manual/en/user-permissions\",\n\t},\n\t{\n\t\tlabel: \"Sharing\",\n\t\turl: docsUrl + \"user/manual/en/sharing\",\n\t},\n\t{\n\t\tlabel: \"Password\",\n\t\turl: docsUrl + \"user/manual/en/change-password\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/System Settings\"] = [\n\t{\n\t\tlabel: \"System Settings\",\n\t\turl: docsUrl + \"user/manual/en/system-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/data-import\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/data-import\",\n\t},\n];\n\nfrappe.help.help_links[\"module_setup\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/role-based-permissions\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Document Naming Settings\"] = [\n\t{\n\t\tlabel: \"Naming Series\",\n\t\turl: docsUrl + \"user/manual/en/document-naming-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Global Defaults\"] = [\n\t{\n\t\tlabel: \"Global Settings\",\n\t\turl: docsUrl + \"user/manual/en/global-defaults\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Letter Head\"] = [\n\t{\n\t\tlabel: \"Letter Head\",\n\t\turl: docsUrl + \"user/manual/en/letter-head\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Address Template\"] = [\n\t{\n\t\tlabel: \"Address Template\",\n\t\turl: docsUrl + \"user/manual/en/address-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Terms and Conditions\"] = [\n\t{\n\t\tlabel: \"Terms and Conditions\",\n\t\turl: docsUrl + \"user/manual/en/terms-and-conditions\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Cheque Print Template\"] = [\n\t{\n\t\tlabel: \"Cheque Print Template\",\n\t\turl: docsUrl + \"user/manual/en/cheque-print-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Email Account\"] = [\n\t{\n\t\tlabel: \"Email Account\",\n\t\turl: docsUrl + \"user/manual/en/email-account\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Auto Email Report\"] = [\n\t{\n\t\tlabel: \"Auto Email Reports\",\n\t\turl: docsUrl + \"user/manual/en/auto-email-reports\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Settings\"] = [\n\t{\n\t\tlabel: \"Print Settings\",\n\t\turl: docsUrl + \"user/manual/en/print-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"print-format-builder\"] = [\n\t{\n\t\tlabel: \"Print Format Builder\",\n\t\turl: docsUrl + \"user/manual/en/print-format-builder\",\n\t},\n];\n\n//setup-integrations\n\nfrappe.help.help_links[\"Form/PayPal Settings\"] = [\n\t{\n\t\tlabel: \"PayPal Settings\",\n\t\turl: docsUrl + \"user/manual/en/paypal-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Razorpay Settings\"] = [\n\t{\n\t\tlabel: \"Razorpay Settings\",\n\t\turl: docsUrl + \"user/manual/en/razorpay-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Dropbox Settings\"] = [\n\t{\n\t\tlabel: \"Dropbox Settings\",\n\t\turl: docsUrl + \"user/manual/en/dropbox-backup\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/LDAP Settings\"] = [\n\t{\n\t\tlabel: \"LDAP Settings\",\n\t\turl: docsUrl + \"user/manual/en/ldap-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stripe Settings\"] = [\n\t{\n\t\tlabel: \"Stripe Settings\",\n\t\turl: docsUrl + \"user/manual/en/stripe-integration\",\n\t},\n];\n\n//Sales\n\nfrappe.help.help_links[\"Form/Quotation\"] = [\n\t{ label: \"Quotation\", url: docsUrl + \"user/manual/en/quotation\" },\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/applying-discount\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Drop Shipping\",\n\t\turl: docsUrl + \"user/manual/en/drop-shipping\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Close Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/close-sales-order\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Product Bundle\"] = [\n\t{\n\t\tlabel: \"Product Bundle\",\n\t\turl: docsUrl + \"user/manual/en/product-bundle\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Selling Settings\"] = [\n\t{\n\t\tlabel: \"Selling Settings\",\n\t\turl: docsUrl + \"user/manual/en/selling-settings\",\n\t},\n];\n\n//Buying\n\nfrappe.help.help_links[\"List/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Request for Quotation\"] = [\n\t{\n\t\tlabel: \"Request for Quotation\",\n\t\turl: docsUrl + \"user/manual/en/request-for-quotation\",\n\t},\n\t{\n\t\tlabel: \"RFQ Video\",\n\t\turl: docsUrl + \"user/videos/learn/request-for-quotation.html\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Supplier Quotation\"] = [\n\t{\n\t\tlabel: \"Supplier Quotation\",\n\t\turl: docsUrl + \"user/manual/en/supplier-quotation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Buying Settings\"] = [\n\t{\n\t\tlabel: \"Buying Settings\",\n\t\turl: docsUrl + \"user/manual/en/buying-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Item UoM\",\n\t\turl: docsUrl + \"user/manual/en/purchasing-in-different-unit\",\n\t},\n\t{\n\t\tlabel: \"Supplier Item Code\",\n\t\turl: docsUrl + \"user/manual/en/maintaining-suppliers-part-no-in-item\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Price List\"] = [\n\t{\n\t\tlabel: \"Price List\",\n\t\turl: docsUrl + \"user/manual/en/price-lists\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Authorization Rule\"] = [\n\t{\n\t\tlabel: \"Authorization Rule\",\n\t\turl: docsUrl + \"user/manual/en/authorization-rule\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/SMS Settings\"] = [\n\t{\n\t\tlabel: \"SMS Settings\",\n\t\turl: docsUrl + \"user/manual/en/sms-setting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Stock Reconciliation\",\n\t\turl: docsUrl + \"user/manual/en/stock-reconciliation\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Territory\"] = [\n\t{\n\t\tlabel: \"Territory\",\n\t\turl: docsUrl + \"user/manual/en/territory\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Workflow\"] = [\n\t{ label: \"Workflow\", url: docsUrl + \"user/manual/en/workflows\" },\n];\n\nfrappe.help.help_links[\"List/Company\"] = [\n\t{\n\t\tlabel: \"Company\",\n\t\turl: docsUrl + \"user/manual/en/company-setup\",\n\t},\n\t{\n\t\tlabel: \"Delete All Related Transactions for a Company\",\n\t\turl: docsUrl + \"user/manual/en/delete_company_transactions\",\n\t},\n];\n\n//Accounts\n\nfrappe.help.help_links[\"Tree/Account\"] = [\n\t{\n\t\tlabel: \"Chart of Accounts\",\n\t\turl: docsUrl + \"user/manual/en/chart-of-accounts\",\n\t},\n\t{\n\t\tlabel: \"Managing Tree Mastes\",\n\t\turl: docsUrl + \"user/manual/en/managing-tree-structure-masters\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n];\n\nfrappe.help.help_links[\"point-of-sale\"] = [\n\t{\n\t\tlabel: \"Point of Sale Invoice\",\n\t\turl: docsUrl + \"user/manual/en/point-of-sales\",\n\t},\n];\n\nfrappe.help.help_links[\"List/POS Profile\"] = [\n\t{\n\t\tlabel: \"Point of Sale Profile\",\n\t\turl: docsUrl + \"user/manual/en/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/POS Profile\"] = [\n\t{\n\t\tlabel: \"POS Profile\",\n\t\turl: docsUrl + \"user/manual/en/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Invoice\"] = [\n\t{\n\t\tlabel: \"Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/purchase-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/auto-repeat\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Journal Entry\"] = [\n\t{\n\t\tlabel: \"Journal Entry\",\n\t\turl: docsUrl + \"user/manual/en/journal-entry\",\n\t},\n\t{\n\t\tlabel: \"Advance Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/advance-payment-entry\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/opening-balance\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Entry\"] = [\n\t{\n\t\tlabel: \"Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/payment-entry\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Request\"] = [\n\t{\n\t\tlabel: \"Payment Request\",\n\t\turl: docsUrl + \"user/manual/en/payment-request\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset\"] = [\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset Category\"] = [\n\t{\n\t\tlabel: \"Asset Category\",\n\t\turl: docsUrl + \"user/manual/en/asset-category\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Cost Center\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/budgeting\" },\n];\n\n//Stock\n\nfrappe.help.help_links[\"List/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/calculation-of-valuation-rate-in-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl: docsUrl + \"user/manual/en/item-valuation-transactions\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Receipt\"] = [\n\t{\n\t\tlabel: \"Purchase Receipt\",\n\t\turl: docsUrl + \"user/manual/en/purchase-receipt\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/sales-return\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Installation Note\"] = [\n\t{\n\t\tlabel: \"Installation Note\",\n\t\turl: docsUrl + \"user/manual/en/installation-note\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Budget\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/budgeting\" },\n];\n\nfrappe.help.help_links[\"List/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl: docsUrl + \"user/manual/en/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl: docsUrl + \"user/manual/en/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock-entry\" },\n\t{\n\t\tlabel: \"Stock Entry Types\",\n\t\turl: docsUrl + \"user/manual/en/stock-entry-purpose\",\n\t},\n\t{\n\t\tlabel: \"Repack Entry\",\n\t\turl: docsUrl + \"user/manual/en/repack-entry\",\n\t},\n\t{\n\t\tlabel: \"Opening Stock\",\n\t\turl: docsUrl + \"user/manual/en/opening-stock\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock-entry\" },\n];\n\nfrappe.help.help_links[\"Tree/Warehouse\"] = [\n\t{ label: \"Warehouse\", url: docsUrl + \"user/manual/en/warehouse\" },\n];\n\nfrappe.help.help_links[\"List/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/serial-no\" },\n];\n\nfrappe.help.help_links[\"Form/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/serial-no\" },\n];\n\nfrappe.help.help_links[\"List/Batch\"] = [\n\t{ label: \"Batch\", url: docsUrl + \"user/manual/en/batch\" },\n];\n\nfrappe.help.help_links[\"Form/Batch\"] = [\n\t{ label: \"Batch\", url: docsUrl + \"user/manual/en/batch\" },\n];\n\nfrappe.help.help_links[\"Form/Packing Slip\"] = [\n\t{\n\t\tlabel: \"Packing Slip\",\n\t\turl: docsUrl + \"user/manual/en/packing-slip\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Quality Inspection\"] = [\n\t{\n\t\tlabel: \"Quality Inspection\",\n\t\turl: docsUrl + \"user/manual/en/quality-inspection\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Landed Cost Voucher\"] = [\n\t{\n\t\tlabel: \"Landed Cost Voucher\",\n\t\turl: docsUrl + \"user/manual/en/landed-cost-voucher\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Item Group\"] = [\n\t{\n\t\tlabel: \"Item Group\",\n\t\turl: docsUrl + \"user/manual/en/item-group\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item Attribute\"] = [\n\t{\n\t\tlabel: \"Item Attribute\",\n\t\turl: docsUrl + \"user/manual/en/item-attribute\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/UOM\"] = [\n\t{\n\t\tlabel: \"Fractions in UOM\",\n\t\turl: docsUrl + \"user/manual/en/managing-fractions-in-uom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Opening Stock Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock-reconciliation\",\n\t},\n];\n\n//CRM\n\nfrappe.help.help_links[\"Form/Lead\"] = [\n\t{ label: \"Lead\", url: docsUrl + \"user/manual/en/lead\" },\n];\n\nfrappe.help.help_links[\"Form/Opportunity\"] = [\n\t{ label: \"Opportunity\", url: docsUrl + \"user/manual/en/opportunity\" },\n];\n\nfrappe.help.help_links[\"Form/Address\"] = [\n\t{ label: \"Address\", url: docsUrl + \"user/manual/en/address\" },\n];\n\nfrappe.help.help_links[\"Form/Contact\"] = [\n\t{ label: \"Contact\", url: docsUrl + \"user/manual/en/contact\" },\n];\n\nfrappe.help.help_links[\"Form/Newsletter\"] = [\n\t{ label: \"Newsletter\", url: docsUrl + \"user/manual/en/newsletter\" },\n];\n\nfrappe.help.help_links[\"Form/Campaign\"] = [\n\t{ label: \"Campaign\", url: docsUrl + \"user/manual/en/campaign\" },\n];\n\nfrappe.help.help_links[\"Tree/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/sales-person\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person Target\",\n\t\turl: docsUrl + \"user/manual/en/sales-person-target-allocation\",\n\t},\n\t{\n\t\tlabel: \"Sales Person in Transactions\",\n\t\turl: docsUrl + \"user/manual/en/sales-persons-in-the-sales-transactions\",\n\t},\n];\n\n//Manufacturing\n\nfrappe.help.help_links[\"Form/BOM\"] = [\n\t{\n\t\tlabel: \"Bill of Material\",\n\t\turl: docsUrl + \"user/manual/en/bill-of-materials\",\n\t},\n\t{\n\t\tlabel: \"Nested BOM Structure\",\n\t\turl: docsUrl + \"user/manual/en/managing-multi-level-bom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Work Order\"] = [\n\t{\n\t\tlabel: \"Work Order\",\n\t\turl: docsUrl + \"user/manual/en/work-order\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Workstation\"] = [\n\t{\n\t\tlabel: \"Workstation\",\n\t\turl: docsUrl + \"user/manual/en/workstation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Operation\"] = [\n\t{\n\t\tlabel: \"Operation\",\n\t\turl: docsUrl + \"user/manual/en/operation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/BOM Update Tool\"] = [\n\t{\n\t\tlabel: \"BOM Update Tool\",\n\t\turl: docsUrl + \"user/manual/en/bom-update-tool\",\n\t},\n];\n\n//Customize\n\nfrappe.help.help_links[\"Form/Customize Form\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/custom-field\",\n\t},\n\t{\n\t\tlabel: \"Customize Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-form\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/custom-field\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/custom-field\",\n\t},\n];\n", "\n\tfrappe.templates['item_quick_entry'] = `<div class=\"h6 uppercase\" style=\"margin-top: 30px;\">{{ __(\"Variant Attributes\") }}</div>\n<div class=\"attributes hide-control\">\n</div>\n`;\n", "frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.ContactAddressQuickEntryForm = class ContactAddressQuickEntryForm extends frappe.ui.form.QuickEntryForm {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tsuper(doctype, after_insert, init_callback, doc, force);\n\t\tthis.skip_redirect_on_error = true;\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tsuper.render_dialog();\n\t}\n\n\tinsert() {\n\t\t/**\n\t\t * Using alias fieldnames because the doctype definition define \"email_id\" and \"mobile_no\" as readonly fields.\n\t\t * Therefor, resulting in the fields being \"hidden\".\n\t\t */\n\t\tconst map_field_names = {\n\t\t\t\"email_address\": \"email_id\",\n\t\t\t\"mobile_number\": \"mobile_no\",\n\t\t};\n\n\t\tObject.entries(map_field_names).forEach(([fieldname, new_fieldname]) => {\n\t\t\tthis.dialog.doc[new_fieldname] = this.dialog.doc[fieldname];\n\t\t\tdelete this.dialog.doc[fieldname];\n\t\t});\n\n\t\treturn super.insert();\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Email Id\"),\n\t\t\tfieldname: \"email_address\",\n\t\t\tfieldtype: \"Data\",\n\t\t\toptions: \"Email\",\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\tfieldname: \"mobile_number\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\tfieldname: \"address_line1\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\tfieldname: \"address_line2\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\tfieldname: \"pincode\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"City\"),\n\t\t\tfieldname: \"city\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"State\"),\n\t\t\tfieldname: \"state\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Country\"),\n\t\t\tfieldname: \"country\",\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Country\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\tfieldname: \"customer_pos_id\",\n\t\t\tfieldtype: \"Data\",\n\t\t\thidden: 1\n\t\t}];\n\n\t\treturn variant_fields;\n\t}\n}\n", "frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.ContactAddressQuickEntryForm;\n", "frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.SupplierQuickEntryForm = frappe.ui.form.ContactAddressQuickEntryForm;\n", "class CallPopup {\n\tconstructor(call_log) {\n\t\tthis.caller_number = call_log.from;\n\t\tthis.call_log = call_log;\n\t\tthis.setup_listener();\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tfrappe.utils.play_sound('incoming-call');\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\t'static': true,\n\t\t\t'minimizable': true\n\t\t});\n\t\tthis.dialog.get_close_btn().show();\n\t\tthis.setup_dialog();\n\t\tthis.set_call_status();\n\t\tfrappe.utils.bind_actions_with_object(this.dialog.$body, this);\n\t\tthis.dialog.$wrapper.addClass('call-popup');\n\t\tthis.dialog.get_close_btn().unbind('click').click(this.close_modal.bind(this));\n\t\tthis.dialog.show();\n\t}\n\n\tsetup_dialog() {\n\t\tthis.setup_call_details();\n\t\tthis.dialog.$body.empty().append(this.caller_info);\n\t}\n\n\tset_indicator(color, blink=false) {\n\t\tlet classes = `indicator ${color} ${blink ? 'blink': ''}`;\n\t\tthis.dialog.header.find('.indicator').attr('class', classes);\n\t}\n\n\tset_call_status(call_status) {\n\t\tlet title = '';\n\t\tcall_status = call_status || this.call_log.status;\n\t\tif (['Ringing'].includes(call_status) || !call_status) {\n\t\t\ttitle = __('Incoming call from {0}', [this.get_caller_name() || this.caller_number]);\n\t\t\tthis.set_indicator('blue', true);\n\t\t} else if (call_status === 'In Progress') {\n\t\t\ttitle = __('Call Connected');\n\t\t\tthis.set_indicator('green');\n\t\t} else if (['No Answer', 'Missed'].includes(call_status)) {\n\t\t\tthis.set_indicator('yellow');\n\t\t\ttitle = __('Call Missed');\n\t\t} else if (['Completed', 'Busy', 'Failed'].includes(call_status)) {\n\t\t\tthis.set_indicator('red');\n\t\t\ttitle = __('Call Ended');\n\t\t} else {\n\t\t\tthis.set_indicator('blue');\n\t\t\ttitle = call_status;\n\t\t}\n\t\tthis.dialog.set_title(title);\n\t}\n\n\tupdate_call_log(call_log, missed) {\n\t\tthis.call_log = call_log;\n\t\tthis.set_call_status(missed ? 'Missed': null);\n\t}\n\n\tclose_modal() {\n\t\tthis.dialog.hide();\n\t\tdelete stock.call_popup;\n\t}\n\n\tcall_ended(call_log, missed) {\n\t\tfrappe.utils.play_sound('call-disconnect');\n\t\tthis.update_call_log(call_log, missed);\n\t\tsetTimeout(() => {\n\t\t\tif (!this.dialog.get_value('call_summary')) {\n\t\t\t\tthis.close_modal();\n\t\t\t}\n\t\t}, 60000);\n\t\tthis.clear_listeners();\n\t}\n\n\tget_caller_name() {\n\t\tconst contact_link = this.get_contact_link();\n\t\treturn contact_link.link_title || contact_link.link_name;\n\t}\n\n\tget_contact_link() {\n\t\tlet log = this.call_log;\n\t\tlet contact_link = log.links.find(d => d.link_doctype === 'Contact');\n\t\treturn contact_link || {};\n\t}\n\n\tsetup_listener() {\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_ended`, call_log => {\n\t\t\tthis.call_ended(call_log);\n\t\t});\n\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_missed`, call_log => {\n\t\t\tthis.call_ended(call_log, true);\n\t\t});\n\t}\n\n\tclear_listeners() {\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_ended`);\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_missed`);\n\t}\n\n\tsetup_call_details() {\n\t\tthis.caller_info = $(`<div></div>`);\n\t\tthis.call_details = new frappe.ui.FieldGroup({\n\t\t\tfields: [{\n\t\t\t\t'fieldname': 'name',\n\t\t\t\t'label': 'Name',\n\t\t\t\t'default': this.get_caller_name() || __('Unknown Caller'),\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Open Contact'),\n\t\t\t\t'click': () => frappe.set_route('Form', 'Contact', this.get_contact_link().link_name),\n\t\t\t\t'depends_on': () => this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Contact'),\n\t\t\t\t'click': this.create_new_contact.bind(this),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Customer'),\n\t\t\t\t'click': this.create_new_customer.bind(this),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Lead'),\n\t\t\t\t'click': () => frappe.new_doc('Lead', { 'mobile_no': this.caller_number }),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Column Break',\n\t\t\t}, {\n\t\t\t\t'fieldname': 'number',\n\t\t\t\t'label': 'Phone Number',\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'default': this.caller_number,\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'hide_border': 1,\n\t\t\t}, {\n\t\t\t\t'fieldname': 'call_type',\n\t\t\t\t'label': 'Call Type',\n\t\t\t\t'fieldtype': 'Link',\n\t\t\t\t'options': 'Telephony Call Type',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'hide_border': 1,\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Call Summary'),\n\t\t\t\t'fieldname': 'call_summary',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Save'),\n\t\t\t\t'click': () => {\n\t\t\t\t\tconst call_summary = this.call_details.get_value('call_summary');\n\t\t\t\t\tconst call_type = this.call_details.get_value('call_type');\n\t\t\t\t\tif (!call_summary) return;\n\t\t\t\t\tfrappe.xcall('stock.telephony.doctype.call_log.call_log.add_call_summary_and_call_type', {\n\t\t\t\t\t\t'call_log': this.call_log.name,\n\t\t\t\t\t\t'summary': call_summary,\n\t\t\t\t\t\t'call_type': call_type,\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.close_modal();\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: `\n\t\t\t\t\t\t\t\t${__('Call Summary Saved')}\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclass=\"text-small text-muted\"\n\t\t\t\t\t\t\t\t\thref=\"/app/call-log/${this.call_log.name}\">\n\t\t\t\t\t\t\t\t\t${__('View call log')}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}],\n\t\t\tbody: this.caller_info\n\t\t});\n\t\tthis.call_details.make();\n\t}\n\n\tis_known_caller() {\n\t\treturn Boolean(this.get_caller_name());\n\t}\n\n\tcreate_new_customer() {\n\t\t// to avoid quick entry form\n\t\tconst new_customer = frappe.model.get_new_doc('Customer');\n\t\tnew_customer.mobile_no = this.caller_number;\n\t\tfrappe.set_route('Form', new_customer.doctype, new_customer.name);\n\t}\n\n\tcreate_new_contact() {\n\t\t// TODO: fix new_doc, it should accept child table values\n\t\tconst new_contact = frappe.model.get_new_doc('Contact');\n\t\tconst phone_no = frappe.model.add_child(new_contact, 'Contact Phone', 'phone_nos');\n\t\tphone_no.phone = this.caller_number;\n\t\tphone_no.is_primary_mobile_no = 1;\n\t\tfrappe.set_route('Form', new_contact.doctype, new_contact.name);\n\t}\n}\n\n$(document).on('app_ready', function () {\n\tfrappe.realtime.on('show_call_popup', call_log => {\n\t\tlet call_popup = stock.call_popup;\n\t\tif (call_popup && call_log.name === call_popup.call_log.name) {\n\t\t\tcall_popup.update_call_log(call_log);\n\t\t\tcall_popup.dialog.show();\n\t\t} else {\n\t\t\tstock.call_popup = new CallPopup(call_log);\n\t\t}\n\t});\n});\n\nwindow.CallPopup = CallPopup;\n", "stock.utils.BarcodeScanner = class BarcodeScanner {\n\tconstructor(opts) {\n\t\tthis.frm = opts.frm;\n\n\t\t// field from which to capture input of scanned data\n\t\tthis.scan_field_name = opts.scan_field_name || \"scan_barcode\";\n\t\tthis.scan_barcode_field = this.frm.fields_dict[this.scan_field_name];\n\n\t\tthis.barcode_field = opts.barcode_field || \"barcode\";\n\t\tthis.uom_field = opts.uom_field || \"uom\";\n\t\tthis.qty_field = opts.qty_field || \"qty\";\n\t\t// field name on row which defines max quantity to be scanned e.g. picklist\n\t\tthis.max_qty_field = opts.max_qty_field;\n\t\t// scanner won't add a new row if this flag is set.\n\t\tthis.dont_allow_new_row = opts.dont_allow_new_row;\n\t\t// scanner will ask user to type the quantity instead of incrementing by 1\n\t\tthis.prompt_qty = opts.prompt_qty;\n\n\t\tthis.items_table_name = opts.items_table_name || \"items\";\n\t\tthis.items_table = this.frm.doc[this.items_table_name];\n\n\t\t// optional sound name to play when scan either fails or passes.\n\t\t// see https://frappeframework.com/docs/v14/user/en/python-api/hooks#sounds\n\t\tthis.success_sound = opts.play_success_sound;\n\t\tthis.fail_sound = opts.play_fail_sound;\n\n\t\t// any API that takes `search_value` as input and returns dictionary as follows\n\t\t// {\n\t\t//     item_code: \"HORSESHOE\", // present if any item was found\n\t\t//     bar_code: \"123456\", // present if barcode was scanned\n\t\t//     batch_no: \"LOT12\", // present if batch was scanned\n\t\t//     serial_no: \"987XYZ\", // present if serial no was scanned\n\t\t//     uom: \"Kg\", // present if barcode UOM is different from default\n\t\t// }\n\t\tthis.scan_api = opts.scan_api || \"stock.stock.utils.scan_barcode\";\n\t}\n\n\tprocess_scan() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet me = this;\n\n\t\t\tconst input = this.scan_barcode_field.value;\n\t\t\tthis.scan_barcode_field.set_value(\"\");\n\t\t\tif (!input) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.scan_api_call(input, (r) => {\n\t\t\t\tconst data = r && r.message;\n\t\t\t\tif (!data || Object.keys(data).length === 0) {\n\t\t\t\t\tthis.show_alert(__(\"Cannot find Item with this Barcode\"), \"red\");\n\t\t\t\t\tthis.clean_up();\n\t\t\t\t\tthis.play_fail_sound();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.update_table(data).then(row => {\n\t\t\t\t\tthis.play_success_sound();\n\t\t\t\t\tresolve(row);\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.play_fail_sound();\n\t\t\t\t\treject();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tscan_api_call(input, callback) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: this.scan_api,\n\t\t\t\targs: {\n\t\t\t\t\tsearch_value: input,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tcallback(r);\n\t\t\t});\n\t}\n\n\tupdate_table(data) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\t\t\tfrappe.flags.trigger_from_barcode_scanner = true;\n\n\t\t\tconst {item_code, barcode, batch_no, serial_no, uom} = data;\n\n\t\t\tlet row = this.get_row_to_modify_on_scan(item_code, batch_no, uom, barcode);\n\n\t\t\tthis.is_new_row = false;\n\t\t\tif (!row) {\n\t\t\t\tif (this.dont_allow_new_row) {\n\t\t\t\t\tthis.show_alert(__(\"Maximum quantity scanned for item {0}.\", [item_code]), \"red\");\n\t\t\t\t\tthis.clean_up();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.is_new_row = true;\n\n\t\t\t\t// add new row if new item/batch is scanned\n\t\t\t\trow = frappe.model.add_child(this.frm.doc, cur_grid.doctype, this.items_table_name);\n\t\t\t\t// trigger any row add triggers defined on child table.\n\t\t\t\tthis.frm.script_manager.trigger(`${this.items_table_name}_add`, row.doctype, row.name);\n\t\t\t\tthis.frm.has_items = false;\n\t\t\t}\n\n\t\t\tif (serial_no) {\n\t\t\t\tthis.is_duplicate_serial_no(row, item_code, serial_no)\n\t\t\t\t\t.then((is_duplicate) => {\n\t\t\t\t\t\tif (!is_duplicate) {\n\t\t\t\t\t\t\tthis.run_serially_tasks(row, data, resolve);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.clean_up();\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.run_serially_tasks(row, data, resolve);\n\t\t\t}\n\n\n\t\t});\n\t}\n\n\trun_serially_tasks(row, data, resolve) {\n\t\tconst {item_code, barcode, batch_no, serial_no, uom} = data;\n\n\t\tfrappe.run_serially([\n\t\t\t() => this.set_serial_and_batch(row, item_code, serial_no, batch_no),\n\t\t\t() => this.set_barcode(row, barcode),\n\t\t\t() => this.set_item(row, item_code, barcode, batch_no, serial_no).then(qty => {\n\t\t\t\tthis.show_scan_message(row.idx, row.item_code, qty);\n\t\t\t}),\n\t\t\t() => this.set_barcode_uom(row, uom),\n\t\t\t() => this.clean_up(),\n\t\t\t() => {\n\t\t\t\tif (row.serial_and_batch_bundle && !this.frm.is_new()) {\n\t\t\t\t\tthis.frm.save();\n\t\t\t\t}\n\n\t\t\t\tfrappe.flags.trigger_from_barcode_scanner = false;\n\t\t\t},\n\t\t\t() => resolve(row),\n\t\t]);\n\t}\n\n\tset_item(row, item_code, barcode, batch_no, serial_no) {\n\t\treturn new Promise(resolve => {\n\t\t\tconst increment = async (value = 1) => {\n\t\t\t\tconst item_data = {item_code: item_code};\n\t\t\t\titem_data[this.qty_field] = Number((row[this.qty_field] || 0)) + Number(value);\n\t\t\t\tfrappe.flags.trigger_from_barcode_scanner = true;\n\t\t\t\tawait frappe.model.set_value(row.doctype, row.name, item_data);\n\t\t\t\treturn value;\n\t\t\t};\n\n\t\t\tif (this.prompt_qty) {\n\t\t\t\tfrappe.prompt(__(\"Please enter quantity for item {0}\", [item_code]), ({value}) => {\n\t\t\t\t\tincrement(value).then((value) => resolve(value));\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tincrement().then((value) => resolve(value));\n\t\t\t}\n\t\t});\n\t}\n\n\tprepare_item_for_scan(row, item_code, barcode, batch_no, serial_no) {\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Scan barcode for item {0}\", [item_code]),\n\t\t\tfields: me.get_fields_for_dialog(row, item_code, barcode, batch_no, serial_no),\n\t\t})\n\n\t\tthis.dialog.set_primary_action(__(\"Update\"), () => {\n\t\t\tconst item_data = {item_code: item_code};\n\t\t\titem_data[this.qty_field] = this.dialog.get_value(\"scanned_qty\");\n\t\t\titem_data[\"has_item_scanned\"] = 1;\n\n\t\t\tthis.remaining_qty = flt(this.dialog.get_value(\"qty\")) - flt(this.dialog.get_value(\"scanned_qty\"));\n\t\t\tfrappe.model.set_value(row.doctype, row.name, item_data);\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.set_barcode(row, this.dialog.get_value(\"barcode\")),\n\t\t\t\t() => this.set_serial_and_batch(row, item_code, this.dialog.get_value(\"serial_no\"), this.dialog.get_value(\"batch_no\")),\n\t\t\t\t() => this.add_child_for_remaining_qty(row),\n\t\t\t\t() => this.clean_up()\n\t\t\t]);\n\n\t\t\tthis.dialog.hide();\n\t\t});\n\n\t\tthis.dialog.show();\n\n\t\tthis.$scan_btn = this.dialog.$wrapper.find(\".link-btn\");\n\t\tthis.$scan_btn.css(\"display\", \"inline\");\n\t}\n\n\tget_fields_for_dialog(row, item_code, barcode, batch_no, serial_no) {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tfieldname: \"barcode_scanner\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tlabel: __(\"Scan Barcode\"),\n\t\t\t\tonchange: (e) => {\n\t\t\t\t\tif (!e) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.target.value) {\n\t\t\t\t\t\tthis.scan_api_call(e.target.value, (r) => {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tthis.update_dialog_values(item_code, r);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tfieldname: \"qty\",\n\t\t\t\tlabel: __(\"Quantity to Scan\"),\n\t\t\t\tdefault: row[this.qty_field] || 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\tfieldname: \"column_break_1\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tread_only: 1,\n\t\t\t\tfieldname: \"scanned_qty\",\n\t\t\t\tlabel: __(\"Scanned Quantity\"),\n\t\t\t\tdefault: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t}\n\t\t]\n\n\t\tif (batch_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\toptions: \"Batch No\",\n\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\tdefault: batch_no,\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1\n\t\t\t});\n\t\t}\n\n\t\tif (serial_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\tlabel: __(\"Serial Nos\"),\n\t\t\t\tdefault: serial_no,\n\t\t\t\tread_only: 1,\n\t\t\t});\n\t\t}\n\n\t\tif (barcode) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tfieldname: \"barcode\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tlabel: __(\"Barcode\"),\n\t\t\t\tdefault: barcode,\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1\n\t\t\t});\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tupdate_dialog_values(scanned_item, r) {\n\t\tconst {item_code, barcode, batch_no, serial_no} = r.message;\n\n\t\tthis.dialog.set_value(\"barcode_scanner\", \"\");\n\t\tif (item_code === scanned_item &&\n\t\t\t(this.dialog.get_value(\"barcode\") === barcode || batch_no || serial_no)) {\n\n\t\t\tif (batch_no) {\n\t\t\t\tthis.dialog.set_value(\"batch_no\", batch_no);\n\t\t\t}\n\n\t\t\tif (serial_no) {\n\n\t\t\t\tthis.validate_duplicate_serial_no(serial_no);\n\t\t\t\tlet serial_nos = this.dialog.get_value(\"serial_no\") + \"\\n\" + serial_no;\n\t\t\t\tthis.dialog.set_value(\"serial_no\", serial_nos);\n\t\t\t}\n\n\t\t\tlet qty = flt(this.dialog.get_value(\"scanned_qty\")) + 1.0;\n\t\t\tthis.dialog.set_value(\"scanned_qty\", qty);\n\t\t}\n\t}\n\n\tvalidate_duplicate_serial_no(serial_no) {\n\t\tlet serial_nos = this.dialog.get_value(\"serial_no\") ?\n\t\t\tthis.dialog.get_value(\"serial_no\").split(\"\\n\") : [];\n\n\t\tif (in_list(serial_nos, serial_no)) {\n\t\t\tfrappe.throw(__(\"Serial No {0} already scanned\", [serial_no]));\n\t\t}\n\t}\n\n\tadd_child_for_remaining_qty(prev_row) {\n\t\tif (this.remaining_qty && this.remaining_qty >0) {\n\t\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\t\t\tlet row = frappe.model.add_child(this.frm.doc, cur_grid.doctype, this.items_table_name);\n\n\t\t\tlet ignore_fields = [\"name\", \"idx\", \"batch_no\", \"barcode\",\n\t\t\t\t\"received_qty\", \"serial_no\", \"has_item_scanned\"];\n\n\t\t\tfor (let key in prev_row) {\n\t\t\t\tif (in_list(ignore_fields, key)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\trow[key] = prev_row[key];\n\t\t\t}\n\n\t\t\trow[this.qty_field] = this.remaining_qty;\n\t\t\tif (this.qty_field == \"qty\" && frappe.meta.has_field(row.doctype, \"stock_qty\")) {\n\t\t\t\trow[\"stock_qty\"] = this.remaining_qty * row.conversion_factor;\n\t\t\t}\n\n\t\t\tthis.frm.script_manager.trigger(\"item_code\", row.doctype, row.name);\n\t\t}\n\t}\n\n\tasync set_serial_and_batch(row, item_code, serial_no, batch_no) {\n\t\tif (this.frm.is_new() || !row.serial_and_batch_bundle) {\n\t\t\tthis.set_bundle_in_localstorage(row, item_code, serial_no, batch_no);\n\t\t} else if(row.serial_and_batch_bundle) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"stock.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.update_serial_or_batch\",\n\t\t\t\targs: {\n\t\t\t\t\tbundle_id: row.serial_and_batch_bundle,\n\t\t\t\t\tserial_no: serial_no,\n\t\t\t\t\tbatch_no: batch_no,\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t}\n\n\tget_key_for_localstorage() {\n\t\tlet parts = this.frm.doc.name.split(\"-\");\n\t\treturn parts[parts.length - 1] + this.frm.doc.doctype;\n\t}\n\n\tupdate_localstorage_scanned_data() {\n\t\tlet docname = this.frm.doc.name\n\t\tif (localStorage[docname]) {\n\t\t\tlet items = JSON.parse(localStorage[docname]);\n\t\t\tlet existing_items = this.frm.doc.items.map(d => d.item_code);\n\t\t\tif (!existing_items.length) {\n\t\t\t\tlocalStorage.removeItem(docname);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (let item_code in items) {\n\t\t\t\tif (!existing_items.includes(item_code)) {\n\t\t\t\t\tdelete items[item_code];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlocalStorage[docname] = JSON.stringify(items);\n\t\t}\n\t}\n\n\tasync set_bundle_in_localstorage(row, item_code, serial_no, batch_no) {\n\t\tlet docname = this.frm.doc.name\n\n\t\tlet entries = JSON.parse(localStorage.getItem(docname));\n\t\tif (!entries) {\n\t\t\tentries = {};\n\t\t}\n\n\t\tlet key = item_code;\n\t\tif (!entries[key]) {\n\t\t\tentries[key] = [];\n\t\t}\n\n\t\tlet existing_row = [];\n\t\tif (!serial_no && batch_no) {\n\t\t\texisting_row = entries[key].filter((e) => e.batch_no === batch_no);\n\t\t\tif (existing_row.length) {\n\t\t\t\texisting_row[0].qty += 1;\n\t\t\t}\n\t\t} else if (serial_no) {\n\t\t\texisting_row = entries[key].filter((e) => e.serial_no === serial_no);\n\t\t\tif (existing_row.length) {\n\t\t\t\tfrappe.throw(__(\"Serial No {0} has already scanned.\", [serial_no]));\n\t\t\t}\n\t\t}\n\n\t\tif (!existing_row.length) {\n\t\t\tentries[key].push({\n\t\t\t\t\"serial_no\": serial_no,\n\t\t\t\t\"batch_no\": batch_no,\n\t\t\t\t\"qty\": 1\n\t\t\t});\n\t\t}\n\n\t\tlocalStorage.setItem(docname, JSON.stringify(entries));\n\n\t\t// Auto remove from localstorage after 1 hour\n\t\tsetTimeout(() => {\n\t\t\tlocalStorage.removeItem(docname);\n\t\t}, 3600000)\n\t}\n\n\tremove_item_from_localstorage() {\n\t\tlet docname = this.frm.doc.name;\n\t\tif (localStorage[docname]) {\n\t\t\tlocalStorage.removeItem(docname);\n\t\t}\n\t}\n\n\tasync sync_bundle_data() {\n\t\tlet docname = this.frm.doc.name;\n\n\t\tif (localStorage[docname]) {\n\t\t\tlet entries = JSON.parse(localStorage[docname]);\n\t\t\tif (entries) {\n\t\t\t\tfor (let entry in entries) {\n\t\t\t\t\tlet row = this.frm.doc.items.filter((item) => {\n\t\t\t\t\t\tif (item.item_code === entry) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t})[0];\n\n\t\t\t\t\tif (row) {\n\t\t\t\t\t\tthis.create_serial_and_batch_bundle(row, entries, entry)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tif (!entries) {\n\t\t\t\t\t\t\t\t\tlocalStorage.removeItem(docname);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync create_serial_and_batch_bundle(row, entries, key) {\n\t\tfrappe.call({\n\t\t\tmethod: \"stock.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.add_serial_batch_ledgers\",\n\t\t\targs: {\n\t\t\t\tentries: entries[key],\n\t\t\t\tchild_row: row,\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\twarehouse: row.warehouse,\n\t\t\t\tdo_not_save: 1\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\trow.serial_and_batch_bundle = r.message.name;\n\t\t\t\tdelete entries[key];\n\t\t\t}\n\t\t})\n\t}\n\n\tasync set_barcode_uom(row, uom) {\n\t\tif (uom && frappe.meta.has_field(row.doctype, this.uom_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.uom_field, uom);\n\t\t}\n\t}\n\n\tasync set_barcode(row, barcode) {\n\t\tif (barcode && frappe.meta.has_field(row.doctype, this.barcode_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.barcode_field, barcode);\n\t\t}\n\t}\n\n\tshow_scan_message(idx, exist = null, qty = 1) {\n\t\t// show new row or qty increase toast\n\t\tif (exist) {\n\t\t\tthis.show_alert(__(\"Row #{0}: Qty increased by {1}\", [idx, qty]), \"green\");\n\t\t} else {\n\t\t\tthis.show_alert(__(\"Row #{0}: Item added\", [idx]), \"green\")\n\t\t}\n\t}\n\n\tasync is_duplicate_serial_no(row, item_code, serial_no) {\n\t\tlet is_duplicate = false;\n\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\tif (this.frm.is_new() || !row.serial_and_batch_bundle) {\n\t\t\t\tis_duplicate = this.check_duplicate_serial_no_in_localstorage(item_code, serial_no);\n\t\t\t\tif (is_duplicate) {\n\t\t\t\t\tthis.show_alert(__(\"Serial No {0} is already added\", [serial_no]), \"orange\");\n\t\t\t\t}\n\n\t\t\t\tresolve(is_duplicate);\n\t\t\t} else if (row.serial_and_batch_bundle) {\n\t\t\t\tthis.check_duplicate_serial_no_in_db(row, serial_no, (r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.show_alert(__(\"Serial No {0} is already added\", [serial_no]), \"orange\");\n\t\t\t\t\t}\n\n\t\t\t\t\tis_duplicate = r.message;\n\t\t\t\t\tresolve(is_duplicate);\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\n\t\treturn await promise;\n\t}\n\n\tcheck_duplicate_serial_no_in_db(row, serial_no, response) {\n\t\tfrappe.call({\n\t\t\tmethod: \"stock.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.is_duplicate_serial_no\",\n\t\t\targs: {\n\t\t\t\tserial_no: serial_no,\n\t\t\t\tbundle_id: row.serial_and_batch_bundle\n\t\t\t},\n\t\t\tcallback(r) {\n\t\t\t\tresponse(r);\n\t\t\t}\n\t\t});\n\t}\n\n\tcheck_duplicate_serial_no_in_localstorage(item_code, serial_no) {\n\t\tlet docname = this.frm.doc.name\n\t\tlet entries = JSON.parse(localStorage.getItem(docname));\n\n\t\tif (!entries) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet existing_row = [];\n\t\tif (entries[item_code]) {\n\t\t\texisting_row = entries[item_code].filter((e) => e.serial_no === serial_no);\n\t\t}\n\n\t\treturn existing_row.length;\n\t}\n\n\tget_row_to_modify_on_scan(item_code, batch_no, uom, barcode) {\n\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\n\t\t// Check if batch is scanned and table has batch no field\n\t\tlet is_batch_no_scan = batch_no && frappe.meta.has_field(cur_grid.doctype, this.batch_no_field);\n\t\tlet check_max_qty = this.max_qty_field && frappe.meta.has_field(cur_grid.doctype, this.max_qty_field);\n\n\t\tconst matching_row = (row) => {\n\t\t\tconst item_match = row.item_code == item_code;\n\t\t\tconst batch_match = (!row[this.batch_no_field] || row[this.batch_no_field] == batch_no);\n\t\t\tconst uom_match = !uom || row[this.uom_field] == uom;\n\t\t\tconst qty_in_limit = flt(row[this.qty_field]) < flt(row[this.max_qty_field]);\n\t\t\tconst item_scanned = row.has_item_scanned;\n\n\t\t\treturn item_match\n\t\t\t\t&& uom_match\n\t\t\t\t&& !item_scanned\n\t\t\t\t&& (!is_batch_no_scan || batch_match)\n\t\t\t\t&& (!check_max_qty || qty_in_limit)\n\t\t}\n\n\t\treturn this.items_table.find(matching_row) || this.get_existing_blank_row();\n\t}\n\n\tget_existing_blank_row() {\n\t\treturn this.items_table.find((d) => !d.item_code);\n\t}\n\n\tplay_success_sound() {\n\t\tthis.success_sound && frappe.utils.play_sound(this.success_sound);\n\t}\n\n\tplay_fail_sound() {\n\t\tthis.fail_sound && frappe.utils.play_sound(this.fail_sound);\n\t}\n\n\tclean_up() {\n\t\tthis.scan_barcode_field.set_value(\"\");\n\t\trefresh_field(this.items_table_name);\n\t}\n\tshow_alert(msg, indicator, duration=3) {\n\t\tfrappe.show_alert({message: msg, indicator: indicator}, duration);\n\t}\n};\n", "frappe.ui.form.ControlData = class ControlData extends frappe.ui.form.ControlData  {\n\tmake_input() {\n\t\tsuper.make_input();\n\t\tif (this.df.options == 'Phone') {\n\t\t\tthis.setup_phone();\n\t\t}\n\t\tif (this.frm && this.frm.fields_dict) {\n\t\t\tObject.values(this.frm.fields_dict).forEach(function(field) {\n\t\t\t\tif (field.df.read_only === 1 && field.df.options === 'Phone'\n\t\t\t\t\t&& field.disp_area.style[0] != 'display' && !field.has_icon) {\n\t\t\t\t\tfield.setup_phone && field.setup_phone();\n\t\t\t\t\tfield.has_icon = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tsetup_phone() {\n\t\tif (frappe.phone_call.handler) {\n\t\t\tlet control = this.df.read_only ? '.control-value' : '.control-input';\n\t\t\tthis.$wrapper.find(control)\n\t\t\t\t.append(`\n\t\t\t\t\t<span class=\"phone-btn\">\n\t\t\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__('Make a call')}\">\n\t\t\t\t\t\t\t${frappe.utils.icon('call')}\n\t\t\t\t\t</span>\n\t\t\t\t`)\n\t\t\t\t.find('.phone-btn')\n\t\t\t\t.click(() => {\n\t\t\t\t\tfrappe.phone_call.handler(this.get_value(), this.frm);\n\t\t\t\t});\n\t\t}\n\t}\n};\n", "\n\tfrappe.templates['call_link'] = `<div class=\"call-detail-wrapper\">\n\t<div class=\"head flex justify-between\">\n\t\t<div>\n\t\t\t<span class=\"bold\"> {{ type }} Call</span>\n\t\t\t{% if (duration) %}\n\t\t\t<span class=\"text-muted\"> \u2022 {{ frappe.format(duration, { fieldtype: \"Duration\" }) }}</span>\n\t\t\t{% endif %}\n\t\t\t<span class=\"text-muted\"> \u2022 {{ comment_when(creation) }}</span>\n\t\t</div>\n\t\t<span>\n\t\t\t<a class=\"action-btn\" href=\"/app/call-log/{{ name }}\" title=\"{{ __(\"Open Call Log\") }}\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-link-url\" class=\"like-icon\"></use>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t</span>\n\t</div>\n\n\n\t<div class=\"body pt-3\">\n\t\t{% if (type === \"Incoming\") { %}\n\t\t\t<span> Incoming call from {{ from }}, received by {{ to }}</span>\n\t\t{% } else { %}\n\t\t\t<span> Outgoing Call made by {{ from }} to {{ to }}</span>\n\t\t{% } %}\n\t\t<div class=\"summary pt-3\">\n\t\t{% if (summary) { %}\n\t\t\t<i>{{ summary }}</i>\n\t\t{% } else { %}\n\t\t\t<i class=\"text-muted\">{{ __(\"No Summary\") }}</i>\n\t\t{% } %}\n\t\t</div>\n\t\t{% if (recording_url) { %}\n\t\t<div class=\"margin-top\">\n\t\t\t\t<audio\n\t\t\t\t\tcontrols\n\t\t\t\t\tsrc=\"{{ recording_url }}\">\n\t\t\t\t</audio>\n\t\t</div>\n\t\t{% } %}\n\t</div>\n</div>\n`;\n", "frappe.provide(\"stock.bulk_transaction_processing\");\n\n$.extend(stock.bulk_transaction_processing, {\n\tcreate: function(listview, from_doctype, to_doctype) {\n\t\tlet checked_items = listview.get_checked_items();\n\t\tconst doc_name = [];\n\t\tchecked_items.forEach((Item)=> {\n\t\t\tif (Item.docstatus == 0) {\n\t\t\t\tdoc_name.push(Item.name);\n\t\t\t}\n\t\t});\n\n\t\tlet count_of_rows = checked_items.length;\n\t\tfrappe.confirm(__(\"Create {0} {1} ?\", [count_of_rows, __(to_doctype)]), ()=>{\n\t\t\tif (doc_name.length == 0) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"stock.utilities.bulk_transaction.transaction_processing\",\n\t\t\t\t\targs: {data: checked_items, from_doctype: from_doctype, to_doctype: to_doctype}\n\t\t\t\t}).then(()=> {\n\n\t\t\t\t});\n\t\t\t\tif (count_of_rows > 10) {\n\t\t\t\t\tfrappe.show_alert(\"Starting a background job to create {0} {1}\", [count_of_rows, __(to_doctype)]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfrappe.msgprint(__(\"Selected document must be in submitted state\"));\n\t\t\t}\n\t\t});\n\t}\n});\n", "stock.utils.CRMActivities = class CRMActivities {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\trefresh() {\n\t\tvar me = this;\n\t\t$(this.open_activities_wrapper).empty();\n\t\tlet cur_form_footer = this.form_wrapper.find('.form-footer');\n\n\t\t// all activities\n\t\tif (!$(this.all_activities_wrapper).find('.form-footer').length) {\n\t\t\tthis.all_activities_wrapper.empty();\n\t\t\t$(cur_form_footer).appendTo(this.all_activities_wrapper);\n\n\t\t\t// remove frappe-control class to avoid absolute position for action-btn\n\t\t\t$(this.all_activities_wrapper).removeClass('frappe-control');\n\t\t\t// hide new event button\n\t\t\t$('.timeline-actions').find('.btn-default').hide();\n\t\t\t// hide new comment box\n\t\t\t$(\".comment-box\").hide();\n\t\t\t// show only communications by default\n\t\t\t$($('.timeline-content').find('.nav-link')[0]).tab('show');\n\t\t}\n\n\t\t// open activities\n\t\tfrappe.call({\n\t\t\tmethod: \"stock.crm.utils.get_open_activities\",\n\t\t\targs: {\n\t\t\t\tref_doctype: this.frm.doc.doctype,\n\t\t\t\tref_docname: this.frm.doc.name\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tvar activities_html = frappe.render_template('crm_activities', {\n\t\t\t\t\t\ttasks: r.message.tasks,\n\t\t\t\t\t\tevents: r.message.events\n\t\t\t\t\t});\n\n\t\t\t\t\t$(activities_html).appendTo(me.open_activities_wrapper);\n\n\t\t\t\t\t$(\".open-tasks\").find(\".completion-checkbox\").on(\"click\", function() {\n\t\t\t\t\t\tme.update_status(this, \"ToDo\");\n\t\t\t\t\t});\n\n\t\t\t\t\t$(\".open-events\").find(\".completion-checkbox\").on(\"click\", function() {\n\t\t\t\t\t\tme.update_status(this, \"Event\");\n\t\t\t\t\t});\n\n\t\t\t\t\tme.create_task();\n\t\t\t\t\tme.create_event();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tcreate_task () {\n\t\tlet me = this;\n\t\tlet _create_task = () => {\n\t\t\tconst args = {\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\tfrm: me.frm,\n\t\t\t\ttitle: __(\"New Task\")\n\t\t\t};\n\t\t\tlet composer = new frappe.views.InteractionComposer(args);\n\t\t\tcomposer.dialog.get_field('interaction_type').set_value(\"ToDo\");\n\t\t\t// hide column having interaction type field\n\t\t\t$(composer.dialog.get_field('interaction_type').wrapper).closest('.form-column').hide();\n\t\t\t// hide summary field\n\t\t\t$(composer.dialog.get_field('summary').wrapper).closest('.form-section').hide();\n\t\t};\n\t\t$(\".new-task-btn\").click(_create_task);\n\t}\n\n\tcreate_event () {\n\t\tlet me = this;\n\t\tlet _create_event = () => {\n\t\t\tconst args = {\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\tfrm: me.frm,\n\t\t\t\ttitle: __(\"New Event\")\n\t\t\t};\n\t\t\tlet composer = new frappe.views.InteractionComposer(args);\n\t\t\tcomposer.dialog.get_field('interaction_type').set_value(\"Event\");\n\t\t\t$(composer.dialog.get_field('interaction_type').wrapper).hide();\n\t\t};\n\t\t$(\".new-event-btn\").click(_create_event);\n\t}\n\n\tasync update_status (input_field, doctype) {\n\t\tlet completed = $(input_field).prop(\"checked\") ? 1 : 0;\n\t\tlet docname = $(input_field).attr(\"name\");\n\t\tif (completed) {\n\t\t\tawait frappe.db.set_value(doctype, docname, \"status\", \"Closed\");\n\t\t\tthis.refresh();\n\t\t}\n\t}\n};\n\nstock.utils.CRMNotes = class CRMNotes {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\trefresh() {\n\t\tvar me = this;\n\t\tthis.notes_wrapper.find('.notes-section').remove();\n\n\t\tlet notes = this.frm.doc.notes || [];\n\t\tnotes.sort(\n\t\t\tfunction(a, b) {\n\t\t\t\treturn new Date(b.added_on) - new Date(a.added_on);\n\t\t\t}\n\t\t);\n\n\t\tlet notes_html = frappe.render_template(\n\t\t\t'crm_notes',\n\t\t\t{\n\t\t\t\tnotes: notes\n\t\t\t}\n\t\t);\n\t\t$(notes_html).appendTo(this.notes_wrapper);\n\n\t\tthis.add_note();\n\n\t\t$(\".notes-section\").find(\".edit-note-btn\").on(\"click\", function() {\n\t\t\tme.edit_note(this);\n\t\t});\n\n\t\t$(\".notes-section\").find(\".delete-note-btn\").on(\"click\", function() {\n\t\t\tme.delete_note(this);\n\t\t});\n\t}\n\n\n\tadd_note () {\n\t\tlet me = this;\n\t\tlet _add_note = () => {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Add a Note'),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"label\": \"Note\",\n\t\t\t\t\t\t\"fieldname\": \"note\",\n\t\t\t\t\t\t\"fieldtype\": \"Text Editor\",\n\t\t\t\t\t\t\"reqd\": 1,\n\t\t\t\t\t\t\"enable_mentions\": true,\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tprimary_action: function() {\n\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"add_note\",\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tnote: data.note\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __('Add')\n\t\t\t});\n\t\t\td.show();\n\t\t};\n\t\t$(\".new-note-btn\").click(_add_note);\n\t}\n\n\tedit_note (edit_btn) {\n\t\tvar me = this;\n\t\tlet row = $(edit_btn).closest('.comment-content');\n\t\tlet row_id = row.attr(\"name\");\n\t\tlet row_content = $(row).find(\".content\").html();\n\t\tif (row_content) {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Edit Note'),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"label\": \"Note\",\n\t\t\t\t\t\t\"fieldname\": \"note\",\n\t\t\t\t\t\t\"fieldtype\": \"Text Editor\",\n\t\t\t\t\t\t\"default\": row_content\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tprimary_action: function() {\n\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"edit_note\",\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tnote: data.note,\n\t\t\t\t\t\t\trow_id: row_id\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __('Done')\n\t\t\t});\n\t\t\td.show();\n\t\t}\n\t}\n\n\tdelete_note (delete_btn) {\n\t\tvar me = this;\n\t\tlet row_id = $(delete_btn).closest('.comment-content').attr(\"name\");\n\t\tfrappe.call({\n\t\t\tmethod: \"delete_note\",\n\t\t\tdoc: me.frm.doc,\n\t\t\targs: {\n\t\t\t\trow_id: row_id\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n", "\n\tfrappe.templates['crm_activities'] = `<div class=\"open-activities\">\n\t<div class=\"new-btn pb-3\">\n\t\t<span>\n\t\t\t<button class=\"btn btn-sm small new-task-btn mr-1\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-small-message\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Task\") }}\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-sm small new-event-btn\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-calendar\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Event\") }}\n\t\t\t</button>\n\t\t</span>\n\t</div>\n\t<div class=\"section-body\">\n\t\t<div class=\"open-tasks pr-1\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span class=\"ml-2\">{{ __(\"Open Tasks\") }}</span>\n\t\t\t</div>\n\t\t\t{% if (tasks.length) { %}\n\t\t\t\t{% for(var i=0, l=tasks.length; i<l; i++) { %}\n\t\t\t\t\t<div class=\"single-activity\">\n\t\t\t\t\t\t<div class=\"flex justify-between mb-2\">\n\t\t\t\t\t\t\t<div class=\"row label-area font-md ml-1\">\n\t\t\t\t\t\t\t\t<span class=\"mr-2\">\n\t\t\t\t\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t\t\t\t\t<use href=\"#icon-small-message\"></use>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<a href=\"/app/todo/{{ tasks[i].name }}\" title=\"{{ __('Open Task') }}\">\n\t\t\t\t\t\t\t\t\t{%= tasks[i].description %}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"checkbox\">\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"completion-checkbox\"\n\t\t\t\t\t\t\t\t\tname=\"{{tasks[i].name}}\" title=\"{{ __('Mark As Closed') }}\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% if(tasks[i].date) { %}\n\t\t\t\t\t\t\t<div class=\"text-muted ml-1\">\n\t\t\t\t\t\t\t\t{%= frappe.datetime.global_date_format(tasks[i].date) %}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t{% if(tasks[i].allocated_to) { %}\n\t\t\t\t\t\t\t<div class=\"text-muted  ml-1\">\n\t\t\t\t\t\t\t\t{{ __(\"Allocated To:\") }}\n\t\t\t\t\t\t\t\t{%= tasks[i].allocated_to %}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t</div>\n\t\t\t    {% } %}\n            {% } else { %}\n                <div class=\"single-activity no-activity text-muted\">\n                    {{ __(\"No open task\") }}\n                </div>\n\t\t    {% } %}\n\t\t</div>\n\t\t<div class=\"open-events pl-1\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span class=\"ml-2\">{{ __(\"Open Events\") }}</span>\n\t\t\t</div>\n\t\t\t{% if (events.length) { %}\n                {% let icon_set = {\"Sent/Received Email\": \"mail\", \"Call\": \"call\", \"Meeting\": \"share-people\"}; %}\n                {% for(var i=0, l=events.length; i<l; i++) { %}\n                    <div class=\"single-activity\">\n                        <div class=\"flex justify-between mb-2\">\n                            <div class=\"row label-area font-md ml-1 title\">\n                                <span class=\"mr-2\">\n                                    <svg class=\"icon icon-sm\">\n                                        <use href=\"#icon-{{ icon_set[events[i].event_category] || 'calendar' }}\"></use>\n                                    </svg>\n                                </span>\n                                <a href=\"/app/event/{{ events[i].name }}\" title=\"{{ __('Open Event') }}\">\n                                    {%= events[i].subject %}\n                                </a>\n                            </div>\n                            <div class=\"checkbox\">\n                                <input type=\"checkbox\" class=\"completion-checkbox\"\n                                    name=\"{{ events[i].name }}\" title=\"{{ __('Mark As Closed') }}\">\n                            </div>\n                        </div>\n                        <div class=\"text-muted ml-1\">\n                            {%= frappe.datetime.global_date_format(events[i].starts_on) %}\n\n                            {% if (events[i].ends_on) { %}\n                                {% if (frappe.datetime.obj_to_user(events[i].starts_on) != frappe.datetime.obj_to_user(events[i].ends_on)) %}\n                                    -\n                                    {%= frappe.datetime.global_date_format(frappe.datetime.obj_to_user(events[i].ends_on)) %}\n                                    {%= frappe.datetime.get_time(events[i].ends_on) %}\n                                {% } else if (events[i].ends_on) { %}\n                                    -\n                                    {%= frappe.datetime.get_time(events[i].ends_on) %}\n                                {% } %}\n                            {% } %}\n\n                        </div>\n                    </div>\n                {% } %}\n            {% } else { %}\n            <div class=\"single-activity no-activity text-muted\">\n                {{ __(\"No open event\") }}\n            </div>\n\t\t    {% } %}\n\t\t</div>\n\t</div>\n</div>\n\n\n<style>\n.open-activities {\n\tmin-height: 50px;\n\tpadding-left: 0px;\n\tpadding-bottom: 15px !important;\n}\n\n.open-activities .new-btn {\n\ttext-align: right;\n}\n\n.single-activity {\n\tmin-height: 90px;\n\tborder: 1px solid var(--border-color);\n\tpadding: 10px;\n\tborder-bottom: 0;\n\tpadding-right: 0;\n}\n\n.single-activity:last-child {\n\tborder-bottom: 1px solid var(--border-color);\n}\n\n.single-activity:hover .completion-checkbox{\n\tdisplay: block;\n}\n\n.completion-checkbox {\n\tvertical-align: middle;\n\tdisplay: none;\n}\n\n.checkbox {\n\tmin-width: 22px;\n}\n\n.open-tasks {\n\twidth: 50%;\n}\n\n.open-tasks:first-child {\n\tborder-right: 0;\n}\n\n.open-events {\n\twidth: 50%;\n}\n\n.open-section-head {\n\tbackground-color: var(--bg-color);\n\tmin-height: 30px;\n\tborder-bottom: 1px solid var(--border-color);\n\tpadding: 10px;\n\tfont-weight: bold;\n}\n\n.no-activity {\n    text-align: center;\n    padding-top: 30px;\n}\n\n.form-footer {\n\tbackground-color: var(--bg-color);\n}\n</style>`;\n", "\n\tfrappe.templates['crm_notes'] = `<div class=\"notes-section col-xs-12\">\n\t<div class=\"new-btn pb-3\">\n\t\t<button class=\"btn btn-sm small new-note-btn mr-1\">\n\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t<use href=\"#icon-add\"></use>\n\t\t\t</svg>\n\t\t\t{{ __(\"New Note\") }}\n\t\t</button>\n\t</div>\n\t<div class=\"all-notes\">\n\t\t{% if (notes.length) { %}\n\t\t\t{% for(var i=0, l=notes.length; i<l; i++) { %}\n\t\t\t\t<div class=\"comment-content p-3 row\" name=\"{{ notes[i].name }}\">\n\t\t\t\t\t<div class=\"mb-2 head col-xs-3\">\n\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t<div class=\"col-xs-2\">\n\t\t\t\t\t\t\t\t{{ frappe.avatar(notes[i].added_by) }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"col-xs-10\">\n\t\t\t\t\t\t\t\t<div class=\"mr-2 title font-weight-bold ellipsis\" title=\"{{ strip_html(notes[i].added_by) }}\">\n\t\t\t\t\t\t\t\t\t{{ strip_html(notes[i].added_by) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"time small text-muted\">\n\t\t\t\t\t\t\t\t\t{{ frappe.datetime.global_date_format(notes[i].added_on) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"content col-xs-8\">\n\t\t\t\t\t\t{{ notes[i].note }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"col-xs-1 text-right\">\n\t\t\t\t\t\t<span class=\"edit-note-btn btn btn-link\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-sm\"><use xlink:href=\"#icon-edit\"></use></svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"delete-note-btn  btn btn-link pl-2\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-xs\"><use xlink:href=\"#icon-delete\"></use></svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{% } %}\n\t\t{% } else { %}\n            <div class=\"no-activity text-muted pt-6\">\n                {{ __(\"No Notes\") }}\n            </div>\n\t\t    {% } %}\n\t</div>\n</div>\n\n<style>\n\n.comment-content {\n    border: 1px solid var(--border-color);\n\tborder-bottom: none;\n}\n\n.comment-content:last-child {\n    border-bottom: 1px solid var(--border-color);\n}\n\n.new-btn {\n\ttext-align: right;\n}\n\n.notes-section .no-activity {\n\tmin-height: 100px;\n\ttext-align: center;\n}\n\n.notes-section .btn {\n\tpadding: 0.2rem 0.2rem;\n}\n\n</style>`;\n", "\nstock.landed_cost_taxes_and_charges = {\n\tsetup_triggers: function(doctype) {\n\t\tfrappe.ui.form.on(doctype, {\n\t\t\trefresh: function(frm) {\n\t\t\t\tlet tax_field = frm.doc.doctype == 'Landed Cost Voucher' ? 'taxes' : 'additional_costs';\n\t\t\t\tfrm.set_query(\"expense_account\", tax_field, function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\"account_type\": ['in', [\"Tax\", \"Chargeable\", \"Income Account\", \"Expenses Included In Valuation\", \"Expenses Included In Asset Valuation\"]],\n\t\t\t\t\t\t\t\"company\": frm.doc.company\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tset_account_currency: function(frm, cdt, cdn) {\n\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\tif (row.expense_account) {\n\t\t\t\t\tfrappe.db.get_value('Account', row.expense_account, 'account_currency', function(value) {\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"account_currency\", value.account_currency);\n\t\t\t\t\t\tfrm.events.set_exchange_rate(frm, cdt, cdn);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// set_exchange_rate: function(frm, cdt, cdn) {\n\t\t\t// \tlet row = locals[cdt][cdn];\n\t\t\t// \tlet company_currency = frappe.get_doc(\":Company\", frm.doc.company).default_currency;\n\n\t\t\t// \tif (row.account_currency == company_currency) {\n\t\t\t// \t\trow.exchange_rate = 1;\n\t\t\t// \t\tfrm.set_df_property('taxes', 'hidden', 1, row.name, 'exchange_rate');\n\t\t\t// \t} else if (!row.exchange_rate || row.exchange_rate == 1) {\n\t\t\t// \t\tfrm.set_df_property('taxes', 'hidden', 0, row.name, 'exchange_rate');\n\t\t\t// \t\tfrappe.call({\n\t\t\t// \t\t\tmethod: \"stock.accounts.doctype.journal_entry.journal_entry.get_exchange_rate\",\n\t\t\t// \t\t\targs: {\n\t\t\t// \t\t\t\tposting_date: frm.doc.posting_date,\n\t\t\t// \t\t\t\taccount: row.expense_account,\n\t\t\t// \t\t\t\taccount_currency: row.account_currency,\n\t\t\t// \t\t\t\tcompany: frm.doc.company\n\t\t\t// \t\t\t},\n\t\t\t// \t\t\tcallback: function(r) {\n\t\t\t// \t\t\t\tif (r.message) {\n\t\t\t// \t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"exchange_rate\", r.message);\n\t\t\t// \t\t\t\t}\n\t\t\t// \t\t\t}\n\t\t\t// \t\t});\n\t\t\t// \t}\n\n\t\t\t// \tfrm.refresh_field('taxes');\n\t\t\t// },\n\n\t\t\tset_base_amount: function(frm, cdt, cdn) {\n\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"base_amount\",\n\t\t\t\t\tflt(flt(row.amount)*row.exchange_rate, precision(\"base_amount\", row)));\n\t\t\t}\n\t\t});\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"stock.selling\");\n\nstock.sales_common = {\n\tsetup_selling_controller:function() {\n\t\tstock.selling.SellingController = class SellingController extends stock.TransactionController {\n\t\t\tsetup() {\n\t\t\t\tsuper.setup();\n\t\t\t\tthis.toggle_enable_for_stock_uom(\"allow_to_edit_stock_uom_qty_for_sales\");\n\t\t\t\tthis.frm.email_field = \"contact_email\";\n\t\t\t}\n\n\t\t\tonload() {\n\t\t\t\tsuper.onload();\n\t\t\t\tthis.setup_queries();\n\t\t\t\tthis.frm.set_query('shipping_rule', function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\"shipping_rule_type\": \"Selling\"\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tthis.frm.set_query('project', function(doc) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: \"stock.controllers.queries.get_project_name\",\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t'customer': doc.customer\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsetup_queries() {\n\t\t\t\tvar me = this;\n\n\t\t\t\t$.each([[\"customer\", \"customer\"],\n\t\t\t\t\t[\"lead\", \"lead\"]],\n\t\t\t\t\tfunction(i, opts) {\n\t\t\t\t\t\tif(me.frm.fields_dict[opts[0]])\n\t\t\t\t\t\t\tme.frm.set_query(opts[0], stock.queries[opts[1]]);\n\t\t\t\t\t});\n\n\t\t\t\tme.frm.set_query('contact_person', stock.queries.contact_query);\n\t\t\t\tme.frm.set_query('customer_address', stock.queries.address_query);\n\t\t\t\tme.frm.set_query('shipping_address_name', stock.queries.address_query);\n\t\t\t\tme.frm.set_query('dispatch_address_name', stock.queries.dispatch_address_query);\n\n\n\t\t\t\tif(this.frm.fields_dict.selling_price_list) {\n\t\t\t\t\tthis.frm.set_query(\"selling_price_list\", function() {\n\t\t\t\t\t\treturn { filters: { selling: 1 } };\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif(this.frm.fields_dict.tc_name) {\n\t\t\t\t\tthis.frm.set_query(\"tc_name\", function() {\n\t\t\t\t\t\treturn { filters: { selling: 1 } };\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif(!this.frm.fields_dict[\"items\"]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('item_code')) {\n\t\t\t\t\tthis.frm.set_query(\"item_code\", \"items\", function() {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"stock.controllers.queries.item_query\",\n\t\t\t\t\t\t\tfilters: {'is_sales_item': 1, 'customer': me.frm.doc.customer, 'has_variants': 0}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif(this.frm.fields_dict[\"packed_items\"] &&\n\t\t\t\t\tthis.frm.fields_dict[\"packed_items\"].grid.get_field('batch_no')) {\n\t\t\t\t\tthis.frm.set_query(\"batch_no\", \"packed_items\", function(doc, cdt, cdn) {\n\t\t\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn)\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('item_code')) {\n\t\t\t\t\tthis.frm.set_query(\"item_tax_template\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\t\t\treturn me.set_query_for_item_tax_template(doc, cdt, cdn)\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\trefresh() {\n\t\t\t\tsuper.refresh();\n\n\t\t\t\tfrappe.dynamic_link = {doc: this.frm.doc, fieldname: 'customer', doctype: 'Customer'}\n\n\t\t\t\tthis.frm.toggle_display(\"customer_name\",\n\t\t\t\t\t(this.frm.doc.customer_name && this.frm.doc.customer_name!==this.frm.doc.customer));\n\n\t\t\t\tthis.toggle_editable_price_list_rate();\n\t\t\t}\n\n\t\t\tcustomer() {\n\t\t\t\tvar me = this;\n\t\t\t\tstock.utils.get_party_details(this.frm, null, null, function() {\n\t\t\t\t\tme.apply_price_list();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcustomer_address() {\n\t\t\t\tstock.utils.get_address_display(this.frm, \"customer_address\");\n\t\t\t\tstock.utils.set_taxes_from_address(this.frm, \"customer_address\", \"customer_address\", \"shipping_address_name\");\n\t\t\t}\n\n\t\t\tshipping_address_name() {\n\t\t\t\tstock.utils.get_address_display(this.frm, \"shipping_address_name\", \"shipping_address\");\n\t\t\t\tstock.utils.set_taxes_from_address(this.frm, \"shipping_address_name\", \"customer_address\", \"shipping_address_name\");\n\t\t\t}\n\n\t\t\tdispatch_address_name() {\n\t\t\t\tstock.utils.get_address_display(this.frm, \"dispatch_address_name\", \"dispatch_address\");\n\t\t\t}\n\n\t\t\tsales_partner() {\n\t\t\t\tthis.apply_pricing_rule();\n\t\t\t}\n\n\t\t\tcampaign() {\n\t\t\t\tthis.apply_pricing_rule();\n\t\t\t}\n\n\t\t\tselling_price_list() {\n\t\t\t\tthis.apply_price_list();\n\t\t\t\tthis.set_dynamic_labels();\n\t\t\t}\n\n\t\t\tdiscount_percentage(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\titem.discount_amount = 0.0;\n\t\t\t\tthis.apply_discount_on_item(doc, cdt, cdn, 'discount_percentage');\n\t\t\t}\n\n\t\t\tdiscount_amount(doc, cdt, cdn) {\n\n\t\t\t\tif(doc.name === cdn) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\tthis.apply_discount_on_item(doc, cdt, cdn, 'discount_amount');\n\t\t\t}\n\n\t\t\tcommission_rate() {\n\t\t\t\tthis.calculate_commission();\n\t\t\t}\n\n\t\t\ttotal_commission() {\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"amount_eligible_for_commission\", \"total_commission\"]);\n\n\t\t\t\tconst { amount_eligible_for_commission } = this.frm.doc;\n\t\t\t\tif(!amount_eligible_for_commission) return;\n\n\t\t\t\tthis.frm.set_value(\n\t\t\t\t\t\"commission_rate\", flt(\n\t\t\t\t\t\tthis.frm.doc.total_commission * 100.0 / amount_eligible_for_commission\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tallocated_percentage(doc, cdt, cdn) {\n\t\t\t\tvar sales_person = frappe.get_doc(cdt, cdn);\n\t\t\t\tif(sales_person.allocated_percentage) {\n\n\t\t\t\t\tsales_person.allocated_percentage = flt(sales_person.allocated_percentage,\n\t\t\t\t\t\tprecision(\"allocated_percentage\", sales_person));\n\n\t\t\t\t\tsales_person.allocated_amount = flt(this.frm.doc.amount_eligible_for_commission *\n\t\t\t\t\t\tsales_person.allocated_percentage / 100.0,\n\t\t\t\t\t\tprecision(\"allocated_amount\", sales_person));\n\t\t\t\t\t\trefresh_field([\"allocated_amount\"], sales_person);\n\n\t\t\t\t\tthis.calculate_incentive(sales_person);\n\t\t\t\t\trefresh_field([\"allocated_percentage\", \"allocated_amount\", \"commission_rate\",\"incentives\"], sales_person.name,\n\t\t\t\t\t\tsales_person.parentfield);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsales_person(doc, cdt, cdn) {\n\t\t\t\tvar row = frappe.get_doc(cdt, cdn);\n\t\t\t\tthis.calculate_incentive(row);\n\t\t\t\trefresh_field(\"incentives\",row.name,row.parentfield);\n\t\t\t}\n\n\t\t\twarehouse(doc, cdt, cdn) {\n\t\t\t\tif (doc.docstatus === 0 && doc.is_return && !doc.return_against) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"incoming_rate\", 0.0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttoggle_editable_price_list_rate() {\n\t\t\t\tvar df = frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"price_list_rate\", this.frm.doc.name);\n\t\t\t\tvar editable_price_list_rate = cint(frappe.defaults.get_default(\"editable_price_list_rate\"));\n\n\t\t\t\tif(df && editable_price_list_rate) {\n\t\t\t\t\tconst parent_field = frappe.meta.get_parentfield(this.frm.doc.doctype, this.frm.doc.doctype + \" Item\");\n\t\t\t\t\tif (!this.frm.fields_dict[parent_field]) return;\n\n\t\t\t\t\tthis.frm.fields_dict[parent_field].grid.update_docfield_property(\n\t\t\t\t\t\t'price_list_rate', 'read_only', 0\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalculate_commission() {\n\t\t\t\tif(!this.frm.fields_dict.commission_rate || this.frm.doc.docstatus === 1) return;\n\n\t\t\t\tif(this.frm.doc.commission_rate > 100) {\n\t\t\t\t\tthis.frm.set_value(\"commission_rate\", 100);\n\t\t\t\t\tfrappe.throw(`${__(frappe.meta.get_label(\n\t\t\t\t\t\tthis.frm.doc.doctype, \"commission_rate\", this.frm.doc.name\n\t\t\t\t\t))} ${__(\"cannot be greater than 100\")}`);\n\t\t\t\t}\n\n\t\t\t\tthis.frm.doc.amount_eligible_for_commission = this.frm.doc.items.reduce(\n\t\t\t\t\t(sum, item) => item.grant_commission ? sum + item.base_net_amount : sum, 0\n\t\t\t\t)\n\n\t\t\t\tthis.frm.doc.total_commission = flt(\n\t\t\t\t\tthis.frm.doc.amount_eligible_for_commission * this.frm.doc.commission_rate / 100.0,\n\t\t\t\t\tprecision(\"total_commission\")\n\t\t\t\t);\n\n\t\t\t\trefresh_field([\"amount_eligible_for_commission\", \"total_commission\"]);\n\t\t\t}\n\n\t\t\tcalculate_contribution() {\n\t\t\t\tvar me = this;\n\t\t\t\t$.each(this.frm.doc.doctype.sales_team || [], function(i, sales_person) {\n\t\t\t\t\tfrappe.model.round_floats_in(sales_person);\n\t\t\t\t\tif (!sales_person.allocated_percentage) return;\n\n\t\t\t\t\tsales_person.allocated_amount = flt(\n\t\t\t\t\t\tme.frm.doc.amount_eligible_for_commission\n\t\t\t\t\t\t* sales_person.allocated_percentage\n\t\t\t\t\t\t/ 100.0,\n\t\t\t\t\t\tprecision(\"allocated_amount\", sales_person)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcalculate_incentive(row) {\n\t\t\t\tif(row.allocated_amount)\n\t\t\t\t{\n\t\t\t\t\trow.incentives = flt(\n\t\t\t\t\t\t\trow.allocated_amount * row.commission_rate / 100.0,\n\t\t\t\t\t\t\tprecision(\"incentives\", row));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tset_dynamic_labels() {\n\t\t\t\tsuper.set_dynamic_labels();\n\t\t\t\tthis.set_product_bundle_help(this.frm.doc);\n\t\t\t}\n\n\t\t\tset_product_bundle_help(doc) {\n\t\t\t\tif(!this.frm.fields_dict.packing_list) return;\n\t\t\t\tif ((doc.packed_items || []).length) {\n\t\t\t\t\t$(this.frm.fields_dict.packing_list.row.wrapper).toggle(true);\n\n\t\t\t\t\tif (in_list(['Delivery Note', 'Sales Invoice'], doc.doctype)) {\n\t\t\t\t\t\tvar help_msg = \"<div class='alert alert-warning'>\" +\n\t\t\t\t\t\t\t__(\"For 'Product Bundle' items, Warehouse, Serial No and Batch No will be considered from the 'Packing List' table. If Warehouse and Batch No are same for all packing items for any 'Product Bundle' item, those values can be entered in the main Item table, values will be copied to 'Packing List' table.\")+\n\t\t\t\t\t\t\"</div>\";\n\t\t\t\t\t\tfrappe.meta.get_docfield(doc.doctype, 'product_bundle_help', doc.name).options = help_msg;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$(this.frm.fields_dict.packing_list.row.wrapper).toggle(false);\n\t\t\t\t\tif (in_list(['Delivery Note', 'Sales Invoice'], doc.doctype)) {\n\t\t\t\t\t\tfrappe.meta.get_docfield(doc.doctype, 'product_bundle_help', doc.name).options = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trefresh_field('product_bundle_help');\n\t\t\t}\n\n\t\t\tcompany_address() {\n\t\t\t\tvar me = this;\n\t\t\t\tif(this.frm.doc.company_address) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\t\t\t\targs: {\"address_dict\": this.frm.doc.company_address },\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(\"company_address_display\", r.message)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tthis.frm.set_value(\"company_address_display\", \"\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconversion_factor(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\t\t\tsuper.conversion_factor(doc, cdt, cdn, dont_fetch_price_list_rate);\n\t\t\t}\n\n\t\t\tqty(doc, cdt, cdn) {\n\t\t\t\tsuper.qty(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tpick_serial_and_batch(doc, cdt, cdn) {\n\t\t\t\tlet item = locals[cdt][cdn];\n\t\t\t\tlet me = this;\n\t\t\t\tlet path = \"assets/stock/js/utils/serial_no_batch_selector.js\";\n\n\t\t\t\tfrappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\tif (r.message && (r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\titem.has_serial_no = r.message.has_serial_no;\n\t\t\t\t\t\t\titem.has_batch_no = r.message.has_batch_no;\n\t\t\t\t\t\t\titem.type_of_transaction = item.qty > 0 ? \"Outward\":\"Inward\";\n\n\t\t\t\t\t\t\titem.title = item.has_serial_no ?\n\t\t\t\t\t\t\t\t__(\"Select Serial No\") : __(\"Select Batch No\");\n\n\t\t\t\t\t\t\tif (item.has_serial_no && item.has_batch_no) {\n\t\t\t\t\t\t\t\titem.title = __(\"Select Serial and Batch\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfrappe.require(path, function() {\n\t\t\t\t\t\t\t\tnew stock.SerialBatchPackageSelector(\n\t\t\t\t\t\t\t\t\tme.frm, item, (r) => {\n\t\t\t\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\t\t\t\tlet qty = Math.abs(r.total_qty);\n\t\t\t\t\t\t\t\t\t\t\tif (doc.is_return) {\n\t\t\t\t\t\t\t\t\t\t\t\tqty = qty * -1;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, {\n\t\t\t\t\t\t\t\t\t\t\t\t\"serial_and_batch_bundle\": r.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\"qty\": qty\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tupdate_auto_repeat_reference(doc) {\n\t\t\t\tif (doc.auto_repeat) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"frappe.automation.doctype.auto_repeat.auto_repeat.update_reference\",\n\t\t\t\t\t\targs:{\n\t\t\t\t\t\t\tdocname: doc.auto_repeat,\n\t\t\t\t\t\t\treference:doc.name\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r){\n\t\t\t\t\t\t\tif (r.message==\"success\") {\n\t\t\t\t\t\t\t\tfrappe.show_alert({message:__(\"Auto repeat document updated\"), indicator:'green'});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.show_alert({message:__(\"An error occurred during the update process\"), indicator:'red'});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tproject() {\n\t\t\t\tlet me = this;\n\t\t\t\tif(in_list([\"Delivery Note\", \"Sales Invoice\", \"Sales Order\"], this.frm.doc.doctype)) {\n\t\t\t\t\tif(this.frm.doc.project) {\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod:'stock.projects.doctype.project.project.get_cost_center_name' ,\n\t\t\t\t\t\t\targs: {project: this.frm.doc.project},\n\t\t\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\t\t\t$.each(me.frm.doc[\"items\"] || [], function(i, row) {\n\t\t\t\t\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"cost_center\", r.message);\n\t\t\t\t\t\t\t\t\t\t\tfrappe.msgprint(__(\"Cost Center For Item with Item Code {0} has been Changed to {1}\", [row.item_name, r.message]));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcoupon_code() {\n\t\t\t\tthis.frm.set_value(\"discount_amount\", 0);\n\t\t\t\tthis.frm.set_value(\"additional_discount_percentage\", 0);\n\t\t\t}\n\t\t};\n\t}\n}\n\nstock.pre_sales = {\n\tset_as_lost: function(doctype) {\n\t\tfrappe.ui.form.on(doctype, {\n\t\t\tset_as_lost_dialog: function(frm) {\n\t\t\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __(\"Set as Lost\"),\n\t\t\t\t\tfields: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"fieldtype\": \"Table MultiSelect\",\n\t\t\t\t\t\t\t\"label\": __(\"Lost Reasons\"),\n\t\t\t\t\t\t\t\"fieldname\": \"lost_reason\",\n\t\t\t\t\t\t\t\"options\": frm.doctype === 'Opportunity' ? 'Opportunity Lost Reason Detail': 'Quotation Lost Reason Detail',\n\t\t\t\t\t\t\t\"reqd\": 1\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"fieldtype\": \"Table MultiSelect\",\n\t\t\t\t\t\t\t\"label\": __(\"Competitors\"),\n\t\t\t\t\t\t\t\"fieldname\": \"competitors\",\n\t\t\t\t\t\t\t\"options\": \"Competitor Detail\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"fieldtype\": \"Small Text\",\n\t\t\t\t\t\t\t\"label\": __(\"Detailed Reason\"),\n\t\t\t\t\t\t\t\"fieldname\": \"detailed_reason\"\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tprimary_action: function() {\n\t\t\t\t\t\tlet values = dialog.get_values();\n\n\t\t\t\t\t\tfrm.call({\n\t\t\t\t\t\t\tdoc: frm.doc,\n\t\t\t\t\t\t\tmethod: 'declare_enquiry_lost',\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t'lost_reasons_list': values.lost_reason,\n\t\t\t\t\t\t\t\t'competitors': values.competitors ? values.competitors : [],\n\t\t\t\t\t\t\t\t'detailed_reason': values.detailed_reason\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tprimary_action_label: __('Declare Lost')\n\t\t\t\t});\n\n\t\t\t\tdialog.show();\n\t\t\t}\n\t\t});\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"stock.buying\");\n// cur_frm.add_fetch('project', 'cost_center', 'cost_center');\n\nstock.buying = {\n\tsetup_buying_controller: function() {\n\t\tstock.buying.BuyingController = class BuyingController extends stock.TransactionController {\n\t\t\tsetup() {\n\t\t\t\tsuper.setup();\n\t\t\t\tthis.toggle_enable_for_stock_uom(\"allow_to_edit_stock_uom_qty_for_purchase\");\n\t\t\t\tthis.frm.email_field = \"contact_email\";\n\t\t\t}\n\n\t\t\tonload(doc, cdt, cdn) {\n\t\t\t\tthis.setup_queries(doc, cdt, cdn);\n\t\t\t\tsuper.onload();\n\n\t\t\t\tthis.frm.set_query('shipping_rule', function() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\"shipping_rule_type\": \"Buying\"\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tif (this.frm.doc.__islocal\n\t\t\t\t\t&& frappe.meta.has_field(this.frm.doc.doctype, \"disable_rounded_total\")) {\n\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\");\n\t\t\t\t\t\tvar disable = cint(df.default) || cint(frappe.sys_defaults.disable_rounded_total);\n\t\t\t\t\t\tthis.frm.set_value(\"disable_rounded_total\", disable);\n\t\t\t\t}\n\n\n\t\t\t\t// no idea where me is coming from\n\t\t\t\tif(this.frm.get_field('shipping_address')) {\n\t\t\t\t\tthis.frm.set_query(\"shipping_address\", () => {\n\t\t\t\t\t\tif(this.frm.doc.customer) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\t\t\t\t\tfilters: { link_doctype: 'Customer', link_name: this.frm.doc.customer }\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\treturn stock.queries.company_address_query(this.frm.doc)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetup_queries(doc, cdt, cdn) {\n\t\t\t\tvar me = this;\n\n\t\t\t\tif(this.frm.fields_dict.buying_price_list) {\n\t\t\t\t\tthis.frm.set_query(\"buying_price_list\", function() {\n\t\t\t\t\t\treturn{\n\t\t\t\t\t\t\tfilters: { 'buying': 1 }\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif(this.frm.fields_dict.tc_name) {\n\t\t\t\t\tthis.frm.set_query(\"tc_name\", function() {\n\t\t\t\t\t\treturn{\n\t\t\t\t\t\t\tfilters: { 'buying': 1 }\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tme.frm.set_query('supplier', stock.queries.supplier);\n\t\t\t\tme.frm.set_query('contact_person', stock.queries.contact_query);\n\t\t\t\tme.frm.set_query('supplier_address', stock.queries.address_query);\n\n\t\t\t\tme.frm.set_query('billing_address', stock.queries.company_address_query);\n\n\t\t\t\tif(this.frm.fields_dict.supplier) {\n\t\t\t\t\tthis.frm.set_query(\"supplier\", function() {\n\t\t\t\t\t\treturn{\tquery: \"stock.controllers.queries.supplier_query\" }});\n\t\t\t\t}\n\n\t\t\t\tthis.frm.set_query(\"item_code\", \"items\", function() {\n\t\t\t\t\tif (me.frm.doc.is_subcontracted) {\n\t\t\t\t\t\tvar filters = {'supplier': me.frm.doc.supplier};\n\t\t\t\t\t\tif (me.frm.doc.is_old_subcontracting_flow) {\n\t\t\t\t\t\t\tfilters[\"is_sub_contracted_item\"] = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfilters[\"is_stock_item\"] = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn{\n\t\t\t\t\t\t\tquery: \"stock.controllers.queries.item_query\",\n\t\t\t\t\t\t\tfilters: filters\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn{\n\t\t\t\t\t\t\tquery: \"stock.controllers.queries.item_query\",\n\t\t\t\t\t\t\tfilters: { 'supplier': me.frm.doc.supplier, 'is_purchase_item': 1, 'has_variants': 0}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\n\t\t\t\tthis.frm.set_query(\"manufacturer\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\t\tconst row = locals[cdt][cdn];\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: \"stock.controllers.queries.item_manufacturer_query\",\n\t\t\t\t\t\tfilters:{ 'item_code': row.item_code }\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('item_code')) {\n\t\t\t\t\tthis.frm.set_query(\"item_tax_template\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\t\t\treturn me.set_query_for_item_tax_template(doc, cdt, cdn)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trefresh(doc) {\n\t\t\t\tfrappe.dynamic_link = {doc: this.frm.doc, fieldname: 'supplier', doctype: 'Supplier'};\n\n\t\t\t\tthis.frm.toggle_display(\"supplier_name\",\n\t\t\t\t\t(this.frm.doc.supplier_name && this.frm.doc.supplier_name!==this.frm.doc.supplier));\n\n\t\t\t\tif(this.frm.doc.docstatus==0 &&\n\t\t\t\t\t(this.frm.doctype===\"Purchase Order\" || this.frm.doctype===\"Material Request\")) {\n\t\t\t\t\tthis.set_from_product_bundle();\n\t\t\t\t}\n\n\t\t\t\tthis.toggle_subcontracting_fields();\n\t\t\t\tsuper.refresh();\n\t\t\t}\n\n\t\t\ttoggle_subcontracting_fields() {\n\t\t\t\tif (in_list(['Purchase Receipt', 'Purchase Invoice'], this.frm.doc.doctype)) {\n\t\t\t\t\tthis.frm.fields_dict.supplied_items.grid.update_docfield_property('consumed_qty',\n\t\t\t\t\t\t'read_only', this.frm.doc.__onload && this.frm.doc.__onload.backflush_based_on === 'BOM');\n\n\t\t\t\t\tthis.frm.set_df_property('supplied_items', 'cannot_add_rows', 1);\n\t\t\t\t\tthis.frm.set_df_property('supplied_items', 'cannot_delete_rows', 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsupplier() {\n\t\t\t\tvar me = this;\n\t\t\t\tstock.utils.get_party_details(this.frm, null, null, function(){\n\t\t\t\t\tme.apply_price_list();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsupplier_address() {\n\t\t\t\tstock.utils.get_address_display(this.frm);\n\t\t\t\tstock.utils.set_taxes_from_address(this.frm, \"supplier_address\", \"supplier_address\", \"supplier_address\");\n\t\t\t}\n\n\t\t\tbuying_price_list() {\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t\tdiscount_percentage(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\titem.discount_amount = 0.0;\n\t\t\t\tthis.price_list_rate(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tdiscount_amount(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\tthis.price_list_rate(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tqty(doc, cdt, cdn) {\n\t\t\t\tif ((doc.doctype == \"Purchase Receipt\") || (doc.doctype == \"Purchase Invoice\" && (doc.update_stock || doc.is_return))) {\n\t\t\t\t\tthis.calculate_received_qty(doc, cdt, cdn)\n\t\t\t\t}\n\t\t\t\tsuper.qty(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\trejected_qty(doc, cdt, cdn) {\n\t\t\t\tthis.calculate_received_qty(doc, cdt, cdn)\n\t\t\t}\n\n\t\t\tcalculate_received_qty(doc, cdt, cdn){\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"rejected_qty\"]);\n\n\t\t\t\tif(!doc.is_return && this.validate_negative_quantity(cdt, cdn, item, [\"qty\", \"rejected_qty\"])){ return }\n\n\t\t\t\tlet received_qty = flt(item.qty + item.rejected_qty, precision(\"received_qty\", item));\n\t\t\t\tlet received_stock_qty = flt(item.conversion_factor, precision(\"conversion_factor\", item)) * flt(received_qty);\n\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"received_qty\", received_qty);\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"received_stock_qty\", received_stock_qty);\n\t\t\t}\n\n\t\t\tbatch_no(doc, cdt, cdn) {\n\t\t\t\tsuper.batch_no(doc, cdt, cdn);\n\t\t\t}\n\n\t\t\tvalidate_negative_quantity(cdt, cdn, item, fieldnames){\n\t\t\t\tif(!item || !fieldnames) { return }\n\n\t\t\t\tvar is_negative_qty = false;\n\t\t\t\tfor(var i = 0; i<fieldnames.length; i++) {\n\t\t\t\t\tif(item[fieldnames[i]] < 0){\n\t\t\t\t\t\tfrappe.msgprint(__(\"Row #{0}: {1} can not be negative for item {2}\", [item.idx,__(frappe.meta.get_label(cdt, fieldnames[i], cdn)), item.item_code]));\n\t\t\t\t\t\tis_negative_qty = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn is_negative_qty\n\t\t\t}\n\n\t\t\twarehouse(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif(item.item_code && item.warehouse) {\n\t\t\t\t\treturn this.frm.call({\n\t\t\t\t\t\tmethod: \"stock.stock.get_item_details.get_bin_details\",\n\t\t\t\t\t\tchild: item,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\t\tinclude_child_warehouses: true\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tproject(doc, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif(item.project) {\n\t\t\t\t\t$.each(this.frm.doc[\"items\"] || [],\n\t\t\t\t\t\tfunction(i, other_item) {\n\t\t\t\t\t\t\tif(!other_item.project) {\n\t\t\t\t\t\t\t\tother_item.project = item.project;\n\t\t\t\t\t\t\t\trefresh_field(\"project\", other_item.name, other_item.parentfield);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trejected_warehouse(doc, cdt) {\n\t\t\t\t// trigger autofill_warehouse only if parent rejected_warehouse field is triggered\n\t\t\t\tif ([\"Purchase Invoice\", \"Purchase Receipt\"].includes(cdt)) {\n\t\t\t\t\tthis.autofill_warehouse(doc.items, \"rejected_warehouse\", doc.rejected_warehouse);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcategory(doc, cdt, cdn) {\n\t\t\t\t// should be the category field of tax table\n\t\t\t\tif(cdt != doc.doctype) {\n\t\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t\t}\n\t\t\t}\n\t\t\tadd_deduct_tax(doc, cdt, cdn) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tset_from_product_bundle() {\n\t\t\t\tvar me = this;\n\t\t\t\tthis.frm.add_custom_button(__(\"Product Bundle\"), function() {\n\t\t\t\t\tstock.buying.get_items_from_product_bundle(me.frm);\n\t\t\t\t}, __(\"Get Items From\"));\n\t\t\t}\n\n\t\t\tshipping_address(){\n\t\t\t\tvar me = this;\n\t\t\t\tstock.utils.get_address_display(this.frm, \"shipping_address\",\n\t\t\t\t\t\"shipping_address_display\", true);\n\t\t\t}\n\n\t\t\tbilling_address() {\n\t\t\t\tstock.utils.get_address_display(this.frm, \"billing_address\",\n\t\t\t\t\t\"billing_address_display\", true);\n\t\t\t}\n\n\t\t\ttc_name() {\n\t\t\t\tthis.get_terms();\n\t\t\t}\n\n\t\t\tupdate_auto_repeat_reference(doc) {\n\t\t\t\tif (doc.auto_repeat) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod:\"frappe.automation.doctype.auto_repeat.auto_repeat.update_reference\",\n\t\t\t\t\t\targs:{\n\t\t\t\t\t\t\tdocname: doc.auto_repeat,\n\t\t\t\t\t\t\treference:doc.name\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r){\n\t\t\t\t\t\t\tif (r.message==\"success\") {\n\t\t\t\t\t\t\t\tfrappe.show_alert({message:__(\"Auto repeat document updated\"), indicator:'green'});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.show_alert({message:__(\"An error occurred during the update process\"), indicator:'red'});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmanufacturer(doc, cdt, cdn) {\n\t\t\t\tconst row = locals[cdt][cdn];\n\n\t\t\t\tif(row.manufacturer) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"stock.stock.doctype.item_manufacturer.item_manufacturer.get_item_manufacturer_part_no\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t'item_code': row.item_code,\n\t\t\t\t\t\t\t'manufacturer': row.manufacturer\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'manufacturer_part_no', r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmanufacturer_part_no(doc, cdt, cdn) {\n\t\t\t\tconst row = locals[cdt][cdn];\n\n\t\t\t\tif (row.manufacturer_part_no) {\n\t\t\t\t\tfrappe.model.get_value('Item Manufacturer',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'item_code': row.item_code,\n\t\t\t\t\t\t\t'manufacturer': row.manufacturer,\n\t\t\t\t\t\t\t'manufacturer_part_no': row.manufacturer_part_no\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'name',\n\t\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\t\tif (!data) {\n\t\t\t\t\t\t\t\tlet msg = {\n\t\t\t\t\t\t\t\t\tmessage: __(\"Manufacturer Part Number <b>{0}</b> is invalid\", [row.manufacturer_part_no]),\n\t\t\t\t\t\t\t\t\ttitle: __(\"Invalid Part Number\")\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrappe.throw(msg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tadd_serial_batch_bundle(doc, cdt, cdn) {\n\t\t\t\tlet item = locals[cdt][cdn];\n\t\t\t\tlet me = this;\n\t\t\t\tlet path = \"assets/stock/js/utils/serial_no_batch_selector.js\";\n\n\t\t\t\tfrappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\tif (r.message && (r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\titem.has_serial_no = r.message.has_serial_no;\n\t\t\t\t\t\t\titem.has_batch_no = r.message.has_batch_no;\n\t\t\t\t\t\t\titem.type_of_transaction = item.qty > 0 ? \"Inward\" : \"Outward\";\n\t\t\t\t\t\t\titem.is_rejected = false;\n\n\t\t\t\t\t\t\tfrappe.require(path, function() {\n\t\t\t\t\t\t\t\tnew stock.SerialBatchPackageSelector(\n\t\t\t\t\t\t\t\t\tme.frm, item, (r) => {\n\t\t\t\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\t\t\t\tlet qty = Math.abs(r.total_qty);\n\t\t\t\t\t\t\t\t\t\t\tif (doc.is_return) {\n\t\t\t\t\t\t\t\t\t\t\t\tqty = qty * -1;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tlet update_values = {\n\t\t\t\t\t\t\t\t\t\t\t\t\"serial_and_batch_bundle\": r.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\"qty\": qty\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (r.warehouse) {\n\t\t\t\t\t\t\t\t\t\t\t\tupdate_values[\"warehouse\"] = r.warehouse;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, update_values);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tadd_serial_batch_for_rejected_qty(doc, cdt, cdn) {\n\t\t\t\tlet item = locals[cdt][cdn];\n\t\t\t\tlet me = this;\n\t\t\t\tlet path = \"assets/stock/js/utils/serial_no_batch_selector.js\";\n\n\t\t\t\tfrappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\tif (r.message && (r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\titem.has_serial_no = r.message.has_serial_no;\n\t\t\t\t\t\t\titem.has_batch_no = r.message.has_batch_no;\n\t\t\t\t\t\t\titem.type_of_transaction = item.qty > 0 ? \"Inward\" : \"Outward\";\n\t\t\t\t\t\t\titem.is_rejected = true;\n\n\t\t\t\t\t\t\tfrappe.require(path, function() {\n\t\t\t\t\t\t\t\tnew stock.SerialBatchPackageSelector(\n\t\t\t\t\t\t\t\t\tme.frm, item, (r) => {\n\t\t\t\t\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\t\t\t\t\tlet qty = Math.abs(r.total_qty);\n\t\t\t\t\t\t\t\t\t\t\tif (doc.is_return) {\n\t\t\t\t\t\t\t\t\t\t\t\tqty = qty * -1;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tlet update_values = {\n\t\t\t\t\t\t\t\t\t\t\t\t\"serial_and_batch_bundle\": r.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\"rejected_qty\": qty\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (r.warehouse) {\n\t\t\t\t\t\t\t\t\t\t\t\tupdate_values[\"rejected_warehouse\"] = r.warehouse;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, update_values);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n}\n\nstock.buying.link_to_mrs = function(frm) {\n\tfrappe.call({\n\t\tmethod: \"stock.buying.utils.get_linked_material_requests\",\n\t\targs:{\n\t\t\titems: frm.doc.items.map((item) => item.item_code)\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (!r.message || r.message.length == 0) {\n\t\t\t\tfrappe.throw({\n\t\t\t\t\tmessage: __(\"No pending Material Requests found to link for the given items.\"),\n\t\t\t\t\ttitle: __(\"Note\")\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar item_length = frm.doc.items.length;\n\t\t\tfor (let item of frm.doc.items) {\n\t\t\t\tvar qty = item.qty;\n\t\t\t\t(r.message[0] || []).forEach(function(d) {\n\t\t\t\t\tif (d.qty > 0 && qty > 0 && item.item_code == d.item_code && !item.material_request_item)\n\t\t\t\t\t{\n\t\t\t\t\t\titem.material_request = d.mr_name;\n\t\t\t\t\t\titem.material_request_item = d.mr_item;\n\t\t\t\t\t\tvar my_qty = Math.min(qty, d.qty);\n\t\t\t\t\t\tqty = qty - my_qty;\n\t\t\t\t\t\td.qty = d.qty - my_qty;\n\t\t\t\t\t\titem.stock_qty = my_qty*item.conversion_factor;\n\t\t\t\t\t\titem.qty = my_qty;\n\n\t\t\t\t\t\tfrappe.msgprint(\"Assigning \" + d.mr_name + \" to \" + d.item_code + \" (row \" + item.idx + \")\");\n\t\t\t\t\t\tif (qty > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfrappe.msgprint(\"Splitting \" + qty + \" units of \" + d.item_code);\n\t\t\t\t\t\t\tvar newrow = frappe.model.add_child(frm.doc, item.doctype, \"items\");\n\t\t\t\t\t\t\titem_length++;\n\n\t\t\t\t\t\t\tfor (var key in item)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnewrow[key] = item[key];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnewrow.idx = item_length;\n\t\t\t\t\t\t\tnewrow[\"stock_qty\"] = newrow.conversion_factor*qty;\n\t\t\t\t\t\t\tnewrow[\"qty\"] = qty;\n\n\t\t\t\t\t\t\tnewrow[\"material_request\"] = \"\";\n\t\t\t\t\t\t\tnewrow[\"material_request_item\"] = \"\";\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\trefresh_field(\"items\");\n\t\t}\n\t});\n}\n\nstock.buying.get_default_bom = function(frm) {\n\t$.each(frm.doc[\"items\"] || [], function(i, d) {\n\t\tif (d.item_code && d.bom === \"\") {\n\t\t\treturn frappe.call({\n\t\t\t\ttype: \"GET\",\n\t\t\t\tmethod: \"stock.stock.get_item_details.get_default_bom\",\n\t\t\t\targs: {\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r) {\n\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"bom\", r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t});\n}\n\nstock.buying.get_items_from_product_bundle = function(frm) {\n\tvar dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Get Items from Product Bundle\"),\n\t\tfields: [\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\t\"label\": __(\"Product Bundle\"),\n\t\t\t\t\"fieldname\": \"product_bundle\",\n\t\t\t\t\"options\":\"Product Bundle\",\n\t\t\t\t\"reqd\": 1\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Currency\",\n\t\t\t\t\"label\": __(\"Quantity\"),\n\t\t\t\t\"fieldname\": \"quantity\",\n\t\t\t\t\"reqd\": 1,\n\t\t\t\t\"default\": 1\n\t\t\t}\n\t\t],\n\t\tprimary_action_label: 'Get Items',\n\t\tprimary_action(args){\n\t\t\tif(!args) return;\n\t\t\tdialog.hide();\n\t\t\treturn frappe.call({\n\t\t\t\ttype: \"GET\",\n\t\t\t\tmethod: \"stock.stock.doctype.packed_item.packed_item.get_items_from_product_bundle\",\n\t\t\t\targs: {\n\t\t\t\t\trow: {\n\t\t\t\t\t\titem_code: args.product_bundle,\n\t\t\t\t\t\tquantity: args.quantity,\n\t\t\t\t\t\tparenttype: frm.doc.doctype,\n\t\t\t\t\t\tparent: frm.doc.name,\n\t\t\t\t\t\tsupplier: frm.doc.supplier,\n\t\t\t\t\t\tcurrency: frm.doc.currency,\n\t\t\t\t\t\tconversion_rate: frm.doc.conversion_rate,\n\t\t\t\t\t\tprice_list: frm.doc.buying_price_list,\n\t\t\t\t\t\tprice_list_currency: frm.doc.price_list_currency,\n\t\t\t\t\t\tplc_conversion_rate: frm.doc.plc_conversion_rate,\n\t\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\t\tis_subcontracted: frm.doc.is_subcontracted,\n\t\t\t\t\t\ttransaction_date: frm.doc.transaction_date || frm.doc.posting_date,\n\t\t\t\t\t\tignore_pricing_rule: frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\tdoctype: frm.doc.doctype\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tconst first_row_is_empty = function(child_table){\n\t\t\t\t\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\t\t\t\t\treturn !child_table[0].item_code;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\n\t\t\t\t\tconst remove_empty_first_row = function(frm){\n\t\t\t\t\tif (first_row_is_empty(frm.doc.items)){\n\t\t\t\t\t\tfrm.doc.items = frm.doc.items.splice(1);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tremove_empty_first_row(frm);\n\t\t\t\t\t\tfor (var i=0; i< r.message.length; i++) {\n\t\t\t\t\t\t\tvar d = frm.add_child(\"items\");\n\t\t\t\t\t\t\tvar item = r.message[i];\n\t\t\t\t\t\t\tfor (var key in  item) {\n\t\t\t\t\t\t\t\tif (!is_null(item[key]) && key !== \"doctype\") {\n\t\t\t\t\t\t\t\t\td[key] = item[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(frappe.meta.get_docfield(d.doctype, \"price_list_rate\", d.name)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(\"price_list_rate\", d.doctype, d.name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrm.refresh_field(\"items\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t});\n\n\tdialog.show();\n}\n", "frappe.provide('stock.demo');\n\n$(document).on('toolbar_setup', function () {\n  if (frappe.boot.sysdefaults.demo_company) {\n    render_clear_demo_action();\n  }\n});\n\nfunction render_clear_demo_action() {\n  let demo_action = $(\n    `<a class=\"dropdown-item\" onclick=\"return stock.demo.clear_demo()\">\n\t\t\t${__('Clear Demo Data')}\n\t\t</a>`\n  );\n\n  demo_action.appendTo($('#toolbar-user'));\n}\n\nstock.demo.clear_demo = function () {\n  frappe.confirm(__('Are you sure you want to clear all demo data?'), () => {\n    frappe.call({\n      method: 'basic.setupdemo.clear_demo_data',\n      freeze: true,\n      freeze_message: __('Clearing Demo Data...'),\n      callback: function (r) {\n        frappe.ui.toolbar.clear_cache();\n        frappe.show_alert({\n          message: __('Demo data cleared'),\n          indicator: 'green',\n        });\n      },\n    });\n  });\n};\n", "frappe.provide(\"stock.financial_statements\");\n\nstock.financial_statements = {\n\t\"filters\": get_filters(),\n\t\"baseData\": null,\n\t\"formatter\": function(value, row, column, data, default_formatter, filter) {\n\t\tif(frappe.query_report.get_filter_value(\"selected_view\") == \"Growth\" && data && column.colIndex >= 3){\n\t\t\t//Assuming that the first three columns are s.no, account name and the very first year of the accounting values, to calculate the relative percentage values of the successive columns.\n\t\t\tconst lastAnnualValue = row[column.colIndex - 1].content;\n\t\t\tconst currentAnnualvalue = data[column.fieldname];\n\t\t\tif(currentAnnualvalue == undefined) return 'NA'; //making this not applicable for undefined/null values\n\t\t\tlet annualGrowth = 0;\n\t\t\tif(lastAnnualValue == 0 && currentAnnualvalue > 0){\n\t\t\t\t//If the previous year value is 0 and the current value is greater than 0\n\t\t\t\tannualGrowth = 1;\n\t\t\t}\n\t\t\telse if(lastAnnualValue > 0){\n\t\t\t\tannualGrowth  = (currentAnnualvalue - lastAnnualValue) / lastAnnualValue;\n\t\t\t}\n\n\t\t\tconst growthPercent = (Math.round(annualGrowth*10000)/100); //calculating the rounded off percentage\n\n\t\t\tvalue = $(`<span>${((growthPercent >=0)? '+':'' )+growthPercent+'%'}</span>`);\n\t\t\tif(growthPercent < 0){\n\t\t\t\tvalue = $(value).addClass(\"text-danger\");\n\t\t\t}\n\t\t\telse{\n\t\t\t\tvalue = $(value).addClass(\"text-success\");\n\t\t\t}\n\t\t\tvalue = $(value).wrap(\"<p></p>\").parent().html();\n\n\t\t\treturn value;\n\t\t}\n\t\telse if(frappe.query_report.get_filter_value(\"selected_view\") == \"Margin\" && data){\n\t\t\tif(column.fieldname ==\"account\" && data.account_name == __(\"Income\")){\n\t\t\t\t//Taking the total income from each column (for all the financial years) as the base (100%)\n\t\t\t\tthis.baseData = row;\n\t\t\t}\n\t\t\tif(column.colIndex >= 2){\n\t\t\t\t//Assuming that the first two columns are s.no and account name, to calculate the relative percentage values of the successive columns.\n\t\t\t\tconst currentAnnualvalue = data[column.fieldname];\n\t\t\t\tconst baseValue = this.baseData[column.colIndex].content;\n\t\t\t\tif(currentAnnualvalue == undefined || baseValue <= 0) return 'NA';\n\t\t\t\tconst marginPercent = Math.round((currentAnnualvalue/baseValue)*10000)/100;\n\n\t\t\t\tvalue = $(`<span>${marginPercent+'%'}</span>`);\n\t\t\t\tif(marginPercent < 0)\n\t\t\t\t\tvalue = $(value).addClass(\"text-danger\");\n\t\t\t\telse\n\t\t\t\t\tvalue = $(value).addClass(\"text-success\");\n\t\t\t\tvalue = $(value).wrap(\"<p></p>\").parent().html();\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t}\n\n\t\tif (data && column.fieldname==\"account\") {\n\t\t\tvalue = data.account_name || value;\n\n\t\t\tif (filter && filter?.text && filter?.type == \"contains\") {\n\t\t\t\tif (!value.toLowerCase().includes(filter.text)) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (data.account) {\n\t\t\t\tcolumn.link_onclick =\n\t\t\t\t\t\"stock.financial_statements.open_general_ledger(\" + JSON.stringify(data) + \")\";\n\t\t\t}\n\t\t\tcolumn.is_tree = true;\n\t\t}\n\n\t\tvalue = default_formatter(value, row, column, data);\n\n\t\tif (data && !data.parent_account) {\n\t\t\tvalue = $(`<span>${value}</span>`);\n\n\t\t\tvar $value = $(value).css(\"font-weight\", \"bold\");\n\t\t\tif (data.warn_if_negative && data[column.fieldname] < 0) {\n\t\t\t\t$value.addClass(\"text-danger\");\n\t\t\t}\n\n\t\t\tvalue = $value.wrap(\"<p></p>\").parent().html();\n\t\t}\n\n\t\treturn value;\n\t},\n\t\"open_general_ledger\": function(data) {\n\t\tif (!data.account) return;\n\t\tlet project = $.grep(frappe.query_report.filters, function(e){ return e.df.fieldname == 'project'; });\n\n\t\tfrappe.route_options = {\n\t\t\t\"account\": data.account,\n\t\t\t\"company\": frappe.query_report.get_filter_value('company'),\n\t\t\t\"from_date\": data.from_date || data.year_start_date,\n\t\t\t\"to_date\": data.to_date || data.year_end_date,\n\t\t\t\"project\": (project && project.length > 0) ? project[0].$input.val() : \"\"\n\t\t};\n\n\t\tlet report = \"General Ledger\";\n\n\t\tif ([\"Payable\", \"Receivable\"].includes(data.account_type)) {\n\t\t\treport = data.account_type == \"Payable\" ? \"Accounts Payable\" : \"Accounts Receivable\";\n\t\t\tfrappe.route_options[\"party_account\"] = data.account;\n\t\t\tfrappe.route_options[\"report_date\"] = data.year_end_date;\n\t\t}\n\n\t\tfrappe.set_route(\"query-report\", report);\n\t},\n\t\"tree\": true,\n\t\"name_field\": \"account\",\n\t\"parent_field\": \"parent_account\",\n\t\"initial_depth\": 3,\n\tonload: function(report) {\n\t\t// dropdown for links to other financial statements\n\t\tstock.financial_statements.filters = get_filters()\n\n\t\t// let fiscal_year = stock.utils.get_fiscal_year(frappe.datetime.get_today());\n\n\t\t// frappe.model.with_doc(\"Fiscal Year\", fiscal_year, function(r) {\n\t\t// \tvar fy = frappe.model.get_doc(\"Fiscal Year\", fiscal_year);\n\t\t// \tfrappe.query_report.set_filter_value({\n\t\t// \t\tperiod_start_date: fy.year_start_date,\n\t\t// \t\tperiod_end_date: fy.year_end_date\n\t\t// \t});\n\t\t// });\n\n\t\tif (report.page){\n\t\t\tconst views_menu = report.page.add_custom_button_group(__('Financial Statements'));\n\n\t\t\treport.page.add_custom_menu_item(views_menu, __(\"Balance Sheet\"), function() {\n\t\t\t\tvar filters = report.get_values();\n\t\t\t\tfrappe.set_route('query-report', 'Balance Sheet', {company: filters.company});\n\t\t\t});\n\n\t\t\treport.page.add_custom_menu_item(views_menu, __(\"Profit and Loss\"), function() {\n\t\t\t\tvar filters = report.get_values();\n\t\t\t\tfrappe.set_route('query-report', 'Profit and Loss Statement', {company: filters.company});\n\t\t\t});\n\n\t\t\treport.page.add_custom_menu_item(views_menu, __(\"Cash Flow Statement\"), function() {\n\t\t\t\tvar filters = report.get_values();\n\t\t\t\tfrappe.set_route('query-report', 'Cash Flow', {company: filters.company});\n\t\t\t});\n\t\t}\n\t}\n};\n\nfunction get_filters() {\n\tlet filters = [\n\t\t{\n\t\t\t\"fieldname\":\"company\",\n\t\t\t\"label\": __(\"Company\"),\n\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\"options\": \"Company\",\n\t\t\t\"default\": frappe.defaults.get_user_default(\"Company\"),\n\t\t\t\"reqd\": 1\n\t\t},\n\t\t{\n\t\t\t\"fieldname\":\"finance_book\",\n\t\t\t\"label\": __(\"Finance Book\"),\n\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\"options\": \"Finance Book\"\n\t\t},\n\t\t// {\n\t\t// \t\"fieldname\":\"filter_based_on\",\n\t\t// \t\"label\": __(\"Filter Based On\"),\n\t\t// \t\"fieldtype\": \"Select\",\n\t\t// \t\"options\": [\"Fiscal Year\", \"Date Range\"],\n\t\t// \t\"default\": [\"Fiscal Year\"],\n\t\t// \t\"reqd\": 1,\n\t\t// \ton_change: function() {\n\t\t// \t\tlet filter_based_on = frappe.query_report.get_filter_value('filter_based_on');\n\t\t// \t\tfrappe.query_report.toggle_filter_display('from_fiscal_year', filter_based_on === 'Date Range');\n\t\t// \t\tfrappe.query_report.toggle_filter_display('to_fiscal_year', filter_based_on === 'Date Range');\n\t\t// \t\tfrappe.query_report.toggle_filter_display('period_start_date', filter_based_on === 'Fiscal Year');\n\t\t// \t\tfrappe.query_report.toggle_filter_display('period_end_date', filter_based_on === 'Fiscal Year');\n\n\t\t// \t\tfrappe.query_report.refresh();\n\t\t// \t}\n\t\t// },\n\t\t{\n\t\t\t\"fieldname\":\"period_start_date\",\n\t\t\t\"label\": __(\"Start Date\"),\n\t\t\t\"fieldtype\": \"Date\",\n\t\t\t\"reqd\": 1,\n\t\t\t\"depends_on\": \"eval:doc.filter_based_on == 'Date Range'\"\n\t\t},\n\t\t{\n\t\t\t\"fieldname\":\"period_end_date\",\n\t\t\t\"label\": __(\"End Date\"),\n\t\t\t\"fieldtype\": \"Date\",\n\t\t\t\"reqd\": 1,\n\t\t\t\"depends_on\": \"eval:doc.filter_based_on == 'Date Range'\"\n\t\t},\n\t\t// {\n\t\t// \t\"fieldname\":\"from_fiscal_year\",\n\t\t// \t\"label\": __(\"Start Year\"),\n\t\t// \t\"fieldtype\": \"Link\",\n\t\t// \t\"options\": \"Fiscal Year\",\n\t\t// \t\"reqd\": 1,\n\t\t// \t\"depends_on\": \"eval:doc.filter_based_on == 'Fiscal Year'\"\n\t\t// },\n\t\t// {\n\t\t// \t\"fieldname\":\"to_fiscal_year\",\n\t\t// \t\"label\": __(\"End Year\"),\n\t\t// \t\"fieldtype\": \"Link\",\n\t\t// \t\"options\": \"Fiscal Year\",\n\t\t// \t\"reqd\": 1,\n\t\t// \t\"depends_on\": \"eval:doc.filter_based_on == 'Fiscal Year'\"\n\t\t// },\n\t\t{\n\t\t\t\"fieldname\": \"periodicity\",\n\t\t\t\"label\": __(\"Periodicity\"),\n\t\t\t\"fieldtype\": \"Select\",\n\t\t\t\"options\": [\n\t\t\t\t{ \"value\": \"Monthly\", \"label\": __(\"Monthly\") },\n\t\t\t\t{ \"value\": \"Quarterly\", \"label\": __(\"Quarterly\") },\n\t\t\t\t{ \"value\": \"Half-Yearly\", \"label\": __(\"Half-Yearly\") },\n\t\t\t\t{ \"value\": \"Yearly\", \"label\": __(\"Yearly\") }\n\t\t\t],\n\t\t\t\"default\": \"Yearly\",\n\t\t\t\"reqd\": 1\n\t\t},\n\t\t// Note:\n\t\t// If you are modifying this array such that the presentation_currency object\n\t\t// is no longer the last object, please make adjustments in cash_flow.js\n\t\t// accordingly.\n\t\t// {\n\t\t// \t\"fieldname\": \"presentation_currency\",\n\t\t// \t\"label\": __(\"Currency\"),\n\t\t// \t\"fieldtype\": \"Select\",\n\t\t// \t\"options\": stock.get_presentation_currency_list()\n\t\t// },\n\t\t{\n\t\t\t\"fieldname\": \"cost_center\",\n\t\t\t\"label\": __(\"Cost Center\"),\n\t\t\t\"fieldtype\": \"MultiSelectList\",\n\t\t\tget_data: function(txt) {\n\t\t\t\treturn frappe.db.get_link_options('Cost Center', txt, {\n\t\t\t\t\tcompany: frappe.query_report.get_filter_value(\"company\")\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"fieldname\": \"project\",\n\t\t\t\"label\": __(\"Project\"),\n\t\t\t\"fieldtype\": \"MultiSelectList\",\n\t\t\tget_data: function(txt) {\n\t\t\t\treturn frappe.db.get_link_options('Project', txt, {\n\t\t\t\t\tcompany: frappe.query_report.get_filter_value(\"company\")\n\t\t\t\t});\n\t\t\t},\n\t\t}\n\t]\n\n\t// Dynamically set 'default' values for fiscal year filters\n\t// let fy_filters = filters.filter(x=>{return [\"from_fiscal_year\", \"to_fiscal_year\"].includes(x.fieldname);})\n\t// let fiscal_year = stock.utils.get_fiscal_year(frappe.datetime.get_today(), false, true);\n\t// if (fiscal_year) {\n\t// \tlet fy = stock.utils.get_fiscal_year(frappe.datetime.get_today(), false, false);\n\t// \tfy_filters.forEach(x=>{x.default = fy;})\n\t// }\n\n\t// return filters;\n}\n"],
  "mappings": "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",
  "names": ["company", "_a", "currency_list", "d", "companies", "grid_row", "has_serial_no", "has_batch_no", "attach_selector_button", "args", "journal_entry", "je_account", "child_row", "frm", "company_wise_info", "info", "bundle_ids", "color", "indicator", "party_type", "dict", "doc", "dt", "dn", "table_fieldname", "fieldname", "cl", "i", "tc_name", "callback", "r", "report_name", "index", "filters", "dimension", "existing_filter", "el", "txt", "doctype", "docname", "doclist", "child_table", "child_table_name", "rows", "option", "unscrub_option", "user_permission", "options", "perm", "c", "value", "self", "parent_fieldname", "update_fields", "new_doc", "key", "marketplace_link", "github_link", "msg", "cdt", "cdn", "type_of_transaction", "warehouse_field", "item_row", "update_values", "opts", "item_field", "dialog", "item_code", "warehouse", "e", "row", "qty", "cannot_add_row", "child_docname", "child_meta", "has_reserved_stock", "get_precision", "f", "fields", "trans_items", "item", "_map", "items_doctype", "link_fieldname", "already_set", "item_qty_map", "src", "source_doc", "query_args", "data_fields", "selections", "values", "_i", "data", "statuses", "hold_statuses", "entry", "message", "set_time_to_resolve_and_response", "agreement_status", "apply_sla_for_resolution", "time_to_respond", "get_status", "get_time_left", "alert", "time_to_resolve", "timestamp", "diff", "diff_display", "expected", "actual", "inner_text", "append_loction", "context", "$btn_div", "filters", "args", "doc", "child_fields", "dimension", "company", "account", "field", "frm", "options", "query_fn", "me", "set_query", "doctype", "parentfield", "link_fields", "i", "df", "cdt", "cdn", "row", "doc", "me", "default_msg", "contact", "ref_doctype", "ref_name", "r", "mobile_nos", "message", "d", "btn", "v", "SALES_DOCTYPES", "PURCHASE_DOCTYPES", "frm", "method", "args", "callback", "party_type", "r", "prev_route", "item", "address_field", "display_field", "is_your_company_address", "triggered_from_field", "billing_address_field", "shipping_address_field", "party", "label", "value", "trigger_on", "me", "frm", "me", "index", "data", "multimode_payments", "selected_row", "e", "write_off_amount", "change_amount", "update_write_off", "value", "item", "effective_item_rate", "item_rate", "update_paid_amount", "is_quotation", "me", "qty", "doc", "fields", "i", "f", "r", "has_inclusive_tax", "row", "n", "item_tax_map", "cumulated_tax_fraction", "total_inclusive_tax_amount_per_qty", "tax", "current_tax_fraction", "inclusive_tax_amount_per_qty", "amount", "tax_rate", "rate", "d", "child", "actual_tax_dict", "current_tax_amount", "row_idx", "tax_amount", "item_tax_rate", "actual", "tax_detail", "key", "item_wise_tax_amount", "any_inclusive_tax", "last_tax", "non_inclusive_tax_amount", "diff", "tax_count", "disable_rounded_total", "items", "temporary_fields", "fieldname", "distributed_amount", "total_for_discount_amount", "net_total", "discount_amount_loss", "total_actual_tax", "actual_taxes_dict", "actual_tax_amount", "value", "total_allocated_amount", "adv", "grand_total", "base_grand_total", "total_amount_to_pay", "total_amount_for_payment", "paid_amount", "payment", "payment_status", "index", "data", "base_amount", "base_paid_amount", "payment_types", "me", "frm", "cdt", "cdn", "item", "has_margin_field", "total", "discount_amount", "doc", "filters", "field", "value", "currency", "set_value", "fieldname", "sbb_field", "row", "batch_no_field", "inspection_type", "quality_inspection_field", "d", "_a", "table", "taxes_and_charges_field", "r", "blacklist", "sms_man", "update_stock", "show_batch_dialog", "k", "v", "key", "company_currency", "posting_date", "posting_time", "voucher_type", "company", "item_args", "item_tax_map", "tax", "rate", "child", "frm_obj", "valid_serial_nos", "serialnos", "i", "set_pricing", "company_doc", "selling_doctypes_for_tc", "buying_doctypes_for_tc", "message1", "message2", "final_message", "term", "exchange_rate", "transaction_date", "from_currency", "to_currency", "callback", "args", "dont_fetch_price_list_rate", "start_date", "end_date", "stop_date", "doctypes", "barcode_scanner", "show", "item_grid", "fname", "schedule_grid", "item_list", "append_item", "children", "items_rule_dict", "existing_pricing_rule", "fields", "data", "items", "exist_items", "pr_row", "row_to_modify", "reset_plc_conversion", "applied_on_items", "f", "child_row", "item_codes", "item_rates", "item_tax_templates", "owner_email", "recurring_type_map", "months", "to_date", "rt", "via_journal_entry", "doclist", "values", "is_eligible", "has_payment_schedule", "dialog", "dialog_items", "child_table", "warehouse_field", "warehouse", "doctype", "_ignore_pricing_rule", "item_row", "on_close", "show_dialog", "receiving_stock", "existing_stock", "update_values", "purpose", "result", "opts", "me", "body", "item_code", "added", "i", "d", "args", "results", "docsUrl", "doctype", "after_insert", "init_callback", "doc", "force", "fieldname", "new_fieldname", "variant_fields", "CallPopup", "call_log", "color", "blink", "classes", "call_status", "title", "missed", "contact_link", "d", "call_summary", "call_type", "new_customer", "new_contact", "phone_no", "call_popup", "opts", "resolve", "reject", "me", "input", "data", "row", "callback", "r", "cur_grid", "item_code", "barcode", "batch_no", "serial_no", "uom", "is_duplicate", "qty", "increment", "value", "item_data", "fields", "e", "scanned_item", "serial_nos", "prev_row", "ignore_fields", "key", "parts", "docname", "items", "existing_items", "d", "entries", "existing_row", "entry", "item", "idx", "exist", "response", "is_batch_no_scan", "check_max_qty", "matching_row", "item_match", "batch_match", "uom_match", "qty_in_limit", "item_scanned", "msg", "indicator", "duration", "field", "control", "listview", "from_doctype", "to_doctype", "checked_items", "doc_name", "Item", "count_of_rows", "opts", "me", "cur_form_footer", "r", "activities_html", "_create_task", "args", "composer", "_create_event", "input_field", "doctype", "completed", "docname", "notes", "b", "notes_html", "_add_note", "d", "data", "edit_btn", "row", "row_id", "row_content", "delete_btn", "doctype", "frm", "tax_field", "cdt", "cdn", "row", "value", "doc", "me", "i", "opts", "cdt", "cdn", "item", "amount_eligible_for_commission", "sales_person", "row", "df", "editable_price_list_rate", "parent_field", "sum", "help_msg", "r", "dont_fetch_price_list_rate", "path", "qty", "rt", "doctype", "frm", "dialog", "values", "doc", "cdt", "cdn", "df", "disable", "me", "filters", "row", "item", "received_qty", "received_stock_qty", "fieldnames", "is_negative_qty", "i", "other_item", "r", "data", "msg", "path", "qty", "update_values", "frm", "item_length", "d", "my_qty", "newrow", "key", "dialog", "args", "first_row_is_empty", "child_table", "remove_empty_first_row", "render_clear_demo_action", "r", "get_filters", "value", "row", "column", "data", "default_formatter", "filter", "lastAnnualValue", "currentAnnualvalue", "annualGrowth", "growthPercent", "baseValue", "marginPercent", "$value", "project", "e", "report", "views_menu", "filters", "txt"]
}
